!function(t){function e(e){for(var n,a,u=e[0],s=e[1],l=e[2],h=0,f=[];h<u.length;h++)a=u[h],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(c&&c(e);f.length;)f.shift()();return o.push.apply(o,l||[]),r()}function r(){for(var t,e=0;e<o.length;e++){for(var r=o[e],n=!0,u=1;u<r.length;u++){var s=r[u];0!==i[s]&&(n=!1)}n&&(o.splice(e--,1),t=a(a.s=r[0]))}return t}var n={},i={55:0},o=[];function a(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=n,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var u=window.webpackJsonp=window.webpackJsonp||[],s=u.push.bind(u);u.push=e,u=u.slice();for(var l=0;l<u.length;l++)e(u[l]);var c=s;o.push([1244,2]),r()}({1244:function(t,e,r){t.exports=r(1286)},1286:function(t,e,r){"use strict";r.r(e);var n=r(19);function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",u=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new C(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return M()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var u=S(a,r);if(u){if(u===f)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=h(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var f={};function p(){}function d(){}function y(){}var v={};l(v,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(L([])));m&&m!==e&&r.call(m,a)&&(v=m);var b=y.prototype=p.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){var n;this._invoke=function(o,a){function u(){return new e((function(n,u){!function n(o,a,u,s){var l=h(t[o],t,a);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==i(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,u,s)}),(function(t){n("throw",t,u,s)})):e.resolve(f).then((function(t){c.value=t,u(c)}),(function(t){return n("throw",t,u,s)}))}s(l.arg)}(o,a,n,u)}))}return n=n?n.then(u,u):u()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=y,l(b,"constructor",y),l(y,"constructor",d),d.displayName=l(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(k.prototype),l(k.prototype,u,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(c(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),l(b,s,"Generator"),l(b,a,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=L,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),s=r.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u,s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,r=null,n=[{key:"getUniTrackSize",value:function(t){return t.size[0]>t.size[1]?[.5*t.size[0]-t.radius,0]:[0,.5*t.size[1]-t.radius]}},{key:"transformUniPoint",value:function(t,e){return[(t=this.rotatePoint(t,e.direction))[0]+e.position[0],t[1]+e.position[1]]}},{key:"rotatePoint",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],n=e[0],i=e[1];return[n*(t[0]-r[0])-i*(t[1]-r[1])+r[0],i*(t[0]-r[0])+n*(t[1]-r[1])+r[1]]}},{key:"getUniAngles",value:function(t,e){var r=Math.atan2(e.direction[1],e.direction[0]);return[t[0]+r,t[1]+r]}},{key:"getArcVertices",value:o().mark((function t(e,r,n,i){var a,u,s,l;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=i/r,u=n[0];case 2:if(!(u<=n[1])){t.next=10;break}return s=e[0]+r*Math.cos(u),l=e[1]+r*Math.sin(u),u+=a,t.next=8,[s,l];case 8:t.next=2;break;case 10:case"end":return t.stop()}}),t)}))},{key:"distanceBetweenSegments",value:function(e,r,n,i){var o,a;if(this.isIntersected(e,r,n,i)){var u,s=null!==(u=this.getCrossPoint(e,r,n,i))&&void 0!==u?u:e;return[0,new b(s,s)]}var l=Number.MAX_VALUE;return(a=t.distanceToSegmentSq(e,n,i))[0]<l&&(l=a[0],o=new b(e,a[1])),(a=t.distanceToSegmentSq(r,n,i))[0]<l&&(l=a[0],o=new b(r,a[1])),(a=t.distanceToSegmentSq(n,e,r))[0]<l&&(l=a[0],o=new b(a[1],n)),(a=t.distanceToSegmentSq(i,e,r))[0]<l&&(l=a[0],o=new b(a[1],i)),[l,o]}},{key:"isIntersected",value:function(t,e,r,n){var i=e[0]-t[0],o=e[1]-t[1],a=n[0]-r[0],u=n[1]-r[1],s=o*a-i*u,l=((t[0]-r[0])*u+(r[1]-t[1])*a)/s;if(Number.isNaN(l))return!1;var c=((r[0]-t[0])*o+(t[1]-r[1])*i)/-s;return l>=0&&l<=1&&c>=0&&c<=1}},{key:"getCrossPoint",value:function(t,e,r,n){var i;if(e[1]-t[1]!=0){var o=(e[0]-t[0])/(t[1]-e[1]),a=r[0]-n[0]+(r[1]-n[1])*o;if(!a)return null;i=(r[0]-t[0]+(r[1]-t[1])*o)/a}else{if(!(r[1]-n[1]))return null;i=(r[1]-t[1])/(r[1]-n[1])}return[r[0]+(n[0]-r[0])*i,r[1]+(n[1]-r[1])*i]}},{key:"distanceToSegmentSq",value:function(t,e,r){var n,i=r[0]-e[0],o=r[1]-e[1];if(0==i&&0==o)return n=e,[(i=t[0]-e[0])*i+(o=t[1]-e[1])*o,n];var a=((t[0]-e[0])*i+(t[1]-e[1])*o)/(i*i+o*o);return a<0?(n=[e[0],e[1]],i=t[0]-e[0],o=t[1]-e[1]):a>1?(n=[r[0],r[1]],i=t[0]-r[0],o=t[1]-r[1]):(n=[e[0]+a*i,e[1]+a*o],i=t[0]-n[0],o=t[1]-n[1]),[i*i+o*o,n]}},{key:"isOverlappedBoundRects",value:function(t,e,r,n){var i=Math.abs(e[0]-t[0]),o=Math.abs(e[1]-t[1]),a=Math.abs(n[0]-r[0]),u=Math.abs(n[1]-r[1]);return 2*Math.abs(t[0]+i/2-(r[0]+a/2))<i+a&&2*Math.abs(t[1]+o/2-(r[1]+u/2))<o+u}}],r&&a(e.prototype,r),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */c=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new C(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return M()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var u=S(a,r);if(u){if(u===f)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=h(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var f={};function p(){}function d(){}function y(){}var v={};u(v,i,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(L([])));m&&m!==e&&r.call(m,i)&&(v=m);var b=y.prototype=p.prototype=Object.create(v);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){var n;this._invoke=function(i,o){function a(){return new e((function(n,a){!function n(i,o,a,u){var s=h(t[i],t,o);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==l(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,u)}))}u(s.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function S(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=h(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function x(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(x,this),this.reset(!0)}function L(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:M}}function M(){return{value:void 0,done:!0}}return d.prototype=y,u(b,"constructor",y),u(y,"constructor",d),d.displayName=u(y,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,a,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},w(k.prototype),u(k.prototype,o,(function(){return this})),t.AsyncIterator=k,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new k(s(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),u(b,a,"Generator"),u(b,i,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=L,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),s=r.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:L(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},t}function h(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function p(t,e,r,n,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,i)}function d(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){p(o,n,i,a,u,"next",t)}function u(t){p(o,n,i,a,u,"throw",t)}a(void 0)}))}}function y(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e,r){return e&&y(t.prototype,e),r&&y(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t[t.Vertices=0]="Vertices",t[t.Lines=1]="Lines",t[t.Both=2]="Both"}(u||(u={}));var b=v((function t(e,r){g(this,t),m(this,"from",void 0),m(this,"to",void 0),this.from=e,this.to=r})),w=function(){function t(){g(this,t),m(this,"layerIndex",void 0),m(this,"vertices",[]),m(this,"lines",[]),m(this,"_reduced",void 0),this._reduced=!1}return v(t,[{key:"reduced",get:function(){return this._reduced}},{key:"reduce",value:function(){this._reduced=!0,this.lines=[]}},{key:"addLine",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.Vertices;if(e&&!(e.length<2)){var n=r===u.Lines||r===u.Both,i=r===u.Vertices||r===u.Both;i&&this.vertices.push(e),(!this.reduced&&i||this.reduced&&n)&&t.buildLines(e,this.lines)}}},{key:"addArc",value:function(t,e,r){var n=Array.from(s.getArcVertices(t,e,r,.01));this.addLine(n)}}],[{key:"buildLines",value:function(t,e){for(var r=t[0],n=1;n<t.length;n++){var i=t[n];e.push(new b(r,i)),r=i}}}]),t}(),k=function(){function t(){g(this,t),m(this,"epsilon",1e-4),m(this,"scene2D",void 0),m(this,"logger",void 0),this.logger=n.a.createLogger("Support library")}var e,r;return v(t,[{key:"setScene2D",value:function(t){this.scene2D=t}},{key:"getContour",value:function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r],i=new w;i.layerIndex=n.GetLayerIndex();for(var o=0;o<n.GetArcsCount();o++)this.addArcContour(i,n.GetArc(o));for(o=0;o<n.GetPolysCount();o++)this.addPolyContour(i,n.GetPoly(o));for(o=0;o<n.GetUnisCount();o++)this.addUniContour(i,n.GetUni(o));0!=i.vertices.length&&e.push(i)}return e}},{key:"getClosestDistance",value:(r=d(c().mark((function t(e,r){var n,i,o,a,u,s,l,f,p,d;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.tryReduceContours(e,r,-1))){t.next=3;break}return t.abrupt("return",n);case 3:o=Number.MAX_VALUE,a=h(e),t.prev=5,a.s();case 7:if((u=a.n()).done){t.next=36;break}s=u.value,l=h(r),t.prev=10,l.s();case 12:if((f=l.n()).done){t.next=26;break}return p=f.value,t.next=16,this.getClosestLines(s.lines,p.lines,o);case 16:if(!(d=t.sent)){t.next=24;break}if((i=d).contour1=s,i.contour2=p,o=i.distance,0!==i.distance){t.next=24;break}return t.abrupt("return",i);case 24:t.next=12;break;case 26:t.next=31;break;case 28:t.prev=28,t.t0=t.catch(10),l.e(t.t0);case 31:return t.prev=31,l.f(),t.finish(31);case 34:t.next=7;break;case 36:t.next=41;break;case 38:t.prev=38,t.t1=t.catch(5),a.e(t.t1);case 41:return t.prev=41,a.f(),t.finish(41);case 44:return i&&(i.distance=Math.round(Math.sqrt(o)/.01*100)/100),t.abrupt("return",i);case 46:case"end":return t.stop()}}),t,this,[[5,38,41,44],[10,28,31,34]])}))),function(t,e){return r.apply(this,arguments)})},{key:"tryReduceContours",value:function(t,e,r){var n=this.logStatistic(t,e,r),i=this.needReduce(n[0],t[0].reduced,n[1],e[0].reduced);if(-1!==i){var o=[t,e],a=this.getReducedContours(t,e);return Array.isArray(a)?(o[i].forEach((function(t){return t.reduce()})),o[i][0].lines=a[i],this.tryReduceContours(t,e,i)):a}return null}},{key:"logStatistic",value:function(t,e,r){var n=0,i=0;t.forEach((function(t){return n+=t.lines.length})),e.forEach((function(t){return i+=t.lines.length}));var o=-1===r?"Precise":"Reduce #".concat(r);return this.logger.LogDebug("".concat(o,": ").concat(n," x ").concat(i," lines, ").concat(n*i," hits.")),[n,i]}},{key:"needReduce",value:function(t,e,r,n){return e&&n?-1:t*r>3e6?t>r?e?1:0:n?0:1:-1}},{key:"getReducedContours",value:function(t,e){var r=t.map((function(t){return t.vertices})).reduce((function(t,e){return t.concat(e)}),[]),n=e.map((function(t){return t.vertices})).reduce((function(t,e){return t.concat(e)}),[]);if(0!==r.length&&0!==n.length){var i,o=Number.MAX_VALUE,a=null,u=null,s=-1,l=-1,c=h(r);try{for(c.s();!(i=c.n()).done;){var f,p=i.value,d=h(n);try{for(d.s();!(f=d.n()).done;){for(var y=f.value,v=-1,g=-1,m=Number.MAX_VALUE,b=0;b<p.length;b++)for(var w=0;w<y.length;w++){var k=Math.pow(p[b][0]-y[w][0],2)+Math.pow(p[b][1]-y[w][1],2);m>k&&(v=b,g=w,m=k)}if(o>m&&(a=p,u=y,s=v,l=g,(o=m)<this.epsilon))return{contour1:t[0],point1:p[v],line1:null,contour2:e[0],point2:y[g],line2:null,distance:0}}}catch(t){d.e(t)}finally{d.f()}}}catch(t){c.e(t)}finally{c.f()}return[this.getReducedLines(a,s),this.getReducedLines(u,l)]}}},{key:"getReducedLines",value:function(t,e){var r=[];if(!t)return r;var n=Math.max(e-5,0),i=Math.min(e+5,t.length);return w.buildLines(t.slice(n,i),r),r}},{key:"getClosestLines",value:(e=d(c().mark((function t(e,r,n){var i,o,a,u,l,f,p,d,y,v;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=h(e),t.prev=1,o.s();case 3:if((a=o.n()).done){t.next=32;break}u=a.value,l=h(r),t.prev=6,l.s();case 8:if((f=l.n()).done){t.next=22;break}if(p=f.value,!((d=s.distanceBetweenSegments(u.from,u.to,p.from,p.to))[0]<n)){t.next=20;break}if(n=d[0],i={contour1:null,point1:d[1].from,line1:u,contour2:null,point2:d[1].to,line2:p,distance:d[0]},!(n<this.epsilon)){t.next=20;break}return v=null!==(y=s.getCrossPoint(u.from,u.to,p.from,p.to))&&void 0!==y?y:i.point1,i.point1=v,i.point2=v,i.distance=0,t.abrupt("return",i);case 20:t.next=8;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(6),l.e(t.t0);case 27:return t.prev=27,l.f(),t.finish(27);case 30:t.next=3;break;case 32:t.next=37;break;case 34:t.prev=34,t.t1=t.catch(1),o.e(t.t1);case 37:return t.prev=37,o.f(),t.finish(37);case 40:return t.abrupt("return",i);case 41:case"end":return t.stop()}}),t,this,[[1,34,37,40],[6,24,27,30]])}))),function(t,r,n){return e.apply(this,arguments)})},{key:"addUniContour",value:function(t,e){var r=.5*e.size[0],n=.5*e.size[1];if(e.radius<.01){var i=s.transformUniPoint([-r,-n],e),o=s.transformUniPoint([-r,n],e),a=s.transformUniPoint([r,n],e),u=s.transformUniPoint([r,-n],e);t.addLine([i,o,a,u])}else{var l=s.transformUniPoint([-r,-n+e.radius],e),c=s.transformUniPoint([-r,n-e.radius],e),h=s.transformUniPoint([-r+e.radius,n],e),f=s.transformUniPoint([r-e.radius,n],e),p=s.transformUniPoint([r,n-e.radius],e),d=s.transformUniPoint([r,-n+e.radius],e),y=s.transformUniPoint([r-e.radius,-n],e),v=s.transformUniPoint([-r+e.radius,-n],e);this.equalVectors(l,c)||t.addLine([l,c]),this.equalVectors(h,f)||t.addLine([h,f]),this.equalVectors(p,d)||t.addLine([p,d]),this.equalVectors(y,v)||t.addLine([y,v]),t.addArc(s.transformUniPoint([-r+e.radius,-n+e.radius],e),e.radius,s.getUniAngles([Math.PI,3*Math.PI/2],e)),t.addArc(s.transformUniPoint([-r+e.radius,n-e.radius],e),e.radius,s.getUniAngles([Math.PI/2,Math.PI],e)),t.addArc(s.transformUniPoint([r-e.radius,n-e.radius],e),e.radius,s.getUniAngles([0,Math.PI/2],e)),t.addArc(s.transformUniPoint([r-e.radius,-n+e.radius],e),e.radius,s.getUniAngles([3*Math.PI/2,2*Math.PI],e))}}},{key:"addPolyContour",value:function(t,e){for(var r=this.scene2D.getSystemScene().GetPolygonByID(e.polygon),n=r.GetOutlineIndices(),i=r.GetVertices(),o=null,a=[],u=1;u<n.length;u+=2){var s=e.position[0]+i[n[u-1]].position[0]*e.scale[0],l=e.position[1]+i[n[u-1]].position[1]*e.scale[1],c=e.position[0]+i[n[u]].position[0]*e.scale[0],h=e.position[1]+i[n[u]].position[1]*e.scale[1];this.equalVectors([s,l],[c,h])||(!o||o[0]===s&&o[1]===l||(t.addLine(a),a=[]),a.length||a.push([s,l]),o=[c,h],a.push(o))}t.addLine(a)}},{key:"addArcContour",value:function(t,e){t.addArc(e.center,e.radius+e.width/2,e.angles),t.addArc(e.center,e.radius-e.width/2,e.angles);var r=e.center[0]+e.radius*Math.cos(e.angles[0]),n=e.center[1]+e.radius*Math.sin(e.angles[0]),i=e.angles[0],o=e.angles[0]-Math.PI;t.addArc([r,n],e.width/2,[o,i]),r=e.center[0]+e.radius*Math.cos(e.angles[1]),n=e.center[1]+e.radius*Math.sin(e.angles[1]),o=e.angles[1],i=e.angles[1]+Math.PI,t.addArc([r,n],e.width/2,[o,i])}},{key:"equalVectors",value:function(t,e){return t[0]===e[0]&&t[1]===e[1]}}]),t}();function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function x(t,e,r){return e&&S(t.prototype,e),r&&S(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function P(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var C=x((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));function L(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}P(C,"MetaInfo",'version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'),P(C,"SvgStyles",'stroke-linecap="{0}" stroke-linejoin="{1}" fill="{2}"'),P(C,"XmlHeader",'<?xml version="1.0"  encoding="UTF-8" standalone="no"?>'),P(C,"DocHeader",'<svg {0} {1} width="{2}" height="{3}" data-doc-id="{4}">'),P(C,"DocFooter","</svg>"),P(C,"GroupHeader",'<g id = "{0}">'),P(C,"UnitGroupHeader",'<g data-unit-id="{0}">'),P(C,"VariantGroupHeader",'<g data-variant-id="{0}">'),P(C,"ClipGroupHeader",'<g> <clipPath id = "ClipRect{0}"> <rect x = "{1}" y="{2}" width="{3}" height="{4}"/></clipPath>'),P(C,"GroupFooter","</g>"),P(C,"Line",'<line x1="{0}" y1="{1}" x2="{2}" y2="{3}"{4}/>'),P(C,"Rect",'<rect x = "{0}" y="{1}" width="{2}" height="{3}"{4}{5}{6}/>'),P(C,"RectCorners",' rx="{0}" ry="{1}"'),P(C,"Fill",' fill="{0}" fill-opacity="{1}"'),P(C,"Text",'<text {0} x = "{1}" y="{2}" font-size="{3}px" font-family="{4}" fill="{5}" {6} {7} xml:space="preserve">{8}</text>'),P(C,"ClipUrl",'clip-path="url(#ClipRect{0})"'),P(C,"Polygon",'<polygon points = "{0}"{1}{2}/>'),P(C,"Points","{0},{1}"),P(C,"ArcPath","M{0},{1} A{2},{3} 0 {4},1 {5},{6}"),P(C,"Path",'<path{0} d="{1}"/>'),P(C,"Ellipse",'<ellipse cx="{0}" cy="{1}" rx="{2}" ry="{3}" {4}/>'),P(C,"Png","data:image/png;base64,"),P(C,"Image",'<image x = "{0}" y="{1}" width="{2}" height="{3}" xlink:href="{4}"/>'),P(C,"NonScalingPen",' stroke="{0}" stroke-width="{1}px" vector-effect="non-scaling-stroke"'),P(C,"PenWidth",' stroke="{0}" stroke-width="{1}px"'),P(C,"StrokeDash",' stroke-dasharray="4"'),P(C,"StrokeDot",' stroke-dasharray="2"'),P(C,"StrokeDashDot",' stroke-dasharray="4 2"'),P(C,"StrokeDashDotDot",' stroke-dasharray="4 2 2"'),P(C,"TextDecorations",'text-decoration="{0}"'),P(C,"Underline","underline"),P(C,"Strikout","line-through"),P(C,"Delimiter"," "),P(C,"Weight",'font-weight="{0}"'),P(C,"Italic",'font-style="italic"'),P(C,"Rotate",'transform= "rotate({0} {1} {2})"'),P(C,"stubPreview",'<?xml version="1.0"  encoding="UTF-8" standalone="no"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100" height="100"><g id = "scene"><g id = "DocumentMainGroup"><g id = "BackgroundGroup"></g></g></g></svg>');var M=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,n=[{key:"normalizeAngle",value:function(t){for(var e=t;e>360;)e-=360;for(;e<0;)e+=360;return e}},{key:"GetPointFromAngle",value:function(t,e,r,n){return[t+r*Math.cos(this.toRadian(n)),e+r*Math.sin(this.toRadian(n))]}},{key:"getPointFromAngleForEllipse",value:function(t,e,r,n,i){var o=this.getRawVector2FromAngleForEllipse(t,e,r,n,i);return[Math.trunc(o[0]),Math.trunc(o[1])]}},{key:"getRawVector2FromAngleForEllipse",value:function(t,e,r,n,i){if(0==r||0==n)return[t,e];var o=this.toRadian(i),a=Math.cos(o),u=Math.sin(o),s=Math.sqrt(1/(Math.pow(a/r,2)+Math.pow(u/n,2)));return[t+s*a,e+s*u]}},{key:"toRadian",value:function(t){return t*Math.PI/180}}],(r=null)&&L(e.prototype,r),n&&L(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function D(t,e,r){return e&&T(t.prototype,e),r&&T(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function E(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var j,A,G=function(){function t(e){O(this,t),E(this,"offset",void 0),this.offset=e}return D(t,[{key:"transform",value:function(t){return[t[0]+this.offset[0],t[1]+this.offset[1]]}}]),t}(),_=function(){function t(e,r){O(this,t),E(this,"base",void 0),E(this,"angle",void 0),this.base=e,this.angle=M.toRadian(r)}return D(t,[{key:"transform",value:function(t){t[0]-=this.base[0],t[1]-=this.base[1];var e=Math.sin(this.angle),r=Math.cos(this.angle);return[t[0]*r-t[1]*e+this.base[0],t[0]*e+t[1]*r+this.base[1]]}}]),t}();function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function X(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t[t.Solid=0]="Solid",t[t.Dash=1]="Dash",t[t.Dot=2]="Dot",t[t.DashDot=3]="DashDot",t[t.DashDotDot=4]="DashDotDot"}(j||(j={})),function(t){t[t.Alternate=0]="Alternate",t[t.Winding=1]="Winding"}(A||(A={}));var I=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),X(this,"_content",""),X(this,"_size",[0,0]),X(this,"_origin",[0,0]),X(this,"totalClipCount",0),X(this,"currentClipCount",0),X(this,"transforms",[])}var e,r,n;return e=t,(r=[{key:"content",get:function(){return this._content}},{key:"size",get:function(){return[this._size[0]-this._origin[0],this._size[1]-this._origin[1]]}},{key:"origin",get:function(){return this._origin}},{key:"startDraw",value:function(t,e,r){this._size=e,this._origin=[0,0],this._content="",this.totalClipCount=0,this.currentClipCount=0,this.appendLine(C.XmlHeader),this.appendFmt(C.DocHeader,C.MetaInfo,t,this.getZoomStr(e[0]),this.getZoomStr(e[1]),r),this.appendLine()}},{key:"endDraw",value:function(){this.appendLine(C.DocFooter)}},{key:"beginGroup",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.GroupHeader;r=null!==(e=r)&&void 0!==e?e:C.GroupHeader,this.appendFmt(r,t)}},{key:"endGroup",value:function(){this.appendLine(C.GroupFooter)}},{key:"append",value:function(t){this._content=this._content+t._content,this.updateSize(t._size)}},{key:"appendLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this._content+="".concat(t,"\n")}},{key:"appendFmt",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];this._content=this._content+this.format.apply(this,[t].concat(r))}},{key:"format",value:function(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var r="{".concat(e,"}");t=t.replace(r,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}return t}},{key:"applyTransform",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.transforms.forEach((function(e){return t=e.transform(t)})),e&&this.updateSize(t),t}},{key:"updateSize",value:function(t){this._size[0]=Math.max(this._size[0],t[0]),this._size[1]=Math.max(this._size[1],t[1]),this._origin[0]=Math.min(this._origin[0],t[0]),this._origin[1]=Math.min(this._origin[1],t[1])}},{key:"applyZoom",value:function(t){var e=this.applyTransform([1,0],!1),r=this.applyTransform([0,0],!1),n=r[0]-e[0],i=r[1]-e[1];return Math.sqrt(n*n+i*i)*t}},{key:"getZoomStr",value:function(t){return this.applyZoom(t).toString()}},{key:"GetArcStr",value:function(t,e,r,n,i,o){for(var a=M.getPointFromAngleForEllipse(t,e,r,n,o),u=M.getPointFromAngleForEllipse(t,e,r,n,i),s=this.applyTransform(a),l=this.applyTransform(u),c=-o,h=-i;c<h;)c+=360;var f=c-h<=180?0:1;return this.format(C.ArcPath,s[0],s[1],this.getZoomStr(r),this.getZoomStr(n),f,l[0],l[1])}},{key:"drawArc",value:function(t,e,r,n,i,o,a){if(M.normalizeAngle(o)==M.normalizeAngle(a)){var u=this.applyTransform([e,r]);this.appendFmt(C.Ellipse,u[0],u[0],this.getZoomStr(n/2),this.getZoomStr(i/2),this.penToString(t))}else{var s=this.GetArcStr(e,r,n/2,i/2,o,a);this.appendFmt(C.Path,this.penToString(t),s)}this.appendLine()}},{key:"penToString",value:function(t){var e=t.color,r="";r=t.nonScaled?this.format(C.NonScalingPen,e,t.width):this.format(C.PenWidth,e,this.getZoomStr(t.width));var n="";switch(t.style){case j.Dash:n=C.StrokeDash;break;case j.Dot:n=C.StrokeDot;break;case j.DashDot:n=C.StrokeDashDot;break;case j.DashDotDot:n=C.StrokeDashDotDot}return r+n}},{key:"drawLine",value:function(t,e,r,n,i){var o=this.applyTransform([e,r]),a=this.applyTransform([n,i]);this.appendFmt(C.Line,o[0],o[1],a[0],a[1],this.penToString(t)),this.appendLine()}},{key:"drawLines",value:function(t,e){if(!(e.length<2))for(var r=0;r<e.length-2;r++)this.drawLine(t,e[r][0],e[r][1],e[r+1][0],e[r+1][1])}},{key:"drawBounds",value:function(t,e){this.drawRectangle(t,e[0],e[1],e[2],e[3])}},{key:"drawRectangle",value:function(t,e,r,n,i){var o=this.applyTransform([e,r]),a=this.applyTransform([n,i]);this.appendFmt(C.Rect,Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.abs(o[0]-a[0]),Math.abs(o[1]-a[1]),this.penToString(t),"",""),this.appendLine()}},{key:"appendStr",value:function(t,e,r){return t?e?t+r+e:t:e}},{key:"getTextStyle",value:function(t){var e="";if(t.underline||t.strikout){var r="";t.underline&&(r=C.Underline),t.strikout&&(r=this.appendStr(r,C.Strikout,C.Delimiter)),e=this.format(C.TextDecorations,r)}return t.weight&&(e=this.appendStr(e,this.format(C.Weight,t.weight),C.Delimiter)),t.italic&&(e=this.appendStr(e,C.Italic,C.Delimiter)),e}},{key:"drawString",value:function(t,e,r,n){var i=this.applyTransform([r,n]),o=Math.trunc(this.applyZoom(e.size));o=o<=0?1:o;var a=e.getSize(t),u=[r+a[0],n+a[1]],s="";if(0!=e.rotation){i=M.GetPointFromAngle(i[0],i[1],o,e.rotation+90),s=this.format(C.Rotate,e.rotation,i[0],i[1]);var l=new _(i,e.rotation);this.applyTransform(l.transform(u))}else i[1]+=o,this.applyTransform(u);var c="";this.currentClipCount>0&&(c=this.format(C.ClipUrl,this.totalClipCount)),this.appendFmt(C.Text,c,i[0],i[1],o,e.name,e.color,this.getTextStyle(e),s,t),this.appendLine()}},{key:"pointsToString",value:function(t){for(var e="",r=0;r<t.length;r++){e.length>0&&(e+=C.Delimiter);var n=this.applyTransform([t[r][0],t[r][1]]);e+=this.format(C.Points,n[0],n[1])}return e}},{key:"drawPolygons",value:function(t,e){for(var r=0;r<e.length;r++)this.appendFmt(C.Polygon,this.pointsToString(e[r]),this.penToString(t),"")}},{key:"fillPolygons",value:function(t,e){for(var r=0;r<e.length;r++)this.appendFmt(C.Polygon,this.pointsToString(e[r]),"",this.brushToString(t))}},{key:"brushToString",value:function(t){return this.format(C.Fill,t.color,t.opacity)}},{key:"fillBounds",value:function(t,e){this.fillRectangle(t,e[0],e[1],e[2],e[3])}},{key:"fillRectangle",value:function(t,e,r,n,i){var o=this.applyTransform([e,r]),a=this.applyTransform([n,i]);this.appendFmt(C.Rect,Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.abs(o[0]-a[0]),Math.abs(o[1]-a[1]),"","",this.brushToString(t)),this.appendLine()}},{key:"resetClip",value:function(){this.currentClipCount=0}},{key:"pushTransform",value:function(t){this.transforms.push(t)}},{key:"popTransform",value:function(){this.transforms.pop()}},{key:"pushClip",value:function(t,e,r,n){this.totalClipCount++,this.currentClipCount++;var i=this.applyTransform([t,e]),o=this.applyTransform([r,n]);this.appendFmt(C.ClipGroupHeader,this.totalClipCount,Math.min(i[0],o[0]),Math.min(i[1],o[1]),Math.abs(i[0]-o[0]),Math.abs(i[1]-o[1]))}},{key:"popClip",value:function(){this.appendFmt(C.GroupFooter),this.currentClipCount--}},{key:"drawRoundedRectangle",value:function(t,e,r,n,i,o,a){var u=this.applyTransform([e,r]),s=this.applyTransform([n,i]),l="";0==o&&0==a||(l=this.format(C.RectCorners,this.getZoomStr(o),this.getZoomStr(a))),this.appendFmt(C.Rect,Math.min(u[0],s[0]),Math.min(u[1],s[1]),Math.abs(u[0]-s[0]),Math.abs(u[1]-s[1]),this.penToString(t),l,""),this.appendLine()}},{key:"fillRoundedRectangle",value:function(t,e,r,n,i,o,a){var u=this.applyTransform([e,r]),s=this.applyTransform([n,i]),l="";0==o&&0==a||(l=this.format(C.RectCorners,this.getZoomStr(o),this.getZoomStr(a)));var c=this.brushToString(t);this.appendFmt(C.Rect,Math.min(u[0],s[0]),Math.min(u[1],s[1]),Math.abs(u[0]-s[0]),Math.abs(u[1]-s[1]),"",l,c),this.appendLine()}}])&&F(e.prototype,r),n&&F(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function N(t,e,r){return(N=B()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&V(i,r.prototype),i}).apply(null,arguments)}function B(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function V(t,e){return(V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function H(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return R(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function U(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Y(t,e,r){return e&&U(t.prototype,e),r&&U(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var W=Y((function t(){z(this,t)}));Z(W,"FixedMM",4),Z(W,"FixedMIL",3),Z(W,"DefaultFontName","Segoe UI, Helvetica, Arial, sans-serif"),Z(W,"DefaultFontSize",8),Z(W,"DefaultFontColor","#080A0A"),Z(W,"DefaultFontWeight","normal"),Z(W,"DefaultPenColor","#000000"),Z(W,"DefaultPenStyle",j.Solid),Z(W,"DefaultPenWidth",1),Z(W,"DefaultPenNonScaled",!0),Z(W,"DefaultBrushColor","#FFFFFF"),Z(W,"DefaultBrushOpacity",1),Z(W,"TransparentOpacity",0),Z(W,"ColumnNo","#"),Z(W,"ColumnThk","THK"),Z(W,"ColumnName","NAME"),Z(W,"ColumnType","TYPE"),Z(W,"ColumnGap",20),Z(W,"Scale",8),Z(W,"Margin",30),Z(W,"HeaderGap",1),Z(W,"LayerToTextGap",32),Z(W,"DefaultThickness",2),Z(W,"MinViaCount",5),Z(W,"ViaZoneWidth",50),Z(W,"ViaPadDX",18),Z(W,"ViaOuterDX",10),Z(W,"ViaInnerDX",5),Z(W,"ViaOuterMDX",7),Z(W,"ViaInnerMDX",3),Z(W,"CopperObjectLongDX",9),Z(W,"CopperObjectShortDX",6),Z(W,"Scene","scene"),Z(W,"MainGroup","DocumentMainGroup"),Z(W,"BackgroundGroup","BackgroundGroup");var q=function(){function t(){var e,r,n,i;z(this,t),Z(this,"name",void 0),Z(this,"size",void 0),Z(this,"color",void 0),Z(this,"rotation",void 0),Z(this,"weight",void 0),Z(this,"italic",void 0),Z(this,"strikout",void 0),Z(this,"underline",void 0),this.name=null!==(e=arguments.length<=0?void 0:arguments[0])&&void 0!==e?e:W.DefaultFontName,this.size=null!==(r=arguments.length<=1?void 0:arguments[1])&&void 0!==r?r:W.DefaultFontSize,this.color=null!==(n=arguments.length<=2?void 0:arguments[2])&&void 0!==n?n:W.DefaultFontColor,this.weight=null!==(i=arguments.length<=3?void 0:arguments[3])&&void 0!==i?i:W.DefaultFontWeight,this.rotation=0,this.italic=!1,this.strikout=!1,this.underline=!1}return Y(t,[{key:"getSize",value:function(t){return[this.size/2.3*t.length,this.size+4]}}]),t}(),$=Y((function t(){var e,r,n,i;z(this,t),Z(this,"color",void 0),Z(this,"width",void 0),Z(this,"style",void 0),Z(this,"nonScaled",void 0),this.color=null!==(e=arguments.length<=0?void 0:arguments[0])&&void 0!==e?e:W.DefaultPenColor,this.width=null!==(r=arguments.length<=1?void 0:arguments[1])&&void 0!==r?r:W.DefaultPenWidth,this.style=null!==(n=arguments.length<=2?void 0:arguments[2])&&void 0!==n?n:W.DefaultPenStyle,this.nonScaled=null!==(i=arguments.length<=3?void 0:arguments[3])&&void 0!==i?i:W.DefaultPenNonScaled})),K=Y((function t(){var e,r;z(this,t),Z(this,"color",void 0),Z(this,"opacity",void 0),this.color=null!==(e=arguments.length<=0?void 0:arguments[0])&&void 0!==e?e:W.DefaultBrushColor,this.opacity=(null!==(r=arguments.length<=1?void 0:arguments[1])&&void 0!==r?r:arguments.length<=0?void 0:arguments[0])?W.DefaultBrushOpacity:W.TransparentOpacity})),J=function(){function t(e){var r;z(this,t),Z(this,"defaultFields",[W.ColumnNo,W.ColumnName,W.ColumnType,W.ColumnThk]),Z(this,"defaultBrushes",new Map([["Background",["#E9E9E9"]],["Overlay",["#9AAF89"]],["Solder Mask",["#29763C"]],["Dielectric",["#5E5747"]],["Core",["#5E5747"]],["Prepreg",["#AA9E81"]],["Non-Conductive",["#AA9E81"]],["Plane",["#DBAB61"]],["Signal",["#000000",0]],["ViaBarrel",["#CDB475"]],["ViaHole",["#E8C8A4"]],["ViaSkip",["#DEB984"]],["Grid",["#DADADA"]],["CopperObject",["#CDA86C"]],["Debug",["#FF0000"]]])),Z(this,"defaultFonts",new Map([["TableHeader",[W.DefaultFontName,W.DefaultFontSize,"#727272"]],["TableData",[W.DefaultFontName,W.DefaultFontSize,"#080A0A"]]])),Z(this,"defaultPens",new Map([["Overlay",["#707A69"]],["Solder Mask",["#1C582B"]],["Dielectric",["#4B4537"]],["Core",["#4B4537"]],["Prepreg",["#575252"]],["Non-Conductive",["#575252"]],["Plane",["#655337"]],["Via",["#5C5134"]],["Debug",["#FF0000"]],["Callout",["#9E9E9E"]],["CopperObject",["#7E6E53"]]])),Z(this,"fields",void 0),Z(this,"brushes",void 0),Z(this,"fonts",void 0),Z(this,"pens",void 0),this.fields=null!==(r=null==e?void 0:e.fields)&&void 0!==r?r:this.defaultFields,this.brushes=this.merge(null==e?void 0:e.brushes,this.defaultBrushes),this.fonts=this.merge(null==e?void 0:e.fonts,this.defaultFonts),this.pens=this.merge(null==e?void 0:e.pens,this.defaultPens)}return Y(t,[{key:"getBrush",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.brushes.get(t);return r?N(K,H(r)):e?null:new K}},{key:"getFont",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.fonts.get(t);return r?N(q,H(r)):e?null:new q}},{key:"getPen",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.pens.get(t);return r?N($,H(r)):e?null:new $}},{key:"merge",value:function(t,e){return t?new Map([].concat(H(e),H(t))):e}}]),t}();function Q(t){return function(t){if(Array.isArray(t))return tt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return tt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rt(t,e,r){return e&&et(t.prototype,e),r&&et(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function it(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ot=rt((function t(e,r,n){nt(this,t),it(this,"text",void 0),it(this,"size",void 0),it(this,"position",void 0),it(this,"unit",void 0),this.text=e,this.size=r.getSize(e),this.unit=n,this.position=[0,0]})),at=rt((function t(e,r){nt(this,t),it(this,"height",void 0),it(this,"position",void 0),it(this,"cells",void 0),this.cells=e,this.height=Math.max.apply(Math,Q(e.map((function(t){return t.size[1]}))))+r,this.position=0})),ut=rt((function t(e){nt(this,t),it(this,"width",void 0),it(this,"position",void 0),it(this,"cells",void 0),this.cells=e,this.width=Math.max.apply(Math,Q(e.map((function(t){return t.size[0]})))),this.position=0})),st=function(){function t(e){nt(this,t),it(this,"_width",void 0),it(this,"_rows",void 0),it(this,"_cols",void 0),it(this,"cells",void 0),it(this,"units",void 0),this.clear(),this.units=e}return rt(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._rows.length}},{key:"rows",get:function(){return this._rows}},{key:"columns",get:function(){return this._cols}},{key:"clear",value:function(){this._width=0,this._cols=[],this._rows=[],this.cells=[],this.units=[]}},{key:"add",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=t.map((function(t,n){return new ot(t,e,r.units&&r.units[n])}));this._width=Math.max(this._width,t.length),this.cells.push(i);var o=new at(i,n);return this._rows.push(o),o}},{key:"align",value:function(t){var e=this;this._cols=[];for(var r=0;r<this.width;r++){var n=this.cells.map((function(t){return t[r]}));this._cols.push(new ut(n))}t.forEach((function(t){return t.align(e)}))}}]),t}(),lt=r(386);function ct(t){return function(t){if(Array.isArray(t))return ht(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return ht(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ht(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ft(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function dt(t,e){var r=t.properties.find((function(t){return"Thickness"===t.name}));if(r){var n,i,o=e?null===(n=r.valueInMms)||void 0===n?void 0:n.replace("mm",""):null===(i=r.valueInMils)||void 0===i?void 0:i.replace("mil","");return o?Number.parseFloat(o):0}return 0}function yt(t){return"Signal"===t.typeName||"Plane"===t.typeName||"Conductive"===t.typeName}var vt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),pt(this,"fields",void 0),pt(this,"counter",void 0),this.fields=e;var r=e.indexOf(W.ColumnThk);this.counter={mmTotal:0,milTotal:0,layerNo:1,columnNo:0,colTotal:r>0?e[r-1]:null}}var e,r,n;return e=t,(r=[{key:"getColumnHeaders",value:function(){return this.getValues(null,this.getColumnHeader)}},{key:"getColumnValues",value:function(t){return this.getValues(t,this.getColumnValue)}},{key:"getColumnUnits",value:function(){return this.getValues(null,this.getColumnUnit)}},{key:"getColumnFooters",value:function(){return this.getValues(null,this.getColumnFooter)}},{key:"getColumnIndexes",value:function(){return this.getValues(null,this.getColumnIndex)}},{key:"getValues",value:function(t,e){var r=this,n=[];return this.fields.forEach((function(i){return n.push.apply(n,ct(e(i,t,r.counter)))})),n}},{key:"getColumnHeader",value:function(t,e,r){switch(t){case W.ColumnNo:return[""];case W.ColumnThk:return["Thk (mm)","Thk (mil)"];case W.ColumnName:return["Layer"];case W.ColumnType:return["Type"];default:return[""]}}},{key:"getColumnValue",value:function(t,e,r){switch(t){case W.ColumnNo:return[yt(e)?(r.layerNo++).toString():"-"];case W.ColumnThk:var n=dt(e,!0),i=dt(e,!1),o=0===n?"":n.toFixed(W.FixedMM),a=0===i?"":i.toFixed(W.FixedMIL);return r.mmTotal+=n,r.milTotal+=i,[o,a];case W.ColumnName:return[e.name];case W.ColumnType:return[e.typeName];default:return[""]}}},{key:"getColumnUnit",value:function(t,e,r){switch(t){case W.ColumnThk:return[lt.b,lt.a];default:return[null]}}},{key:"getColumnFooter",value:function(t,e,r){switch(t){case W.ColumnThk:return[r.mmTotal.toFixed(W.FixedMM),r.milTotal.toFixed(W.FixedMIL)];default:return t===r.colTotal?["Total"]:[""]}}},{key:"getColumnIndex",value:function(t,e,r){var n=r.columnNo;switch(r.columnNo++,t){case W.ColumnThk:return[n,n];default:return[n]}}}])&&ft(e.prototype,r),n&&ft(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function gt(t){return function(t){if(Array.isArray(t))return mt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return mt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kt(t,e,r){return e&&wt(t.prototype,e),r&&wt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function St(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var xt=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;bt(this,t),St(this,"gap",void 0),St(this,"offset",void 0),St(this,"indexMap",void 0),this.gap=r,this.offset=e,this.indexMap=n}return kt(t,[{key:"align",value:function(t){this.indexMap&&this.indexMap.length===t.columns.length&&this.indexMap.reduce((function(e,r,n){return e[r]=[].concat(gt(e[r]||[]),[t.columns[n]]),e}),[]).filter((function(t){return t.length>1})).forEach((function(t){var e=Math.max.apply(Math,gt(t.map((function(t){return t.width}))));t.forEach((function(t){return t.width=e}))}));for(var e=Math.trunc(this.gap/2),r=this.offset,n=0,i=0,o=0;o<t.width;o++){var a,u=null!==(a=this.indexMap&&this.indexMap[o])&&void 0!==a?a:o,s=t.columns[o];n!==u&&(r=r+i+this.gap),s.position=r,s.width=s.width+this.gap,s.cells.forEach((function(t){return t.position[0]=r+e})),n=u,i=s.width}}}]),t}(),Pt=function(){function t(e,r){bt(this,t),St(this,"gap",void 0),St(this,"rowBases",void 0),St(this,"rowCenters",void 0),this.gap=e,this.rowBases=r,this.rowCenters=r.map((function(t){return t[2]}))}return kt(t,[{key:"align",value:function(t){var e=t.rows;if(e.length===this.rowBases.length){var r,n;if(e.length%2==0)r=(n=t.rows.length/2)-1;else{var i=Math.trunc(t.rows.length/2);r=i-1,n=i+1}this.alignTextsUp(t,r),this.alignTextsDown(t,n),this.setTextPositions(t),this.expandRowHeights(t)}}},{key:"alignTextsUp",value:function(t,e){for(var r=e;r>=0;r--){var n=this.rowCenters[r+1],i=this.rowCenters[r];if(-1!=i){var o=t.rows[r].height-(n-i);o>0&&(this.rowCenters[r]-=o)}else this.rowCenters[r]=n-this.gap-t.rows[r].height}}},{key:"alignTextsDown",value:function(t,e){for(var r=e;r<t.rows.length;r++){var n=this.rowCenters[r-1],i=this.rowCenters[r];if(-1!=i){var o=t.rows[r].height-(i-n);o>0&&(this.rowCenters[r]+=o)}else this.rowCenters[r]=n+this.gap+t.rows[r].height}}},{key:"setTextPositions",value:function(t){for(var e=this,r=function(){var r=t.rows[n];r.position=e.rowCenters[n]-r.height/2,r.cells.forEach((function(t){return t.position[1]=r.position}))},n=0;n<t.rows.length;n++)r()}},{key:"expandRowHeights",value:function(t){for(var e=0;e<t.rows.length;e++)if(-1!==this.rowBases[e][2]){var r=t.rows[e-1],n=t.rows[e],i=t.rows[e+1],o=n.position-Math.max(this.rowBases[e][0],r.position+r.height);o>0&&(n.position-=o,n.height+=o);var a=Math.min(this.rowBases[e][1],i.position)-(n.position+n.height);a>0&&(n.height+=a)}}}]),t}(),Ct=r(451);function Lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ot=function(){function t(e,r,n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Mt(this,"id",void 0),Mt(this,"skip",void 0),Mt(this,"micro",void 0),Mt(this,"baseX",void 0),Mt(this,"baseY",void 0),this.id=e.id,this.skip=e.type==Ct.b.SkipMicroVia,this.micro=e.type==Ct.b.SkipMicroVia||e.type==Ct.b.StackedMicroVia,this.baseX=i,this.baseY=o>0?[r[1],r[3],n[1],n[3]]:[r[3],r[1],n[3],n[1]]}var e,r,n;return e=t,(r=[{key:"innerMX1",get:function(){return this.baseX-W.ViaInnerMDX}},{key:"innerMX2",get:function(){return this.baseX+W.ViaInnerMDX}},{key:"outerMX1",get:function(){return this.baseX-W.ViaOuterMDX}},{key:"outerMX2",get:function(){return this.baseX+W.ViaOuterMDX}},{key:"innerX1",get:function(){return this.baseX-W.ViaInnerDX}},{key:"innerX2",get:function(){return this.baseX+W.ViaInnerDX}},{key:"outerX1",get:function(){return this.baseX-W.ViaOuterDX}},{key:"outerX2",get:function(){return this.baseX+W.ViaOuterDX}},{key:"padX1",get:function(){return this.baseX-W.ViaPadDX}},{key:"padX2",get:function(){return this.baseX+W.ViaPadDX}},{key:"hole",get:function(){return this.micro?this.getMicroHole():this.getThruHole()}},{key:"contour",get:function(){return this.micro?this.getMicroContour():this.getThruContour()}},{key:"getThruHole",value:function(){return[[this.innerX1,this.baseY[0]],[this.innerX2,this.baseY[0]],[this.innerX2,this.baseY[3]],[this.innerX1,this.baseY[3]],[this.innerX1,this.baseY[0]]]}},{key:"getMicroHole",value:function(){return[[this.innerX1,this.baseY[0]],[this.innerX2,this.baseY[0]],[this.innerX2,this.baseY[1]],[this.innerMX2,this.baseY[2]],[this.innerMX1,this.baseY[2]],[this.innerX1,this.baseY[1]],[this.innerX1,this.baseY[0]]]}},{key:"getThruContour",value:function(){return[[this.padX1,this.baseY[0]],[this.padX2,this.baseY[0]],[this.padX2,this.baseY[1]],[this.outerX2,this.baseY[1]],[this.outerX2,this.baseY[2]],[this.padX2,this.baseY[2]],[this.padX2,this.baseY[3]],[this.padX1,this.baseY[3]],[this.padX1,this.baseY[2]],[this.outerX1,this.baseY[2]],[this.outerX1,this.baseY[1]],[this.padX1,this.baseY[1]],[this.padX1,this.baseY[0]]]}},{key:"getMicroContour",value:function(){return[[this.padX1,this.baseY[0]],[this.padX2,this.baseY[0]],[this.padX2,this.baseY[1]],[this.outerX2,this.baseY[1]],[this.outerMX2,this.baseY[2]],[this.padX2,this.baseY[2]],[this.padX2,this.baseY[3]],[this.padX1,this.baseY[3]],[this.padX1,this.baseY[2]],[this.outerMX1,this.baseY[2]],[this.outerX1,this.baseY[1]],[this.padX1,this.baseY[1]],[this.padX1,this.baseY[0]]]}}])&&Lt(e.prototype,r),n&&Lt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Tt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Dt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Et,jt=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Dt(this,"y1",void 0),Dt(this,"y2",void 0),Dt(this,"baseX",void 0),Dt(this,"orientation",void 0),this.baseX=r,this.orientation=n,this.y1=n?e[3]:e[1],this.y2=n?e[1]:e[3]}var e,r,n;return e=t,(r=[{key:"longX1",get:function(){return this.baseX-W.CopperObjectLongDX}},{key:"longX2",get:function(){return this.baseX+W.CopperObjectLongDX}},{key:"shortX1",get:function(){return this.baseX-W.CopperObjectShortDX}},{key:"shortX2",get:function(){return this.baseX+W.CopperObjectShortDX}},{key:"contour",get:function(){return this.getContour()}},{key:"getContour",value:function(){return[[this.shortX1,this.y1],[this.shortX2,this.y1],[this.longX2,this.y2],[this.longX1,this.y2],[this.shortX1,this.y1]]}}])&&Tt(e.prototype,r),n&&Tt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function At(t){return function(t){if(Array.isArray(t))return Gt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Gt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ft(t,e,r){return e&&_t(t.prototype,e),r&&_t(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Xt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function It(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t[t.Layers=1]="Layers",t[t.Table=2]="Table",t[t.Vias=4]="Vias",t[t.Preview=5]="Preview",t[t.All=7]="All"}(Et||(Et={}));var Nt=Ft((function t(){Xt(this,t),It(this,"stack",void 0),It(this,"dataFont",void 0),It(this,"headerFont",void 0),It(this,"table",void 0),It(this,"rows",void 0),It(this,"columns",void 0),It(this,"electricCount",void 0),It(this,"drawLayers",void 0),It(this,"drawTable",void 0),It(this,"drawVias",void 0),It(this,"drawCallout",void 0)})),Bt=function(){function t(){Xt(this,t),It(this,"layer",void 0),It(this,"electricNo",void 0),It(this,"thickness",void 0),It(this,"layerBox",void 0),It(this,"text",void 0)}return Ft(t,[{key:"getLayerCY",value:function(){return this.layerBox[1]+(this.layerBox[3]-this.layerBox[1])/2}},{key:"getRowBase",value:function(){return[this.layerBox[1],this.layerBox[3],this.getLayerCY()]}}]),t}(),Vt=function(){function t(){Xt(this,t),It(this,"options",void 0)}return Ft(t,[{key:"draw",value:function(t,e){this.options=new J(e);var r=new I;r.pushTransform(new G([W.Margin,W.Margin]));var n=this.calculateStack(t.stackup.stacks[0],Et.All);return this.drawStack(r,n),this.drawDocument(t.id,r,W.Margin)}},{key:"drawPreview",value:function(t,e){this.options=new J(e);var r=new I,n=this.calculateStack(t.stackup.stacks[0],Et.Preview);return this.drawStack(r,n),this.drawDocument(t.id,r,0)}},{key:"drawDocument",value:function(t,e,r){var n=new I,i=[e.size[0]+r,e.size[1]+r],o=function(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var r="{".concat(e,"}");t=t.replace(r,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}return t}(C.SvgStyles,"rect","rect","none");return n.startDraw(o,i,t),n.beginGroup(W.Scene),n.beginGroup(W.MainGroup),n.beginGroup(W.BackgroundGroup),n.fillRectangle(this.options.getBrush("Background"),0,0,i[0],i[1]),n.append(e),n.endGroup(),n.endGroup(),n.endGroup(),n.endDraw(),n.content}},{key:"calculateStack",value:function(t,e){var r=new Nt;r.stack=t,r.electricCount=0,r.dataFont=this.options.getFont("TableData"),r.headerFont=this.options.getFont("TableHeader"),r.drawVias=0!=(e&Et.Vias),r.drawTable=0!=(e&Et.Table),r.drawLayers=0!=(e&Et.Layers),r.drawCallout=(r.drawLayers||r.drawVias)&&r.drawTable,r.columns=Math.max(t.viaSpans.length,W.MinViaCount),r.rows=t.layers.filter((function(t){return t.isSupported})).map((function(t){var e=yt(t);r.electricCount+=e?1:0;var n=new Bt;return n.layer=t,n.electricNo=e?r.electricCount:0,n.thickness=r.drawLayers?dt(t,!1):W.DefaultThickness,n}));var n=r.drawLayers||r.drawVias?r.columns*W.ViaZoneWidth:0;return this.fillGraphics(n,r),r.drawTable&&this.fillTable(r,r.drawCallout?n+W.LayerToTextGap:0),r}},{key:"fillGraphics",value:function(t,e){var r=0,n=Math.min.apply(Math,At(e.rows.map((function(t){return t.thickness})).filter((function(t){return t>0}))));e.rows.forEach((function(e){var i=r+Math.max(e.thickness,n)*W.Scale;e.layerBox=[0,r,t,i],r=i}))}},{key:"fillTable",value:function(t,e){var r=new vt(this.options.fields);t.table=new st(r.getColumnUnits()),t.table.add(r.getColumnHeaders(),t.headerFont,W.HeaderGap),t.rows.forEach((function(e){e.text=t.table.add(r.getColumnValues(e.layer),t.dataFont)})),t.table.add(r.getColumnFooters(),t.headerFont,W.HeaderGap);var n=[0,0,-1],i=[n].concat(At(t.rows.map((function(t){return t.getRowBase()}))),[n]);t.table.align([new xt(e,W.ColumnGap,r.getColumnIndexes()),new Pt(W.HeaderGap,i)])}},{key:"drawStack",value:function(t,e){if(e.drawTable){var r=e.table.rows[0];r.position<0&&t.pushTransform(new G([0,Math.abs(r.position)])),this.drawCells(t,r.cells,e.headerFont)}if((e.drawLayers||e.drawTable)&&this.drawLayers(t,e),e.drawVias&&this.drawVias(t,e.stack.viaSpans,e),e.drawTable){var n=e.table.rows[0],i=e.table.rows[e.table.height-1];e.drawTable&&this.drawCells(t,i.cells,e.headerFont),n.position<0&&t.popTransform()}}},{key:"drawLayers",value:function(t,e){var r=this,n=1,i=this.options.getBrush("Grid"),o=this.options.getBrush("Background"),a=this.options.getPen("Callout");e.rows.forEach((function(u){e.drawLayers&&r.drawGroup(t,"".concat(u.layer.id,":I"),null,(function(){var e=r.options.getBrush(u.layer.typeName);e&&t.fillBounds(e,u.layerBox);var n=r.options.getPen(u.layer.typeName,!0);n&&t.drawBounds(n,u.layerBox)})),e.drawTable&&(r.drawGroup(t,"".concat(u.layer.id,":T"),null,(function(){var r=e.table.columns[0].position,a=u.text.position,s=e.table.columns[e.table.width-1].position+e.table.columns[e.table.width-1].width,l=u.text.position+u.text.height;t.fillRectangle(n%2==0?o:i,r,a,s,l)})),r.drawCells(t,u.text.cells,e.dataFont),e.drawCallout&&r.drawGroup(t,"".concat(u.layer.id,":C"),null,(function(){var r=u.layerBox[2],n=u.getLayerCY(),i=e.table.columns[0].position,o=u.text.position+u.text.height/2;t.drawLine(a,r,n,i,o)}))),n++}))}},{key:"drawGroup",value:function(t,e,r,n){e&&t.beginGroup(e,r),n(),e&&t.endGroup()}},{key:"drawCells",value:function(t,e,r){var n=this;e.forEach((function(e){n.drawGroup(t,e.unit,C.UnitGroupHeader,(function(){t.drawString(e.text,r,e.position[0],e.position[1]+1)}))}))}},{key:"drawVias",value:function(t,e,r){var n=this,i=-W.ViaZoneWidth/2;e.forEach((function(e){var o=n.getStartStopLayer(e,r);if(-1!==o.start&&-1!==o.stop){var a=[];if(a.push(n.drawVia(t,e,r,o.start,o.stop,i+=W.ViaZoneWidth,o.direction)),e.isSymmetric){var u=r.electricCount-r.rows[o.start].electricNo+1,s=r.electricCount-r.rows[o.stop].electricNo+1;u=r.rows.findIndex((function(t){return t.electricNo===u})),s=r.rows.findIndex((function(t){return t.electricNo===s})),-1!==u&&-1!==s&&a.push(n.drawVia(t,e,r,u,s,i,-o.direction))}var l=n.options.getPen("Via");n.drawGroup(t,"".concat(a[0].id),null,(function(){a.forEach((function(e){return t.drawPolygons(l,[e.contour])}))}))}})),this.range(r.columns-e.length).forEach((function(e){return n.drawCopperObjects(t,r,-1,-1,i+=W.ViaZoneWidth)}))}},{key:"getStartStopLayer",value:function(t,e){var r=e.rows.findIndex((function(e){return e.layer.id===t.startLayerId})),n=e.rows.findIndex((function(e){return e.layer.id===t.stopLayerId}));return{start:r,stop:n,direction:r<n?1:-1}}},{key:"drawVia",value:function(t,e,r,n,i,o,a){var u=this.options.getPen("Via"),s=this.options.getBrush("ViaBarrel"),l=this.options.getBrush("ViaHole"),c=new Ot(e,r.rows[n].layerBox,r.rows[i].layerBox,o,a);return c.skip&&this.drawSkipPlanes(t,r,c,n,i),t.fillPolygons(s,[c.contour]),t.fillPolygons(l,[c.hole]),t.drawPolygons(u,[c.hole]),c.micro&&t.drawLine(u,c.innerX1,c.baseY[1],c.innerX2,c.baseY[1]),this.drawCopperObjects(t,r,n,i,o),c}},{key:"drawSkipPlanes",value:function(t,e,r,n,i){var o=Math.min(n,i)+1,a=Math.max(n,i)-1;if(!(o>=a))for(var u=this.options.getPen("Via"),s=this.options.getBrush("ViaSkip"),l=o;l<=a;l++){var c=e.rows[l];if("Plane"===c.layer.typeName){var h=c.layerBox[1],f=c.layerBox[3],p=[r.padX1,h+u.width/2,r.padX2,f-u.width/2];t.fillBounds(s,p),t.drawLine(u,r.padX1,h,r.padX1,f),t.drawLine(u,r.padX2,h,r.padX2,f)}}}},{key:"drawCopperObjects",value:function(t,e,r,n,i){for(var o=Math.min(r,n),a=Math.max(r,n),u=this.options.getPen("CopperObject"),s=this.options.getBrush("CopperObject"),l=0;l<e.rows.length;l++)if(!(l>=o&&l<=a)){var c=e.rows[l];if("Signal"==c.layer.typeName){var h=c.layer.properties.find((function(t){return"CopperOrientation"===t.name}));if(h){var f=new jt(c.layerBox,i,Number.parseInt(h.text));t.fillPolygons(s,[f.contour]),t.drawPolygons(u,[f.contour])}}}}},{key:"range",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return At(Array(t).keys()).map((function(t){return t+e}))}}]),t}();function Ht(t){return(Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Rt=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function s(t,e,r,n){var i=e&&e.prototype instanceof h?e:h,o=Object.create(i.prototype),a=new x(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return C()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var u=w(a,r);if(u){if(u===c)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===c)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(t,r,a),o}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var c={};function h(){}function f(){}function p(){}var d={};u(d,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&r.call(v,i)&&(d=v);var g=p.prototype=h.prototype=Object.create(d);function m(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var n;this._invoke=function(i,o){function a(){return new e((function(n,a){!function n(i,o,a,u){var s=l(t[i],t,o);if("throw"!==s.type){var c=s.arg,h=c.value;return h&&"object"==Ht(h)&&r.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,a,u)}),(function(t){n("throw",t,a,u)})):e.resolve(h).then((function(t){c.value=t,a(c)}),(function(t){return n("throw",t,a,u)}))}u(s.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return c;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=l(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,c;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,c):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,c)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function P(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:C}}function C(){return{value:void 0,done:!0}}return f.prototype=p,u(g,"constructor",p),u(p,"constructor",f),f.displayName=u(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,u(t,a,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},m(b.prototype),u(b.prototype,o,(function(){return this})),t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(s(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},m(g),u(g,a,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=P,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),s=r.call(o,"finallyLoc");if(u&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,c):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),c},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),c}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;S(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:P(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},t}function Ut(t,e,r,n,i,o,a){try{var u=t[o](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,i)}function Yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Zt=function(){function t(e,r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),zt(this,"logger",void 0),zt(this,"dataHelper",void 0),zt(this,"hintHelper",void 0),zt(this,"contourHelper",void 0),this.logger=e,this.dataHelper=r,this.hintHelper=i,this.contourHelper=n}var e,r,n,i,o;return e=t,(r=[{key:"getOtoDistance",value:function(t,e,r){var n=this,i={state:"Failed",pcbId1:t,pcbId2:e,object1:this.dataHelper.getPcbPrimitiveDescriptionById(t),object2:this.dataHelper.getPcbPrimitiveDescriptionById(e)};try{var o=this.dataHelper.getNodeItemById(t),a=this.dataHelper.getNodeItemById(e);if(!o||!a)return i;var u=this.contourHelper.getContour(this.dataHelper.getPrimitiveGeometry(o,r.includes(t))),s=this.contourHelper.getContour(this.dataHelper.getPrimitiveGeometry(a,r.includes(e)));if(0===u.length||0===s.length)return i;setTimeout((function(){return n.getOtoDistanceResult(t,e,u,s)}),0),i.state="Started"}catch(t){this.logger.LogError(null==t?void 0:t.stack),i.state="Failed"}return i}},{key:"getOtoDistanceResult",value:(i=Rt().mark((function t(e,r,n,i){var o,a,s,l,c,h,f;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={pcbId1:e,pcbId2:r,distance:0,point1:null,point2:null,state:"Failed",flattened:!1,time:0},s=Date.now(),l=null,t.prev=3,t.next=6,this.contourHelper.getClosestDistance(n,i);case 6:l=t.sent,t.next=13;break;case 9:t.prev=9,t.t0=t.catch(3),this.logger.LogError(null===t.t0||void 0===t.t0?void 0:t.t0.stack),l=null;case 13:a.time=Date.now()-s,l&&(a.state="Completed",a.point1=l.point1,a.point2=l.point2,a.distance=l.distance,a.flattened=(null===(c=l.contour1)||void 0===c?void 0:c.layerIndex)!=(null===(h=l.contour2)||void 0===h?void 0:h.layerIndex)),window.__CORE__.bus.emit("SupportLibrary:getOtoDistanceResult",a),l&&null!==(o=this.hintHelper)&&void 0!==o&&o.mode&&((f=Array.from(n).concat(i))[0].addLine([l.point1,l.point2],u.Both),this.hintHelper.showContour(f));case 17:case"end":return t.stop()}}),t,this,[[3,9]])})),o=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=i.apply(t,e);function a(t){Ut(o,r,n,a,u,"next",t)}function u(t){Ut(o,r,n,a,u,"throw",t)}a(void 0)}))},function(t,e,r,n){return o.apply(this,arguments)})},{key:"lsmToSvg",value:function(t,e,r){var n={svg:C.stubPreview,state:"Failed"};if(t)try{var i=new Vt;n.svg="Preview"===r?i.drawPreview(t,e):i.draw(t,e),n.state="Completed"}catch(t){this.logger.LogError(null==t?void 0:t.stack)}return n}}])&&Yt(e.prototype,r),n&&Yt(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Wt=r(239),qt=r(21);function $t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Kt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Jt;!function(t){t[t.None=0]="None",t[t.Signal=1]="Signal",t[t.Other=2]="Other"}(Jt||(Jt={}));var Qt,te,ee=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Kt(this,"layerManager",void 0),Kt(this,"layerMap",new Map),Kt(this,"holeLayers",[])}var e,r,n;return e=t,(r=[{key:"setup",value:function(t){var e=this;this.layerManager=t;var r=this.layerManager.getLayers();this.holeLayers=r.filter((function(t){return e.isHolesLayer(t)})).map((function(t){return t.id})),this.setLayers(r.filter((function(t){return!e.isHolesLayer(t)})))}},{key:"setLayers",value:function(t){var e=this;this.layerMap=new Map,t.forEach((function(t){var r={};Object.assign(r,t),e.layerMap.set(r.id,r)}))}},{key:"setLayerOnly",value:function(t){var e,r,n=this;this.layerMap.forEach((function(t){return t.isVisible=!1}));var i=null===(e=this.layerManager)||void 0===e||null===(r=e.getLayers())||void 0===r?void 0:r.filter((function(e){return e.name==t||"Multi-Layer"===e.searchName}));null==i||i.forEach((function(t){var e=n.layerMap.get(t.id);e&&(e.isVisible=!0)}))}},{key:"resetLayers",value:function(){this.layerManager&&(this.layerManager.resetLayers(),this.setLayers(this.layerManager.getLayers()))}},{key:"getLayerKind",value:function(t,e){var r=this.layerMap.get(t),n=qt.a.Signal|qt.a.Plane;return r?!r.ignored&&r.isVisible||e?(r.kind&n)>0?Jt.Signal:Jt.Other:Jt.None:this.holeLayers.find((function(e){return e===t}))?Jt.Other:Jt.None}},{key:"isHolesLayer",value:function(t){return!!t&&(t.searchName.startsWith("Pad Holes")||t.searchName.startsWith("Via Holes"))}}])&&$t(e.prototype,r),n&&$t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),re=r(39);function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ie(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t[t.Metric=0]="Metric",t[t.Imperial=1]="Imperial"}(Qt||(Qt={})),function(t){t[t.Mil=0]="Mil",t[t.Meta=1]="Meta",t[t.Graphite=2]="Graphite"}(te||(te={}));var oe,ae=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ie(this,"scene2D",void 0),ie(this,"pcbUnits",void 0),ie(this,"metadata",void 0),ie(this,"metadataRepository",void 0),ie(this,"layerHelper",void 0),this.layerHelper=e}var e,r,i;return e=t,(r=[{key:"setScene2D",value:function(t){this.scene2D=t}},{key:"setup",value:function(){var t,e,r,i,o;this.metadataRepository=Wt.a.instance,this.metadata=null===(t=n.a.response)||void 0===t?void 0:t.metadata,this.pcbUnits="number"==typeof(null===(e=this.metadata)||void 0===e||null===(r=e.pcbDocument)||void 0===r?void 0:r.units)?null===(i=this.metadata)||void 0===i||null===(o=i.pcbDocument)||void 0===o?void 0:o.units:Qt.Imperial}},{key:"getNodeItemById",value:function(t){return this.scene2D.getNodeItemById(t)}},{key:"getMetadataLayer",value:function(t){return this.metadata&&this.metadata.layers?this.metadata.layers.find((function(e){return e.id==t})):null}},{key:"getPcbPrimitiveDescriptionById",value:function(t){var e=this.metadataRepository.getPrimitiveById(t);return e?this.getPcbPrimitiveDescription(e):"Unknown"}},{key:"pcbFormat",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:te.Mil,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e=void 0===e?this.pcbUnits:e;var o=1;switch(n){case te.Graphite:o=.01;break;case te.Meta:o=1e4}var a="";return t.forEach((function(t){var n="".concat(r.round(t/o),"mil"),u="".concat(r.round(t/o*.0254),"mm"),s="",l="";e==Qt.Metric?(s=u,l=n):(s=n,l=u),a&&(a+=","),a=a+s+(i?" (".concat(l,")"):"")})),a}},{key:"round",value:function(t){return Math.round(1e3*t)/1e3}},{key:"getPcbPrimitiveDescription",value:function(t){var e=255&t.kind,r=this.getPcbPrimiviveNameByKind(e),n=this.getLayerName(t.layerId);return"".concat(r," on ").concat(n)}},{key:"getPcbPrimiviveNameByKind",value:function(t){return Object(re.c)(t)}},{key:"getLayerName",value:function(t){var e=this.getMetadataLayer(t);return e?e.name:"#".concat(t)}},{key:"getPrimitiveGeometry",value:function(t,e){var r=this,n=[],i=[],o=t.GetLayersCount();if(qt.a.Signal,qt.a.Plane,0==o){var a=this.scene2D.getBoundingUniForItem(t,-1);return[{GetLayerIndex:function(){return 0},GetUnisCount:function(){return 1},GetUni:function(t){return a},GetArcsCount:function(){return 0},GetArc:function(t){return null},GetPolysCount:function(){return 0},GetPoly:function(t){return null},GetLabelsCount:function(){return 0},GetLabel:function(t){return null},GetLinesCount:function(){return 0},GetLine:function(t){return null}}]}for(var u=0;u<o;u++){var s=t.GetLayerGeometry(u);if(s&&(0!=s.GetPolysCount()||0!=s.GetArcsCount()||0!=s.GetUnisCount())){var l=this.layerHelper.getLayerKind(s.GetLayerIndex(),e);l==Jt.Signal?i.push(s):l==Jt.Other&&n.push(s)}}return(i.length>0?i:n).reduce((function(t,e){return t.find((function(t){return r.equalGeometries(t,e)}))||t.push(e),t}),[])}},{key:"equalGeometries",value:function(t,e){var r=t.GetArcsCount(),n=t.GetUnisCount(),i=t.GetPolysCount();if(r!==e.GetArcsCount())return!1;if(n!==e.GetUnisCount())return!1;if(i!==e.GetPolysCount())return!1;for(var o=0;o<r;o++){var a=t.GetArc(o),u=e.GetArc(o);if(a.width!==u.width)return!1;if(a.radius!==u.radius)return!1;if(a.angles[0]!==u.center[0])return!1;if(a.angles[1]!==u.center[1])return!1;if(a.center[0]!==u.center[0])return!1;if(a.center[1]!==u.center[1])return!1}for(o=0;o<n;o++){var s=t.GetUni(o),l=e.GetUni(o);if(s.radius!==l.radius)return!1;if(s.size[0]!==l.size[0])return!1;if(s.size[1]!==l.size[1])return!1;if(s.position[0]!==l.position[0])return!1;if(s.position[1]!==l.position[1])return!1;if(s.direction[0]!==l.direction[0])return!1;if(s.direction[1]!==l.direction[1])return!1}for(o=0;o<i;o++){var c=t.GetPoly(o),h=e.GetPoly(o);if(c.polygon!==h.polygon)return!1;if(c.angle[0]!==h.angle[0])return!1;if(c.angle[1]!==h.angle[1])return!1;if(c.scale[0]!==h.scale[0])return!1;if(c.scale[1]!==h.scale[1])return!1;if(c.position[0]!==h.position[0])return!1;if(c.position[1]!==h.position[1])return!1}return!0}}])&&ne(e.prototype,r),i&&ne(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),ue=r(78),se=r(34),le=r(116),ce=r(105);function he(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fe(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}!function(t){t[t.None=0]="None",t[t.Reduced=1]="Reduced",t[t.Full=2]="Full"}(oe||(oe={}));var pe=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),fe(this,"logger",void 0),fe(this,"scene2D",void 0),fe(this,"hintNode",null),fe(this,"hintMaterial",-1),fe(this,"mode",oe.None),this.logger=n.a.createLogger("Support library")}var e,r,i;return e=t,(r=[{key:"setScene2D",value:function(t){this.scene2D=t}},{key:"clear",value:function(){this.hintNode&&(this.scene2D.removeItem(this.hintNode),this.hintNode=null)}},{key:"showContour",value:function(t){if(this.clear(),this.mode&&null!=t&&t.length&&this.scene2D){var e;switch(this.hintMaterial<0&&(this.hintMaterial=this.scene2D.addMaterial(new ue.a(new Uint8Array([0,175,14,255]),ce.b.None,!1,!1,!1))),this.mode){case oe.Reduced:e=this.getReducedContainer(t);break;case oe.Full:e=this.getFullContainer(t);break;default:return}if(e){var r=this.scene2D.layerMap.GetLayersCount()-2;this.hintNode=this.scene2D.addNode(r,e)}}}},{key:"getReducedContainer",value:function(t){var e=new le.a,r=t.map((function(t){return t.lines})).reduce((function(t,e){return t.concat(e)}),[]);e.unis.length=r.length;for(var n=0;n<r.length;n++){var i=r[n];e.unis[n]=se.a.createLine(i.from[0],i.from[1],i.to[0],i.to[1],.001,this.hintMaterial,"round")}return e}},{key:"getFullContainer",value:function(t){for(var e=new le.a,r=t.map((function(t){return t.vertices})).reduce((function(t,e){return t.concat(e)}),[]),n=0;n<r.length;n++)for(var i=r[n],o=i[0],a=1;a<i.length;a++){var u=i[a],s=se.a.createLine(o[0],o[1],u[0],u[1],.001,this.hintMaterial,"round");e.unis.push(s),o=u}return e}}])&&he(e.prototype,r),i&&he(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function de(t){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ve(t,e){return(ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function ge(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=be(t);if(e){var i=be(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return me(this,r)}}function me(t,e){if(e&&("object"===de(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function be(t){return(be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var we=window.__CORE__,ke=(0,window.__APP__.createModule)({type:"Plugin",description:"SupportLibrary",create:function(t){return new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ve(t,e)}(o,t);var e,r,n,i=ge(o);function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this,{name:"SupportLibrary",comment:"SupportLibrary",description:"SupportLibrary"})).logger=we.createLogger("Support library"),t.layerHelper=new ee,t.dataHelper=new ae(t.layerHelper),t.hintHelper=new pe,t.contourHelper=new k,t.library=new Zt(t.logger,t.dataHelper,t.contourHelper,t.hintHelper),we.bus.on("GraphiteEngine:createdScene2D",(function(e){return new Promise((function(r){t.dataHelper.setScene2D(e),t.hintHelper.setScene2D(e),t.contourHelper.setScene2D(e),r()}))})),we.bus.on("PcbEngine:layerManagerCreated",(function(e){t.layerHelper.setup(e)})),we.bus.on("BoardItemsVisibility:change",(function(e){t.layerHelper.setLayers(e.flat())})),we.bus.on("BoardItemsVisibility:offOnly",(function(e){t.layerHelper.setLayers(e.flat())})),we.bus.on("BoardItemsVisibility:onOnly",(function(e){t.layerHelper.setLayerOnly(e)})),we.bus.on("BoardItemsVisibility:reset",(function(){t.layerHelper.resetLayers()})),we.bus.on("SupportLibrary:hintMode",(function(e){t.hintHelper.hintMode=e})),we.bus.on("SupportLibrary:getOtoDistance",(function(e){e.result=t.library.getOtoDistance(e.id1,e.id2,e.allLayersIds)})),we.bus.on("SupportLibrary:lsmToSvg",(function(e){var r;e.result=t.library.lsmToSvg(e.lsm,e.options,null!==(r=e.kind)&&void 0!==r?r:"View")})),t}return e=o,(r=[{key:"events",get:function(){return["SupportLibrary:hintMode","SupportLibrary:getOtoDistance","SupportLibrary:getOtoDistanceResult","SupportLibrary:lsmToSvg"]}},{key:"setup",value:function(){var t=this;return this.logger.LogDebug("Setup"),new Promise((function(e){t.dataHelper.setup(),e()}))}},{key:"handleOtoResult",value:function(t){this.logger.LogDebug("OTO #".concat(t.pcbId1," - #").concat(t.pcbId2," : ").concat(t.state," in ").concat(t.time,"ms")),this.logger.LogDebug(this.dataHelper.pcbFormat([t.distance],Qt.Imperial,te.Mil,!0)+(t.flattened?" (flattened)":""))}}])&&ye(e.prototype,r),n&&ye(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(t))}});we&&we.addModule(ke)}});