!function(e){function t(t){for(var r,a,s=t[0],u=t[1],c=t[2],p=0,f=[];p<s.length;p++)a=s[p],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);f.length;)f.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==i[u]&&(r=!1)}r&&(o.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},i={53:0},o=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;o.push([1232,2]),n()}({1232:function(e,t,n){e.exports=n(1293)},1293:function(e,t,n){"use strict";n.r(t);var r=n(19),i=n(105);function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s,u;!function(e){e[e.None=0]="None",e[e.trackVertices=1]="trackVertices",e[e.padCenters=2]="padCenters",e[e.padVertices=4]="padVertices",e[e.viaCenters=8]="viaCenters",e[e.footprintOrigins=16]="footprintOrigins",e[e.polyObjects=32]="polyObjects",e[e.AllPoints=63]="AllPoints",e[e.Default=59]="Default"}(s||(s={})),function(e){e[e.None=0]="None",e[e.center=1]="center"}(u||(u={}));var c,l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a(this,"auto",void 0),a(this,"enabled",void 0),a(this,"objects",void 0),a(this,"userDistance",void 0),a(this,"autoDistance",void 0),a(this,"autoDistanceMil",void 0),this.enabled=!0,this.objects=s.Default,this.auto=!0,this.userDistance=15,this.autoDistance=10,this.autoDistanceMil=15}var t,n,r;return t=e,(n=[{key:"distance",get:function(){return Math.round(this.auto?this.autoDistanceMil:this.userDistance)}},{key:"updateDistance",value:function(e){var t=e.pixelsToUnits(1)/.01;this.autoDistanceMil=t*this.autoDistance}},{key:"apply",value:function(e){e&&(this.auto=null!=e.auto?e.auto:this.auto,this.enabled=null!=e.enabled?e.enabled:this.enabled,this.objects=e.objects?e.objects:this.objects,this.autoDistance=e.autoDistance?Math.abs(e.autoDistance):this.autoDistance,this.userDistance=e.userDistance?Math.abs(e.userDistance):this.userDistance)}}])&&o(t.prototype,n),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function p(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e[e.Cross=1]="Cross",e[e.Circle=2]="Circle",e[e.Box=3]="Box",e[e.Triangle=4]="Triangle"}(c||(c={}));var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"serialize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n={};Object.assign(n,e);var r,i=p(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;n[o]=void 0}}catch(e){i.e(e)}finally{i.f()}return JSON.stringify(n)}},{key:"deserialize",value:function(e,t){var n=JSON.parse(e);Object.assign(t,n)}}],(n=null)&&h(t.prototype,n),r&&h(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var b=y((function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.point=t,this.object=n,this.item=r,this.layer=i}));function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(){var t,n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=void 0,(n="points")in(t=this)?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,this.points=[]}var t,n,r;return t=e,(n=[{key:"clear",value:function(){this.points=[]}},{key:"save",value:function(){return g.serialize(this)}},{key:"load",value:function(e){return g.deserialize(e,this),this}},{key:"count",value:function(){return this.points.length}},{key:"get",value:function(){return this.points}},{key:"addPoint",value:function(e,t,n,r){return!!Number.isSafeInteger(r)&&(this.points.push(new b(e,t,n,r)),!0)}}])&&v(t.prototype,n),r&&v(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function m(e,t,n,r,i,o){if(!(i-r<=n)){var a=r+i>>1;!function e(t,n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*l*(s-l)/s)*(u-s/2<0?-1:1),f=Math.max(i,Math.floor(r-u*l/s+p)),h=Math.min(o,Math.floor(r+(s-u)*l/s+p));e(t,n,r,f,h,a)}var g=n[2*r+a],d=i,y=o;for(P(t,n,i,r),n[2*o+a]>g&&P(t,n,i,o);d<y;){for(P(t,n,d,y),d++,y--;n[2*d+a]<g;)d++;for(;n[2*y+a]>g;)y--}n[2*i+a]===g?P(t,n,i,y):(y++,P(t,n,y,o)),y<=r&&(i=y+1),r<=y&&(o=y-1)}}(e,t,a,r,i,o%2),m(e,t,n,r,a-1,o+1),m(e,t,n,a+1,i,o+1)}}function P(e,t,n,r){k(e,n,r),k(t,2*n,2*r),k(t,2*n+1,2*r+1)}function k(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function O(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var M=function(e){return e[0]},C=function(e){return e[1]},D=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Float64Array;j(this,e),this.nodeSize=i,this.points=t;for(var a=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new a(t.length),u=this.coords=new o(2*t.length),c=0;c<t.length;c++)s[c]=c,u[2*c]=n(t[c]),u[2*c+1]=r(t[c]);m(s,u,i,0,s.length-1,0)}var t,n,r;return t=e,(n=[{key:"range",value:function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,c=[0,e.length-1,0],l=[];c.length;){var p=c.pop(),f=c.pop(),h=c.pop();if(f-h<=a)for(var g=h;g<=f;g++)s=t[2*g],u=t[2*g+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(e[g]);else{var d=Math.floor((h+f)/2);s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(e[d]);var y=(p+1)%2;(0===p?n<=s:r<=u)&&(c.push(h),c.push(d-1),c.push(y)),(0===p?i>=s:o>=u)&&(c.push(d+1),c.push(f),c.push(y))}}return l}(this.ids,this.coords,e,t,n,r,this.nodeSize)}},{key:"within",value:function(e,t,n){return function(e,t,n,r,i,o){for(var a=[0,e.length-1,0],s=[],u=i*i;a.length;){var c=a.pop(),l=a.pop(),p=a.pop();if(l-p<=o)for(var f=p;f<=l;f++)O(t[2*f],t[2*f+1],n,r)<=u&&s.push(e[f]);else{var h=Math.floor((p+l)/2),g=t[2*h],d=t[2*h+1];O(g,d,n,r)<=u&&s.push(e[h]);var y=(c+1)%2;(0===c?n-i<=g:r-i<=d)&&(a.push(p),a.push(h-1),a.push(y)),(0===c?n+i>=g:r+i>=d)&&(a.push(h+1),a.push(l),a.push(y))}}return s}(this.ids,this.coords,e,t,n,this.nodeSize)}}])&&S(t.prototype,n),r&&S(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),L(this,"coords",void 0),L(this,"data",void 0),L(this,"index",void 0),this.coords=new Float32Array(2*t.length),this.data=new Uint8Array(3*t.length);for(var n=0;n<t.length;++n){var r=t[n];this.coords[2*n]=r.point[0],this.coords[2*n+1]=r.point[1],this.data[3*n]=r.object,this.data[3*n+1]=r.item,this.data[3*n+2]=r.layer}this.index=new D(t,(function(e){return e.point[0]}),(function(e){return e.point[1]}),16,Float32Array),this.index.points=[]}var t,n,r;return t=e,(n=[{key:"getPointCount",value:function(){return this.coords.length/2}},{key:"getPoint",value:function(e){var t=this.coords;return new b([t[2*e],t[2*e+1]],this.data[3*e],this.data[3*e+1],this.data[3*e+2])}},{key:"getAllPoints",value:function(){for(var e=new Array(this.getPointCount()),t=0;t<e.length;++t)e[t]=this.getPoint(t);return e}},{key:"getClosestPoints",value:function(e,t){var n=this;return this.index.within(e[0],e[1],t).map((function(e){return n.getPoint(e)}))}}])&&T(t.prototype,n),r&&T(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var R=[],N=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),I(this,"logger",void 0),I(this,"pointIndex",void 0),this.logger=r.a.createLogger("Snapping"),this.pointIndex=new A([])}var t,n,i;return t=e,(n=[{key:"pointsTemp",get:function(){return R}},{key:"addPoints",value:function(e){var t;(t=this.pointsTemp).push.apply(t,_(e))}},{key:"getPointCount",value:function(){return this.pointIndex.getPointCount()}},{key:"getAllPoints",value:function(e,t){var n=this;return this.pointIndex?this.pointIndex.getAllPoints().filter((function(r){return n.filterPoint(r,e,t)})).map((function(e){return e.point})):[]}},{key:"filterPoint",value:function(e,t,n){return!!e&&0!=(e.object&t.objects)&&n.includes(e.layer)}},{key:"indexPoints",value:function(){this.pointIndex=new A(this.pointsTemp),R=[]}},{key:"distance",value:function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}},{key:"getClosestPoint",value:function(e,t,n){if(0===t.distance||!(t.objects&s.AllPoints))return null;var r=.01*t.distance,i=this.getClosestSnappingPoint(e,t,n),o=null;return i&&this.distance(e,i.point)<r&&(o={point:i.point,layer:i.layer,object:i.object,item:i.item,cursor:c.Cross}),o}},{key:"getClosestSnappingPoint",value:function(e,t,n){var r=this,i=.01*t.distance,o=this.pointIndex.getClosestPoints(e,i);return o.forEach((function(t){return t.distance=r.distance(t.point,e)})),o.sort((function(e,t){return e.distance-t.distance})).filter((function(e){return r.filterPoint(e,t,n)}))[0]}}])&&E(t.prototype,n),i&&E(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}(),B=n(78),V=n(116),F=n(140);function z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),U(this,"logger",void 0),U(this,"scene",void 0),U(this,"options",void 0),U(this,"storage",void 0),U(this,"snappingPoint",null),U(this,"showSnappings",!1),U(this,"snappingNode",null),U(this,"materialId",null),U(this,"allLayers",void 0),U(this,"layers",void 0),U(this,"layerManager",void 0),this.logger=r.a.createLogger("Snapping"),this.options=new l}var t,n,o;return t=e,(n=[{key:"setup",value:function(){}},{key:"fillStorage",value:function(e){switch(this.storage||(this.storage=new N),e.status){case"SnappingChankReady":var t=(new w).load(e.data);this.storage.addPoints(t.get()),this.logger.LogDebug("Added points: "+t.get().length);break;case"SnappingFinished":this.storage.indexPoints(),this.logger.LogDebug("Storage data is ready. Point count: ".concat(this.storage.getPointCount())),r.a.bus.emit("Snapping:loaded")}}},{key:"init",value:function(e,t){this.scene=e,this.layerManager=t,this.allLayers=t.getLayers(),this.setLayers(this.allLayers,!1)}},{key:"checkPoint",value:function(e){return this.snappingPoint=null,this.options.enabled&&this.storage&&(this.options.updateDistance(this.scene),this.snappingPoint=this.storage.getClosestPoint(e,this.options,this.layers),this.setCursor(this.snappingPoint)),this.isSnapped()}},{key:"getPoint",value:function(){return this.snappingPoint}},{key:"isSnapped",value:function(){return!!this.snappingPoint}},{key:"getOptions",value:function(){return this.options}},{key:"setOptions",value:function(e){e?this.options.apply(e):this.options=new l,this.updateDisplay()}},{key:"setLayers",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.filter((function(e){return e.isVisible&&!e.ignored||"Multi-Layer"===e.searchName}));this.layers=n.map((function(e){return e.metaId})),t&&this.updateDisplay()}},{key:"resetLayers",value:function(){this.layerManager&&(this.layerManager.resetLayers(),this.setLayers(this.layerManager.getLayers()))}},{key:"setLayerOnly",value:function(e){var t,n=null===(t=this.allLayers)||void 0===t?void 0:t.filter((function(t){return t.name==e||"Multi-Layer"===t.searchName}));null!=n&&n.length&&(this.layers=n.map((function(e){return e.metaId})),this.updateDisplay())}},{key:"show",value:function(){this.showSnappings=!0,this.updateDisplay()}},{key:"hide",value:function(){this.showSnappings=!1,this.updateDisplay()}},{key:"updateDisplay",value:function(){if(this.snappingNode&&(this.scene.removeItem(this.snappingNode),this.snappingNode=null),this.storage&&this.showSnappings){null===this.materialId&&(this.materialId=this.scene.addMaterial(new B.a(new Uint8Array([0,175,14,255]),i.b.None,!1,!1,!1)));var e=new V.a,t=this.storage.getAllPoints(this.options,this.layers);e.arcs.length=t.length;for(var n=0;n<t.length;n++)e.arcs[n]=F.a.createCircleFill(t[n][0],t[n][1],.05,this.materialId);var r=this.scene.layerMap.GetLayersCount()-2;this.snappingNode=this.scene.addNode(r,e)}}},{key:"setCursor",value:function(e){if(e)switch(e.object){case s.trackVertices:e.item==u.center?e.cursor=c.Triangle:e.cursor=c.Box;break;case s.polyObjects:e.cursor=c.Box;break;case s.padCenters:case s.viaCenters:e.cursor=c.Circle;break;default:e.cursor=c.Cross}}}])&&z(t.prototype,n),o&&z(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}();function W(){return new Worker(n.p+"js/snapping.threadWorker.worker.js")}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e,t,n){return t&&G(e.prototype,t),n&&G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=function(){function e(){q(this,e),$(this,"data",void 0),$(this,"status",void 0)}return Y(e,[{key:"setData",value:function(e){return this.data=e,this.status="RunProcessing",this}},{key:"setCancelled",value:function(){return this.status="CancelProcessing",this}}]),e}();function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Q=function(){function e(t){var n,r,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i=void 0,(r="name")in(n=this)?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,this.name=t}var t,n,r;return t=e,(n=[{key:"LogDebug",value:function(e){console.log(this.name+"\t\t|  "+this.getFormattedDate()+" | "+e)}},{key:"getFormattedDate",value:function(){var e=new Date(Date.now());return"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()," ").concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds(),".").concat(e.getMilliseconds())}}])&&K(t.prototype,n),r&&K(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ee=window.__CORE__,te=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Z(this,"worker",void 0),Z(this,"logger",void 0),this.logger=new Q("Snapping ThreadRunner"),this.logger.LogDebug("Runned."),ee.bus.on("PcbEngine:dataReadyForSnappingProcessing",(function(e,n){try{var r;null===(r=t.worker)||void 0===r||r.postMessage((new H).setData({data:e,metadata:n}))}catch(e){t.logger.LogDebug("error "+e)}})),ee.bus.registerEvent("ThreadRunner:snappingPointsChunkReady")}var t,n,r;return t=e,(n=[{key:"runThread",value:function(){if(window.Worker)try{this.worker=new W,this.worker.onmessage=function(e){ee.bus.emit("ThreadRunner:snappingPointsChunkReady",e.data)},this.logger.LogDebug("Thread started")}catch(e){this.logger.LogDebug("Can't load thread worker: ".concat(e))}else this.logger.LogDebug("Your browser doesn't support web workers.")}},{key:"terminateThread",value:function(){var e;null===(e=this.worker)||void 0===e||e.terminate(),this.logger.LogDebug("Thread terminated")}},{key:"cancelSnappingProcessing",value:function(){var e;null===(e=this.worker)||void 0===e||e.postMessage((new H).setCancelled()),this.logger.LogDebug("Snapping cancelled")}}])&&X(t.prototype,n),r&&X(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ie(e,t){return(ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=se(e);if(t){var i=se(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ae(this,n)}}function ae(e,t){if(t&&("object"===ne(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ue=window.__CORE__,ce=(0,window.__APP__.createModule)({type:"Plugin",description:"Snapping",create:function(e){return new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ie(e,t)}(o,e);var t,n,r,i=oe(o);function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,{name:"Snapping",comment:"Snapping",description:"Snapping"})).logger=window.__CORE__.createLogger("Snapping"),e.snappingManager=new J,e.threadRuner=new te,e.threadRuner.runThread(),ue.bus.on("ThreadRunner:snappingPointsChunkReady",(function(t){return e.snappingManager.fillStorage(t)})),ue.bus.on("Snapping:loaded",(function(){e.threadRuner.terminateThread()})),ue.bus.on("Snapping:getPoint",(function(t,n){n.result=e.snappingManager.getPoint(),n.snapped=e.snappingManager.isSnapped()})),ue.bus.on("Snapping:checkPoint",(function(t){var n=t.point;e.snappingManager.checkPoint(n),t.result=e.snappingManager.getPoint(),t.snapped=e.snappingManager.isSnapped()})),ue.bus.on("Snapping:setOptions",(function(t){e.snappingManager.setOptions(t)})),ue.bus.on("Snapping:getOptions",(function(t){t.options=e.snappingManager.getOptions()})),ue.bus.on("Snapping:show",(function(t){e.snappingManager.show()})),ue.bus.on("Snapping:hide",(function(t){e.snappingManager.hide()})),ue.bus.on("GraphiteEngine:createdScene2D",(function(t){e.scene=t})),ue.bus.on("PcbEngine:layerManagerCreated",(function(t){e.snappingManager.init(e.scene,t)})),ue.bus.on("BoardItemsVisibility:change",(function(t){e.snappingManager.setLayers(t.flat())})),ue.bus.on("BoardItemsVisibility:offOnly",(function(t){e.snappingManager.setLayers(t.flat())})),ue.bus.on("BoardItemsVisibility:onOnly",(function(t){e.snappingManager.setLayerOnly(t)})),ue.bus.on("BoardItemsVisibility:reset",(function(){e.snappingManager.resetLayers()})),e}return t=o,(n=[{key:"events",get:function(){return["Snapping:loaded","Snapping:getPoint","Snapping:checkPoint","Snapping:setOptions","Snapping:getOptions","Snapping:show","Snapping:hide"]}},{key:"setup",value:function(){var e=this;return new Promise((function(t){e.logger.LogDebug("Setup"),e.snappingManager.setup(),t()}))}}])&&re(t.prototype,n),r&&re(t,r),Object.defineProperty(t,"prototype",{writable:!1}),o}(e))}});ue&&ue.addModule(ce)}});