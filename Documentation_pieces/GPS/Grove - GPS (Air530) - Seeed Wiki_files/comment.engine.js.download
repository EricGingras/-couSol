!function(t){function e(e){for(var r,a,c=e[0],u=e[1],s=e[2],l=0,h=[];l<c.length;l++)a=c[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&h.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);for(f&&f(e);h.length;)h.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,c=1;c<n.length;c++){var u=n[c];0!==o[u]&&(r=!1)}r&&(i.splice(e--,1),t=a(a.s=n[0]))}return t}var r={},o={59:0},i=[];function a(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=r,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var s=0;s<c.length;s++)e(c[s]);var f=u;i.push([1250,0,2]),n()}({10:function(t,e,n){"use strict";n.d(e,"f",(function(){return r})),n.d(e,"e",(function(){return o})),n.d(e,"d",(function(){return i})),n.d(e,"b",(function(){return a})),n.d(e,"g",(function(){return c})),n.d(e,"c",(function(){return u})),n.d(e,"i",(function(){return s})),n.d(e,"h",(function(){return f})),n.d(e,"a",(function(){return l})),n.d(e,"k",(function(){return h})),n.d(e,"j",(function(){return p}));var r=function(t){return"string"==typeof t&&t.length},o=function(t){return"function"==typeof t},i=function(t){return"number"==typeof t},a={isRequired:function(t){return'"'.concat(t,'" is required')}},c={0:"mm",1:"mil"},u=function(t,e){var n={value:null};return window.__CORE__.tryGetAttributeValue(t,n)?n.value:e},s=function(t,e){return window.__CORE__.setAttributeValue(t,e)},f={1:"Arc",2:"Pad",3:"Via",4:"Track",6:"Fill",10:"Polygon",11:"Region",21:"Embedded Board Array"},l={voltage:1,currentDensity:2},h={voltage:"V",currentDensity:"A/m^2"},p={voltage:"V",currentDensity:"A/mm^2"}},105:function(t,e,n){"use strict";var r,o;n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o})),function(t){t[t.None=0]="None",t[t.Temporal=1]="Temporal",t[t.Supesampling=2]="Supesampling",t[t.Last=3]="Last"}(r||(r={})),function(t){t[t.None=0]="None",t[t.Vertical=1]="Vertical",t[t.Horizontal=2]="Horizontal",t[t.DiagMain=3]="DiagMain",t[t.DiagSecond=4]="DiagSecond",t[t.Cross=5]="Cross",t[t.Last=6]="Last"}(o||(o={}))},116:function(t,e,n){"use strict";function r(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return c}));var c=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,"unis",[]),a(this,"arcs",[]),a(this,"polygons",[]),a(this,"labels",[]),a(this,"lines",[]),a(this,"meshes",[])}var e,n,o;return e=t,(n=[{key:"isEmpty",get:function(){return!(this.unis.length||this.arcs.length||this.polygons.length||this.labels.length||this.lines.length||this.meshes.length)}},{key:"add",value:function(t){var e,n,o,i,a,c;t.unis.length&&(e=this.unis).push.apply(e,r(t.unis)),t.arcs.length&&(n=this.arcs).push.apply(n,r(t.arcs)),t.polygons.length&&(o=this.polygons).push.apply(o,r(t.polygons)),t.labels.length&&(i=this.labels).push.apply(i,r(t.labels)),t.lines.length&&(a=this.lines).push.apply(a,r(t.lines)),t.meshes.length&&(c=this.meshes).push.apply(c,r(t.meshes))}},{key:"clear",value:function(){this.unis.length=0,this.arcs.length=0,this.polygons.length=0,this.labels.length=0,this.lines.length=0,this.meshes.length=0}}])&&i(e.prototype,n),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}()},1250:function(t,e,n){t.exports=n(1267)},1251:function(t,e,n){"use strict";n(938)},1267:function(t,e,n){"use strict";n.r(e);var r,o,i,a="00000000-0000-0000-0000-000000000000";!function(t){t[t.Resolved=0]="Resolved",t[t.Active=1]="Active"}(r||(r={})),function(t){t[t.None=0]="None",t[t.Polyline=1]="Polyline"}(o||(o={})),function(t){t[t.ZeroSize=0]="ZeroSize",t[t.Small=1]="Small",t[t.Medium=2]="Medium",t[t.Large=3]="Large"}(i||(i={}));var c=window.__CORE__,u=n(18);function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=new(function(){function t(){var e,n,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=!0,(n="_visible")in(e=this)?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r}var e,n,r;return e=t,(n=[{key:"setup",value:function(){var t=this;c.bus.on("CommentsDrawingEngine:visibilityChange",(function(e){return t._visible=e}))}},{key:"visible",get:function(){return this._visible}}])&&s(e.prototype,n),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}());function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=d(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function d(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}function y(t,e){return(y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=g(t);if(e){var o=g(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return m(this,n)}}function m(t,e){if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return b(t)}function b(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var E={where:function(t){return["PROGRESS"===t.type]},to:"PROGRESS"},O={where:function(t){return["PROGRESS_ACTIVE"===t.type]},to:"PROGRESS_ACTIVE"},S={where:function(t){return["RESOLVE"===t.type]},to:"RESOLVE"},P={where:function(t){return["RESOLVE_ACTIVE"===t.type]},to:"RESOLVE_ACTIVE"},x={where:function(t){return["REMOVE"===t.type]},to:"REMOVE"},I={IDLE:[{where:function(t){return["EDIT"===t.type]},to:"EDIT"},E,S],EDIT:[{where:function(t){return["WAIT_FOR_POST"===t.type]},to:"WAIT_FOR_POST"},x],WAIT_FOR_POST:[O,x],PROGRESS_ACTIVE:[E,P,x],PROGRESS:[O,x],RESOLVE_ACTIVE:[O,S,x],RESOLVE:[P,x]},T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&y(t,e)}(i,t);var e,n,r,o=v(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),w(b(n=o.call(this,"IDLE",I)),"logger",void 0),w(b(n),"viewEngine",void 0),w(b(n),"dataStore",void 0),w(b(n),"toString",(function(){return"CommentsDrawingEngine.Graphics"})),n.logger=c.createLogger("CPGraphics"),n.viewEngine=t,n.dataStore=e,n.onEdit=n.onEdit.bind(b(n)),n.on("EDIT",n.onEdit),n.onRemove=n.onRemove.bind(b(n)),n.on("REMOVE",n.onRemove),n.onReadyToSubmit=n.onReadyToSubmit.bind(b(n)),n.once("WAIT_FOR_POST",n.onReadyToSubmit),n}return e=i,(n=[{key:"type",get:function(){var t;return null!==(t=this.dataStore.type)&&void 0!==t?t:"NONE"}},{key:"guid",get:function(){return this.dataStore.guid}},{key:"documentName",get:function(){var t;return null!==(t=this.dataStore.documentName)&&void 0!==t?t:""}},{key:"documentType",get:function(){var t;return null!==(t=this.dataStore.documentType)&&void 0!==t?t:""}},{key:"objectType",get:function(){var t;return null!==(t=this.dataStore.objectType)&&void 0!==t?t:""}},{key:"documentId",get:function(){return this.dataStore.data.DocumentUniqueID||this.dataStore.documentName||""}},{key:"pageId",get:function(){var t;return null!==(t=this.dataStore.data.PageUniqueID)&&void 0!==t?t:""}},{key:"uniqueId",get:function(){return""===this.pageId.trim()?this.documentId:"".concat(this.pageId,"-").concat(this.documentId)}},{key:"serializedData",get:function(){return this.viewEngine.serializeBaseData(this.dataStore)}},{key:"serializedDrawingData",get:function(){return this.viewEngine.serializeDrawingData(this.dataStore)}},{key:"active",get:function(){return"PROGRESS_ACTIVE"===this.state||"RESOLVE_ACTIVE"===this.state}},{key:"visible",get:function(){var t=this;return!!this.active||"WAIT_FOR_POST"===this.state||!!f.visible&&!!Cf.getActiveThreads().find((function(e){return e.id===t.guid}))}},{key:"hasDocument",get:function(){return this.viewEngine.hasDocument(this.uniqueId)}},{key:"getState",value:function(){return p(g(i.prototype),"getState",this).call(this)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return(e=p(g(i.prototype),"emit",this)).call.apply(e,[this,t].concat(r))}},{key:"dispatch",value:function(t){return p(g(i.prototype),"dispatch",this).call(this,t)}},{key:"edit",value:function(){this.dispatch({type:"EDIT"})}},{key:"setup",value:function(){switch(this.dataStore.status){case 0:this.dispatch({type:"RESOLVE"});break;case 1:this.dispatch({type:"PROGRESS"});break;default:throw new Error("Not implemented thread status "+status)}}},{key:"resolve",value:function(){this.dispatch({type:"RESOLVE_ACTIVE"})}},{key:"unresolve",value:function(){this.dispatch({type:"PROGRESS_ACTIVE"})}},{key:"remove",value:function(){this.dispatch({type:"REMOVE"})}},{key:"draw",value:function(){var t=this;this.viewEngine.storeToScene(this.dataStore);var e=this.viewEngine.createGraphicsPainter(this.dataStore),n=function(e,n){"PROGRESS"!==t.state&&"RESOLVE"!==t.state||c.bus.emit("CommentsDrawingEngine:showTooltip",{id:t.dataStore.guid,x:e,y:n})};e.on("SHOW_TOOLTIP",n);var r=function(){return c.bus.emit("CommentsDrawingEngine:hideTooltip")};e.on("HIDE_TOOLTIP",r);var o=function(){var e=t.getState();if("IDLE"!==e&&"EDIT"!==e&&"WAIT_FOR_POST"!==e){var n=t.active?null:t.dataStore.guid;c.bus.emit("CommentsDrawingEngine:changeActiveState",n)}};e.on("CHANGE_STATE",o);var i=function(){(t.active||"WAIT_FOR_POST"===t.getState())&&t.emit("UPDATE_ICON_POSITION",{iconRect:e.iconRect})};e.on("ICON_MOVING",i);var a=function(){"WAIT_FOR_POST"!==t.state&&t.emit("UPDATE_THREAD",{op:"replace",path:"/Data",value:t.serializedData})};e.on("ICON_MOVED",a);var u=function(){var e,n,r;t.emit("UPDATE_DRAWINGS",{count:null!==(e=null===(n=t.dataStore.drawing)||void 0===n||null===(r=n.Items)||void 0===r?void 0:r.length)&&void 0!==e?e:0}),t.active&&t.emit("UPDATE_THREAD",{op:"replace",path:"/Drawing",value:t.serializedDrawingData})};e.on("DRAWINGS_CHANGED",u);var s=function(){e.updateVisibility(t.visible),e.updateState(t.getState())};this.on("PROGRESS_ACTIVE",s),this.on("RESOLVE_ACTIVE",s),this.on("RESOLVE",s),this.on("PROGRESS",s),this.once("CLEAR",(function(){e.destroy()}));var f=function(){return e.zoomToFit()};this.on("ZOOM_TO_FIT",f);var l=function(){e.updateVisibility(t.visible)};c.bus.on("CommentsDrawingEngine:visibilityChange",l);var h=function(){return e.updateVisibility(t.visible)};c.bus.on("CommentsDrawingEngine:filterChange",h),e.once("DESTROYED",(function(){e.off("SHOW_TOOLTIP",n),e.off("HIDE_TOOLTIP",r),e.off("CHANGE_STATE",o),e.off("ICON_MOVING",i),e.off("ICON_MOVED",a),e.off("DRAWINGS_CHANGED",u),t.off("PROGRESS_ACTIVE",s),t.off("RESOLVE_ACTIVE",s),t.off("RESOLVE",s),t.off("PROGRESS",s),t.off("ZOOM_TO_FIT",f),c.bus.off("CommentsDrawingEngine:visibilityChange",l),c.bus.off("CommentsDrawingEngine:filterChange",h)})),e.paint(this.getState(),this.visible)}},{key:"clear",value:function(){this.emit("CLEAR")}},{key:"collapse",value:function(){var t=this.getState();"PROGRESS_ACTIVE"===t?this.dispatch({type:"PROGRESS"}):"RESOLVE_ACTIVE"===t&&this.dispatch({type:"RESOLVE"})}},{key:"expand",value:function(){this.dispatch({type:"PROGRESS_ACTIVE"})||this.dispatch({type:"RESOLVE_ACTIVE"})}},{key:"zoomToFit",value:function(){this.emit("ZOOM_TO_FIT")}},{key:"onEdit",value:function(){var t=this;setTimeout((function(){return t.dispatch({type:"WAIT_FOR_POST",threadEditOptions:t.viewEngine.createUiThreadEditOptions()})}))}},{key:"onReadyToSubmit",value:function(){this.logger.LogDebug("Ready to post."),this.draw()}},{key:"onRemove",value:function(){this.logger.LogDebug("Removed."),this.clear()}}])&&h(e.prototype,n),r&&h(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(u.a),k=n(30);function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function L(t,e){return(L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=M(t);if(e){var o=M(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return A(this,n)}}function A(t,e){if(e&&("object"===j(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return R(t)}function R(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function B(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}(i,t);var e,n,r,o=C(i);function i(){var t;_(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return B(R(t=o.call.apply(o,[this].concat(n))),"toString",(function(){return"CommentsDrawingEngine.Painters.None"})),t}return e=i,(n=[{key:"iconRect",get:function(){return{isInfinite:!0}}},{key:"paint",value:function(){}},{key:"destroy",value:function(){}},{key:"updateVisibility",value:function(){}},{key:"updateState",value:function(){}},{key:"zoomToFit",value:function(){}}])&&D(e.prototype,n),r&&D(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(k.a);function V(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function G(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var F=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),G(this,"logger",c.createLogger("CPActiveThreadSession")),G(this,"workspace",null),G(this,"cancelClickHandling",null),G(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Base.ActiveThreadSession"}))}var e,n,r;return e=t,(n=[{key:"run",value:function(t){this.stop(),this.workspace=t,t&&(this.onMouseDown=this.onMouseDown.bind(this),this.onTouchStart=this.onTouchStart.bind(this),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("touchstart",this.onTouchStart))}},{key:"stop",value:function(){this.cancelClickHandling&&(this.cancelClickHandling(),this.cancelClickHandling=null);var t=this.workspace;t&&(t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("touchstart",this.onTouchStart))}},{key:"onMouseDown",value:function(t){var e=this;if(0===t.button){var n=!1,r=function(){n=!0},o=function t(e){window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",t),n||c.bus.emit("CommentsDrawingEngine:documentClick",e),n=!1};window.addEventListener("mousemove",r),window.addEventListener("mouseup",o),this.cancelClickHandling&&this.cancelClickHandling(),this.cancelClickHandling=function(){window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",o),e.cancelClickHandling=null},this.stopBubble(t)}}},{key:"onTouchStart",value:function(t){var e=this;if(1===t.touches.length){var n=!1,r=function(){n=!0},o=function t(e){window.removeEventListener("touchmove",r),window.removeEventListener("touchend",t),n||c.bus.emit("CommentsDrawingEngine:documentClick",e),n=!1};window.addEventListener("touchmove",r),window.addEventListener("touchend",o),this.cancelClickHandling&&this.cancelClickHandling(),this.cancelClickHandling=function(){window.removeEventListener("touchmove",r),window.removeEventListener("touchend",o),e.cancelClickHandling=null},this.stopBubble(t)}}},{key:"stopBubble",value:function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}}])&&V(e.prototype,n),r&&V(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function W(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return U(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return U(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Y(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Y=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==H(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function z(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function q(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){z(i,r,o,a,c,"next",t)}function c(t){z(i,r,o,a,c,"throw",t)}a(void 0)}))}}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Z(){return(Z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=J(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function J(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=et(t)););return t}function K(t,e){return(K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=et(t);if(e){var o=et(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return $(this,n)}}function $(t,e){if(e&&("object"===H(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return tt(t)}function tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function et(t){return(et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function nt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var rt={where:function(t){return["ACTIVE"===t.type]},to:"ACTIVE"},ot={where:function(t){return["NOT_ACTIVE"===t.type]},to:"NOT_ACTIVE"},it={IDLE:[{where:function(t){return["SET"===t.type]},to:"SET"}],SET:[{where:function(t){return["READY"===t.type]},to:"READY"}],READY:[{where:function(t){return["DISABLE"===t.type]},to:"DISABLE"},ot,rt],DISABLE:[],NOT_ACTIVE:[rt],ACTIVE:[ot,rt]},at=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&K(t,e)}(u,t);var e,n,r,i,a=Q(u);function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),nt(tt(e=a.call(this,"IDLE",it)),"logger",void 0),nt(tt(e),"Core",window.__CORE__),nt(tt(e),"store",new Set),nt(tt(e),"workspace",null),nt(tt(e),"activeThreadSession",void 0),nt(tt(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Base"})),e.logger=c.createLogger("CPViewEngine_".concat(t)),e.activeThreadSession=e.createActiveThreadSession(),e.setupStateChangeHandlers(),e.on("viewShown",(function(t){e.workspace=t,e.onViewShown()})),e.on("viewHidden",(function(){e.onViewHidden(),e.workspace=null})),e.onRemoveThread=e.onRemoveThread.bind(tt(e)),c.bus.on("CommentsDrawingEngine:remove",e.onRemoveThread),e.onResolveThread=e.onResolveThread.bind(tt(e)),c.bus.on("CommentsDrawingEngine:resolve",e.onResolveThread),e.onActivateThread=e.onActivateThread.bind(tt(e)),c.bus.on("CommentsDrawingEngine:activate",e.onActivateThread),e}return e=u,(n=[{key:"state",get:function(){return this.getState()}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return(e=Z(et(u.prototype),"emit",this)).call.apply(e,[this,t].concat(r))}},{key:"dispatch",value:function(t){return Z(et(u.prototype),"dispatch",this).call(this,t)}},{key:"setup",value:function(){var t=this;return new Promise((function(e,n){t.dispatch({type:"SET"})?t.once("READY",(function(n){n.error?t.dispatch({type:"DISABLE",error:n.error}):t.viewIsShown()?t.dispatch({type:"ACTIVE"}):t.dispatch({type:"NOT_ACTIVE"}),e()})):n(new Error("Wrong setup initial state [".concat(t.state,"].")))}))}},{key:"createGraphics",value:(i=q(Y().mark((function t(){var e,n,r,o;return Y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.createCreationSession(),n=function(){return e.cancel()},c.bus.on("CommentsDrawingEngine:remove",n),t.next=5,new Promise((function(t){e.once("complete",(function(e,r){c.bus.off("CommentsDrawingEngine:remove",n),t(r.dataStore)})),e.run()}));case 5:if(r=t.sent){t.next=8;break}return t.abrupt("return",null);case 8:return o=new T(this,r),this.registerGraphics(o),o.edit(),t.abrupt("return",o);case 12:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"addGraphics",value:function(t,e){var n=new T(this,t);return this.registerGraphics(n),n.setup(),this.canBePaint(n)&&(n.draw(),e&&n.expand()),Promise.resolve(n)}},{key:"hasDocument",value:function(t){return!0}},{key:"customizeDataStore",value:function(t,e){}},{key:"createGraphicsPainter",value:function(t){return new N}},{key:"serializeBaseData",value:function(t){var e=this,n=function(t){return t||" "};if("document"===t.coordType)throw new Error("Not implemented method");var r=t.data,o=[];if(o.push("DocumentUniqueID=".concat(n(r.DocumentUniqueID))),o.push("ObjectUniqueID=".concat(n(r.ObjectUniqueID))),o.push("PageUniqueID=".concat(n(r.PageUniqueID))),o.push("AreaLeft=".concat(this.coordXToDocument(r.AreaLeft))),o.push("AreaTop=".concat(this.coordYToDocument(r.AreaTop))),o.push("AreaRight=".concat(this.coordXToDocument(r.AreaRight))),o.push("AreaBottom=".concat(this.coordYToDocument(r.AreaBottom))),o.push("TextLeft=".concat(this.coordXToDocument(r.TextLeft))),o.push("TextTop=".concat(this.coordYToDocument(r.TextTop))),o.push("TextRight=".concat(this.coordXToDocument(r.TextRight))),o.push("TextBottom=".concat(this.coordYToDocument(r.TextBottom))),o.push("Text=".concat(n(r.Text))),r.SerializedData){var i=r.SerializedData,a={};a.X=this.coordXToDocument(i.X),a.Y=this.coordYToDocument(i.Y),a.AnchorOffsetX=this.coordXToDocument(i.AnchorOffsetX),a.AnchorOffsetY=this.coordYToDocument(i.AnchorOffsetY),Array.isArray(i.Vertices)&&(a.Vertices=[],i.Vertices.forEach((function(t){if(Array.isArray(t)){var n=[];t.forEach((function(t){t&&n.push({X:e.coordXToDocument(t.X),Y:e.coordYToDocument(t.Y)})})),a.Vertices.push(n)}}))),o.push("SerializedData=".concat(JSON.stringify(a)))}return o.push("Collapsed=".concat(r.Collapsed?"True":"False")),o.join("|")}},{key:"serializeDrawingData",value:function(t){var e,n,r=this;if("document"===t.coordType)throw new Error("Not implemented method");var o={Items:new Array};return null===(e=t.drawing)||void 0===e||null===(n=e.Items)||void 0===n||n.forEach((function(t){var e={};e.Type=t.Type,e.Color=t.Color,e.LineSize=t.LineSize,e.AreaLeft=r.coordXToDocument(t.AreaLeft),e.AreaTop=r.coordYToDocument(t.AreaTop),e.AreaRight=r.coordXToDocument(t.AreaRight),e.AreaBottom=r.coordYToDocument(t.AreaBottom);var n=t.Vertices;n&&(e.Vertices=[],n.forEach((function(t){return e.Vertices.push({X:r.coordXToDocument(t.X),Y:r.coordYToDocument(t.Y)})}))),o.Items.push(e)})),JSON.stringify(o)}},{key:"storeToScene",value:function(t){var e,n,r,i,a=this;"document"===t.coordType&&(t.coordType="scene",function(t,e,n){if(t.AreaLeft=e(t.AreaLeft),t.AreaTop=n(t.AreaTop),t.AreaRight=e(t.AreaRight),t.AreaBottom=n(t.AreaBottom),t.TextLeft=e(t.TextLeft),t.TextTop=n(t.TextTop),t.TextRight=e(t.TextRight),t.TextBottom=n(t.TextBottom),t.SerializedData){var r,o,i,a=t.SerializedData;a.X=e(a.X),a.Y=n(a.Y),a.AnchorOffsetX=e(a.AnchorOffsetX),a.AnchorOffsetY=n(a.AnchorOffsetY),null===(r=a.Vertices)||void 0===r||r.forEach((function(t){return null==t?void 0:t.forEach((function(t,r){t&&(t.X=e(t.X),t.Y=n(t.Y),r&&(o?(o.x=Math.min(o.x,t.X),o.y=Math.min(o.y,t.Y)):o={x:t.X,y:t.Y},i?(i.x=Math.max(i.x,t.X),i.y=Math.max(i.y,t.Y)):i={x:t.X,y:t.Y}))}))})),o&&(t.AreaLeft=o.x,t.AreaTop=o.y,t.AreaRight=i.x,t.AreaBottom=i.y)}}(t.data,(function(t){return a.coordXToScene(t)}),(function(t){return a.coordYToScene(t)})),e=t.drawing,n=function(t){return a.coordXToScene(t)},r=function(t){return a.coordYToScene(t)},null==e||null===(i=e.Items)||void 0===i||i.forEach((function(t){var e;t.AreaLeft=n(t.AreaLeft),t.AreaTop=r(t.AreaTop),t.AreaRight=n(t.AreaRight),t.AreaBottom=r(t.AreaBottom),t.Type===o.Polyline&&(null===(e=t.Vertices)||void 0===e||e.forEach((function(t){t&&(t.X=n(t.X),t.Y=r(t.Y))})))})))}},{key:"createActiveThreadSession",value:function(){return new F}},{key:"setupMetadata",value:function(){return Promise.resolve()}},{key:"createOverlay",value:function(){}},{key:"destroyOverlay",value:function(){}},{key:"coordXToDocument",value:function(t){return null!=t?t:0}},{key:"coordYToDocument",value:function(t){return null!=t?t:0}},{key:"coordXToScene",value:function(t){return null!=t?t:0}},{key:"coordYToScene",value:function(t){return null!=t?t:0}},{key:"canBePaint",value:function(t){return"ACTIVE"===this.getState()}},{key:"setupStateChangeHandlers",value:function(){var t=this;this.onSet=this.onSet.bind(this),this.on("SET",(function(){return t.logger.LogDebug("SET")})),this.on("SET",this.onSet),this.on("READY",(function(){return t.logger.LogDebug("READY")})),this.onActivate=this.onActivate.bind(this),this.on("ACTIVE",(function(){return t.logger.LogDebug("ACTIVE")})),this.on("ACTIVE",this.onActivate),this.onDeactivate=this.onDeactivate.bind(this),this.on("NOT_ACTIVE",(function(){return t.logger.LogDebug("NOT_ACTIVE")})),this.on("NOT_ACTIVE",this.onDeactivate),this.onDisable=this.onDisable.bind(this),this.on("DISABLE",(function(){return t.logger.LogDebug("DISABLE")})),this.on("DISABLE",this.onDisable)}},{key:"onSet",value:function(){var t=this;setTimeout(q(Y().mark((function e(){return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.setupMetadata();case 3:t.dispatch({type:"READY"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),t.dispatch({type:"READY",error:e.t0});case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))),0)}},{key:"onActivate",value:function(){var t=this;try{this.createOverlay(),this.store.forEach((function(e){t.canBePaint(e)&&e.draw()}))}catch(t){this.logger.LogError("Engine activate error.",t),this.dispatch({type:"NOT_ACTIVE"})}}},{key:"onDeactivate",value:function(){try{c.bus.emit("CommentsDrawingEngine:cancelEdit"),this.store.forEach((function(t){return t.clear()})),this.destroyOverlay()}catch(t){this.logger.LogError("Engine deactivate error.",t)}}},{key:"onDisable",value:function(t){this.logger.LogError("Engine is disabled.",t.error)}},{key:"registerGraphics",value:function(t){var e=this,n=function(){return e.activeThreadSession.run(e.workspace)};t.on("EDIT",n),t.on("RESOLVE_ACTIVE",n),t.on("PROGRESS_ACTIVE",n);var r=function(){return e.activeThreadSession.stop()};t.on("RESOLVE",r),t.on("PROGRESS",r),t.on("REMOVE",(function o(){e.activeThreadSession.stop(),t.off("RESOLVE",r),t.off("PROGRESS",r),t.off("EDIT",n),t.off("RESOLVE_ACTIVE",n),t.off("PROGRESS_ACTIVE",n),t.off("REMOVE",o),e.onGraphicsRemove(t)})),this.store.add(t),this.onGraphicsRegistered(t)}},{key:"onGraphicsRegistered",value:function(t){}},{key:"onGraphicsRemove",value:function(t){this.store.delete(t)}},{key:"onResolveThread",value:function(t){var e=this.getByGuid(t.Guid);if(e)switch(t.Status){case 0:e.unresolve();break;case 1:e.resolve()}}},{key:"onActivateThread",value:function(t){this.store.forEach((function(t){t.active&&t.collapse()}));var e,n=this.getByGuid(t.id);n?this.activateGraphics(n,t.zoomToFit,null!==(e=t.callback)&&void 0!==e?e:function(){}):t.callback&&t.callback(null)}},{key:"getByGuid",value:function(t){if(t){var e,n=W(this.store);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.guid===t)return r}}catch(t){n.e(t)}finally{n.f()}}return null}},{key:"onRemoveThread",value:function(t){if(t){this.logger.LogDebug("Try remove "+t);var e=this.getByGuid(t);e&&e.remove()}}},{key:"onViewShown",value:function(){this.dispatch({type:"ACTIVE"})}},{key:"onViewHidden",value:function(){this.dispatch({type:"NOT_ACTIVE"})}}])&&X(e.prototype,n),r&&X(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(u.a);function ct(t){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ut(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ut=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==ct(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function st(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function ft(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){st(i,r,o,a,c,"next",t)}function c(t){st(i,r,o,a,c,"throw",t)}a(void 0)}))}}function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ht(t,e){return(ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function pt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=vt(t);if(e){var o=vt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return dt(this,n)}}function dt(t,e){if(e&&("object"===ct(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return yt(t)}function yt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vt(t){return(vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ht(t,e)}(f,t);var e,n,r,o,i,a,u,s=pt(f);function f(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),mt(yt(e=s.call(this)),"cancelled",!1),mt(yt(e),"leaveEvent",null),mt(yt(e),"startPoint",{x:0,y:0}),mt(yt(e),"config",void 0),mt(yt(e),"logger",void 0),mt(yt(e),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Base"})),e.config=t,e.logger=c.createLogger("CPCreationSession_".concat(t.name)),e.on("before",(function(){return e.logger.LogDebug("Start session.")})),e.on("after",(function(){return e.logger.LogDebug("End session.")})),e}return e=f,(n=[{key:"run",value:(u=ft(ut().mark((function t(){var e;return ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.logger.LogDebug("Run"),this.emit("before",this,{}),t.prev=2,e=null;case 4:if(e||this.cancelled){t.next=11;break}return t.next=7,this.execute();case 7:e=t.sent,this.logger.LogDebug("Executed. [Data: ".concat(e,"] [Cancelled: ").concat(this.cancelled,"]")),t.next=4;break;case 11:this.emit("complete",this,{dataStore:e});case 12:return t.prev=12,this.emit("after",this,{}),t.finish(12);case 15:case"end":return t.stop()}}),t,this,[[2,,12,15]])}))),function(){return u.apply(this,arguments)})},{key:"cancel",value:function(){this.cancelled=!0,this.emit("executed",null)}},{key:"doStopBubble",value:function(t){return!0}},{key:"createData",value:function(t){return Promise.resolve(null)}},{key:"init",value:function(t){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),t.addEventListener("mousemove",this.onMouseMove,!0),t.addEventListener("mousedown",this.onMouseDown,!0),t.addEventListener("mouseleave",this.onMouseLeave,!0),t.addEventListener("touchstart",this.onTouchStart,!0)}},{key:"clear",value:function(t){t.removeEventListener("mousedown",this.onMouseDown,!0),t.removeEventListener("mousemove",this.onMouseMove,!0),t.removeEventListener("mouseleave",this.onMouseLeave,!0),t.removeEventListener("touchstart",this.onTouchStart,!0),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("mouseenter",this.onMouseEnter),t.removeEventListener("touchmove",this.onTouchMove),t.removeEventListener("touchend",this.onTouchEnd)}},{key:"startHighlight",value:function(t){}},{key:"stopHighlight",value:function(){}},{key:"execute",value:(a=ft(ut().mark((function t(){return ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.doExecute();case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),this.logger.LogError("Thread creation error.",t.t0),this.cancelled=!0,t.abrupt("return",null);case 11:case"end":return t.stop()}}),t,this,[[0,6]])}))),function(){return a.apply(this,arguments)})},{key:"doExecute",value:(i=ft(ut().mark((function t(){var e,n,r=this;return ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.config.workspace,this.init(e),t.next=4,new Promise((function(t){return r.once("executed",(function(e){return t(e)}))}));case 4:return n=t.sent,this.clear(e),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"doDrawRect",value:function(t,e){var n={x:Math.min(this.startPoint.x,t),y:Math.min(this.startPoint.y,e),width:Math.abs(this.startPoint.x-t),height:Math.abs(this.startPoint.y-e)};this.emit("drawRect",n)}},{key:"doCreateData",value:(o=ft(ut().mark((function t(e,n){var r,o;return ut().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r={x:Math.min(this.startPoint.x,e),y:Math.min(this.startPoint.y,n),width:Math.abs(this.startPoint.x-e),height:Math.abs(this.startPoint.y-n)},t.next=4,this.createData(r);case 4:o=t.sent,this.emit("executed",o),t.next=13;break;case 8:t.prev=8,t.t0=t.catch(0),console.log(t.t0),this.logger.LogError("Thread data creation error.",t.t0),this.emit("executed",null);case 13:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(t,e){return o.apply(this,arguments)})},{key:"stopBubble",value:function(t){this.doStopBubble(t)&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())}},{key:"onMouseDown",value:function(t){if(0===t.button){var e=this.config.workspace;e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("mouseenter",this.onMouseEnter),this.startPoint.x=t.clientX,this.startPoint.y=t.clientY,this.stopBubble(t)}}},{key:"onMouseMove",value:function(t){switch(t.buttons){case 0:this.startHighlight({x:t.clientX,y:t.clientY}),this.stopBubble(t);break;case 1:this.stopHighlight(),this.stopBubble(t),this.doDrawRect(t.clientX,t.clientY);break;default:this.stopHighlight()}}},{key:"onMouseUp",value:function(t){var e=this.config.workspace;e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("mouseenter",this.onMouseEnter),this.doCreateData(t.clientX,t.clientY),this.stopHighlight(),this.stopBubble(t)}},{key:"onMouseLeave",value:function(t){1===t.buttons&&(this.leaveEvent=t)}},{key:"onMouseEnter",value:function(t){1!==t.buttons&&this.leaveEvent&&(this.onMouseUp(this.leaveEvent),this.leaveEvent=null)}},{key:"onTouchStart",value:function(t){var e=this.config.workspace;1===t.touches.length&&(this.startPoint.x=t.touches[0].clientX,this.startPoint.y=t.touches[0].clientY,e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("touchend",this.onTouchEnd),this.stopBubble(t)),2===t.touches.length&&(e.removeEventListener("touchmove",this.onTouchMove),e.removeEventListener("touchend",this.onTouchEnd))}},{key:"onTouchMove",value:function(t){this.doDrawRect(t.touches[0].clientX,t.touches[0].clientY)}},{key:"onTouchEnd",value:function(t){var e=this.config.workspace;1===t.touches.length&&(e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("touchend",this.onTouchEnd)),0===t.touches.length&&(e.removeEventListener("touchmove",this.onTouchMove),e.removeEventListener("touchend",this.onTouchEnd),this.doCreateData(t.changedTouches[0].clientX,t.changedTouches[0].clientY))}}])&&lt(e.prototype,n),r&&lt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),f}(k.a),gt=n(166);function wt(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);return Array.isArray(e)?e.forEach((function(t){return n.setAttribute(t.key,t.value)})):Object.entries(e).forEach((function(t){return n.setAttribute(t[0],t[1])})),n}function Et(t,e){var n;return null!==(n=Object.keys(t).map((function(e){return t[e]})).filter((function(t){return!(parseInt(t)>=0)})).find((function(n){return t[n]===e})))&&void 0!==n?n:""}function Ot(t){return(Ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function St(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pt(t,e){return(Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function xt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=kt(t);if(e){var o=kt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return It(this,n)}}function It(t,e){if(e&&("object"===Ot(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Tt(t)}function Tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kt(t){return(kt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function jt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pt(t,e)}(u,t);var e,n,o,i=xt(u);function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),jt(Tt(e=i.call(this,{name:"Sch",supportedTypes:["OBJECT","AREA","POINT"],workspace:t.workspace})),"rect",void 0),jt(Tt(e),"activeObjectGroup",void 0),jt(Tt(e),"highlightObjectGroup",void 0),jt(Tt(e),"domPoint",void 0),jt(Tt(e),"paintInfo",void 0),jt(Tt(e),"currentObject",void 0),jt(Tt(e),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Sch"})),e.paintInfo=t,e.setupActiveObjects(),e.on("before",(function(){t.workspace.style.cursor="crosshair"})),e.on("after",(function(){var n,r,o;e.cancelled&&c.bus.emit("SCHView:enableSelection",!0),null===(n=e.rect)||void 0===n||n.remove(),null===(r=e.activeObjectGroup)||void 0===r||r.remove(),null===(o=e.highlightObjectGroup)||void 0===o||o.remove(),t.workspace.style.cursor="auto"})),e.on("drawRect",(function(t){return e.drawRect(t)})),e}return e=u,(n=[{key:"createData",value:function(t){var e={coordType:"scene"};return e.guid=a,e.drawing={Items:[]},e.status=r.Active,e.threadNumber=-1,e.documentName=this.paintInfo.documentName,e.documentType="SCH",e.data={},e.data.DocumentUniqueID=this.paintInfo.documentId,e.data.TextLeft=0,e.data.TextTop=0,e.data.TextRight=0,e.data.TextBottom=0,this.currentObject?(e.type="OBJECT",e.objectType=Et(br,this.currentObject.kind),e.data.ObjectUniqueID=this.currentObject.id,this.currentObject.kind===br.Wire||this.currentObject.kind===br.Pin?this.setPointData(e,t):this.setRectData(e,this.currentObject.element.getBoundingClientRect())):t.width||t.height?(e.type="AREA",this.setRectData(e,t)):(e.type="POINT",this.setPointData(e,t)),Promise.resolve(e)}},{key:"drawRect",value:function(t){this.rect||(this.rect=wt("rect",{class:"comment-area-selection-rect",fill:"none",stroke:"#267FEB","stroke-width":"4","stroke-opacity":"0.48","stroke-linecap":"round","stroke-linejoin":"round","vector-effect":"non-scaling-stroke"}),this.paintInfo.sceneGroup.appendChild(this.rect));var e=this.screenToSVG(t.x,t.y,this.paintInfo.sceneGroup.getScreenCTM()),n=this.screenToSVG(t.x+t.width,t.y+t.height,this.paintInfo.sceneGroup.getScreenCTM());this.rect.width.baseVal.value=Math.abs(e.x-n.x),this.rect.height.baseVal.value=Math.abs(e.y-n.y),this.rect.x.baseVal.value=Math.min(e.x,n.x),this.rect.y.baseVal.value=Math.min(e.y,n.y),this.activeObjectGroup&&this.activeObjectGroup.setAttribute("display","none")}},{key:"screenToSVG",value:function(t,e,n){var r,o;this.domPoint=null!==(r=this.domPoint)&&void 0!==r?r:null===(o=this.paintInfo.sceneGroup.closest("svg"))||void 0===o?void 0:o.createSVGPoint(),this.domPoint.x=t,this.domPoint.y=e;var i=n;return this.domPoint.matrixTransform(i.inverse())}},{key:"setupActiveObjects",value:function(){var t=this;this.activeObjectGroup&&this.activeObjectGroup.remove(),this.activeObjectGroup=wt("g",[{key:"data-type",value:"active-objects"}]),this.paintInfo.sceneGroup.appendChild(this.activeObjectGroup),this.highlightObjectGroup&&this.highlightObjectGroup.remove(),this.highlightObjectGroup=wt("g",[{key:"data-type",value:"highlight-objects"}]),this.paintInfo.sceneGroup.appendChild(this.highlightObjectGroup);var e=wt("style",{});e.innerHTML="g[data-type=highlight-objects] * { fill: none; stroke: #267FEB; stroke-opacity: 0.48; pointer-events:none; } ",e.innerHTML+="g[data-type=highlight-objects] rect { stroke-width: 2px; } ",this.highlightObjectGroup.appendChild(e),this.paintInfo.objects.forEach((function(e){var n=e.node.getAttribute("id");if(n){var r=function t(n){if(n&&n.localName){var r=n.localName;if("g"===r){if(e.kind===br.Wire||e.kind===br.Pin){for(var o=[],i=0;i<n.children.length;i++){var a=t(n.children[i]);a&&o.push(a)}return gt.a.join(o)}return gt.a.getPathForGroup(n)}if("line"===r)return gt.a.getPathForLine(n);if("ellipse"===r)return gt.a.getPathForEllipse(n);if("polyline"===r)return gt.a.getPathForPolyLine(n);if("polygon"===r)return gt.a.getPathForPolygon(n)}return null}(e.node);r&&t.addActiveObjectToScene(r,n,e.kind)}}))}},{key:"addActiveObjectToScene",value:function(t,e,n){var r=this,o=t.createSvgElement((function(t){t.setAttribute("class","activeMouse"),t.addEventListener("mouseenter",(function(){var e=function(t){var e=t;return t.getAttribute("data-id")||(e=t.closest("[".concat("data-id","]"))),{element:e,id:e.getAttribute("data-id"),kind:Number.parseInt(e.getAttribute("data-kind"))}}(t);r.currentObject=e,r.setHighlight(e)})),t.addEventListener("mouseleave",(function(){r.currentObject=null,r.clearHighlight()}))}));o&&(o.setAttribute("data-id",e),o.setAttribute("data-kind","".concat(n)),this.activeObjectGroup.appendChild(o))}},{key:"setHighlight",value:function(t){if(t.kind===br.Wire||t.kind===br.Pin){var e=this.paintInfo.sceneGroup.closest("svg");this.setupWireHighlight(null==e?void 0:e.getElementById(t.id),t.id)}else{var n=t.element.cloneNode(!0);n.setAttribute("data-id",t.id),n.setAttribute("data-kind",t.kind),this.highlightObjectGroup.appendChild(n)}}},{key:"clearHighlight",value:function(){for(;this.highlightObjectGroup.hasChildNodes();){var t=this.highlightObjectGroup.lastChild;if("style"===(null==t?void 0:t.nodeName))break;null==t||t.remove()}}},{key:"setupWireHighlight",value:function(t,e){var n=this;if(t&&t.localName){var r=t.localName;if("g"===r)this.forEveryChild(t,(function(t){return n.setupWireHighlight(t,e)}));else if("line"===r||"polyline"===r){var o=t.cloneNode(!0);o.setAttribute("data-id",e),o.hasAttribute("id")&&o.removeAttribute("id");var i=window.getComputedStyle(o)["stroke-width"],a=1;i.match(/^\-?\d+(\.?\d*)px$/)&&(a=parseFloat(i.substring(0,i.length-2))),o.setAttribute("stroke-width","".concat(a+2,"px")),this.highlightObjectGroup.appendChild(o)}}}},{key:"forEveryChild",value:function(t,e){for(var n=t.children,r=0;r<n.length;r++){var o=n[r];o&&e(o)}}},{key:"setPointData",value:function(t,e){var n=this.screenToSVG(e.x,e.y,this.paintInfo.sceneGroup.getScreenCTM());t.data.AreaLeft=Math.round(n.x)+5,t.data.AreaTop=Math.round(n.y)+5,t.data.AreaRight=Math.round(n.x)-5,t.data.AreaBottom=Math.round(n.y)-5}},{key:"setRectData",value:function(t,e){var n=this.screenToSVG(e.x,e.y,this.paintInfo.sceneGroup.getScreenCTM()),r=this.screenToSVG(e.x+e.width,e.y+e.height,this.paintInfo.sceneGroup.getScreenCTM());t.data.AreaLeft=Math.round(n.x),t.data.AreaTop=Math.round(n.y),t.data.AreaRight=Math.round(r.x),t.data.AreaBottom=Math.round(r.y)}}])&&St(e.prototype,n),o&&St(e,o),Object.defineProperty(e,"prototype",{writable:!1}),u}(bt);function Dt(t,e,n,r){var o=r;o||(o=t.closest("svg").createSVGPoint());o.x=e,o.y=n;var i=t.getScreenCTM();return i?o.matrixTransform(i.inverse()):o}var Lt=function(){var t=this._self._c;return t("svg",{staticStyle:{position:"absolute",left:"0",top:"0","pointer-events":"none","z-index":"0"},attrs:{id:this.elementId,xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%"}},[t("defs",[t("filter",{attrs:{id:"filter-comment-icon-full-d",x:"4",y:"5",width:"40",height:"40","filter-units":"userSpaceOnUse","color-interpolation-filters":"sRGB"}},[t("feFlood",{attrs:{"flood-opacity":"0",result:"BackgroundImageFix"}}),this._v(" "),t("feColorMatrix",{attrs:{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}}),this._v(" "),t("feOffset",{attrs:{dy:"1"}}),this._v(" "),t("feGaussianBlur",{attrs:{"std-deviation":"2"}}),this._v(" "),t("feColorMatrix",{attrs:{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.48 0"}}),this._v(" "),t("feBlend",{attrs:{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow"}}),this._v(" "),t("feBlend",{attrs:{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow",result:"shape"}})],1)])])};Lt._withStripped=!0;var Ct={name:"Overlay",data:function(t){return{elementId:t.$root.elementId}}},At=n(0),Rt=Object(At.a)(Ct,Lt,[],!1,null,null,null).exports,Mt=function(){var t=this,e=t._self._c;return e("g",{style:t.mainGroupStyle,attrs:{"data-id":t.renderInfo.id,transform:t.transform}},[e("line",{staticClass:"connection-line",style:t.connectionLineStyle,attrs:{x1:t.positionX,y1:t.positionY,x2:t.positionX,y2:t.positionY}}),t._v(" "),e("circle",{staticClass:"connection-point",style:t.connectionPointStyle,attrs:{cx:t.positionX,cy:t.positionY,r:"4"}}),t._v(" "),e("foreignObject",{staticClass:"main-icon",staticStyle:{overflow:"visible"},attrs:{height:"32",width:"1",x:t.iconPositionX,y:t.iconPositionY}},[e("div",{staticClass:"safari-hack-wrapper"},[e("CommentPin",{staticClass:"main-icon-interaction-group",attrs:{text:t.text,"is-active":t.isActive,align:t.iconAlign}})],1)])])};Mt._withStripped=!0;var Bt=function(){var t=this._self._c;return t("button",{staticClass:"comment-marker",class:this.classes},[this.isDot?this._e():t("span",{staticClass:"comment-marker--text"},[this._v("\n    "+this._s(this.text)+"\n  ")]),this._v(" "),t("Css",[this._v("\n    .comment-marker {\n      white-space: nowrap;\n      background: #ffffff;\n      border: 1px solid #181818;\n      border-radius: 4px 4px 4px 0;\n      height: 24px;\n      pointer-events: all;\n      padding: 6px 8px;\n      box-sizing: border-box;\n      display: inline-flex;\n      position: relative;\n    }\n    .comment-marker:after,\n    .comment-marker:before {\n      content: '';\n      display: block;\n      position: absolute;\n      width: 0;\n      height: 0;\n    }\n    .comment-marker:after {\n      top: 21px;\n      left: 0;\n      border-top: 7px solid #ffffff;\n      border-right: 7px solid transparent;\n    }\n    .comment-marker:before {\n      top: 22px;\n      left: -1px;\n      border-top: 9px solid #181818;\n      border-right: 9px solid transparent;\n    }\n    .comment-marker--text {\n      font-size: 11px;\n      line-height: 12px;\n    }\n    .comment-marker_left {\n      border-radius: 4px 0 4px 4px;\n    }\n    .comment-marker_left:before {\n      top: -1px;\n      left: auto;\n      right: -9px;\n    }\n    .comment-marker_left:after {\n      top: 0;\n      left: auto;\n      right: -7px;\n      border-top: 8px solid #ffffff;\n      border-right: 8px solid transparent;\n    }\n\n    .comment-marker_color-red {\n      background: #ff453a;\n      color: #ffffff;\n    }\n    .comment-marker_color-red:after,\n    .comment-marker_left.comment-marker_color-red:after {\n      border-top-color: #ff453a;\n    }\n\n    .comment-marker_color-orange {\n      background: #ff9f0a;\n      color: #ffffff;\n    }\n    .comment-marker_color-orange:after,\n    .comment-marker_left.comment-marker_color-orange:after {\n      border-top-color: #ff9f0a;\n    }\n\n    .comment-marker_color-green {\n      background: #30d158;\n      color: #ffffff;\n    }\n    .comment-marker_color-green:after,\n    .comment-marker_left.comment-marker_color-green:after {\n      border-top-color: #30d158;\n    }\n\n    .comment-marker_color-blue {\n      background: #267feb;\n      color: #ffffff;\n    }\n    .comment-marker_color-blue:after,\n    .comment-marker_left.comment-marker_color-blue:after {\n      border-top-color: #267feb;\n    }\n    .comment-marker.is-dot {\n      border: none;\n      border-radius: 50px;\n      height: 8px;\n      width: 8px;\n      padding: 0;\n    }\n    .comment-marker.is-dot:before,\n    .comment-marker.is-dot:after {\n      display: none;\n    }\n  ")])],1)};Bt._withStripped=!0;var Nt={name:"Css",functional:!0,render:function(t,e){return t("style",e.children)}},Vt=Object(At.a)(Nt,void 0,void 0,!1,null,null,null).exports,Gt=["top","left"],Ft=["default","red","orange","green","blue"],Ht={name:"CommentPin",components:{Css:Vt},props:{text:{type:[Number,String],required:!0,default:""},isActive:{type:Boolean,required:!0,default:!1},isDot:{type:Boolean,default:!1},align:{type:String,default:"top",validator:function(t){return Gt.includes(t)}},color:{type:String,default:"default",validator:function(t){return Ft.includes(t)}}},computed:{classes:function(){return[{"is-dot":this.isDot},"comment-marker_".concat(this.align),"comment-marker_color-".concat(this.isActive?"blue":this.color)]}}},Wt=Object(At.a)(Ht,Bt,[],!1,null,null,null).exports;function Ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Yt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ut(Object(n),!0).forEach((function(e){zt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ut(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function zt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var qt=window.__APP__.library.Vuex.mapGetters,Xt={name:"IconGroup",components:{CommentPin:Wt},data:function(t){return{renderInfo:t.$root.renderInfo,scale:t.$root.scale}},computed:Yt(Yt({},qt(["threadById"])),{},{thread:function(){return this.threadById(this.renderInfo.id)},text:function(){var t,e,n;return(null===(t=this.thread)||void 0===t||null===(e=t.properties)||void 0===e?void 0:e.LwTaskHrid)||(null===(n=this.thread)||void 0===n?void 0:n.threadNumber)||this.renderInfo.threadNumber},transform:function(){return"matrix(".concat(this.scale.x," 0 0 ").concat(this.scale.y," -24 -24)")},visible:function(){return this.renderInfo.visible},state:function(){return this.renderInfo.state},status:function(){return this.renderInfo.status},isActive:function(){return 1===this.state},mainGroupStyle:function(){var t={opacity:1===this.renderInfo.status?1:.48};return this.visible||(t.display="none"),t},mainIconStyle:function(){return{fill:"none","fill-opacity":"1",stroke:"none","stroke-opacity":"1",cursor:"pointer","pointer-events":"all"}},connectionLineStyle:function(){var t={stroke:"#267FEB","stroke-width":"2"};return 0===this.state&&(t.display="none"),t},connectionPointStyle:function(){var t={fill:"#267FEB","fill-opacity":"1",stroke:"none"};return 0===this.state&&(t.display="none"),t},positionX:function(){return(this.renderInfo.iconPosition.x+24)/this.scale.x},positionY:function(){return(this.renderInfo.iconPosition.y+24)/this.scale.y},iconPositionX:function(){var t="left"===this.renderInfo.align?-31:0;return this.positionX+t},iconPositionY:function(){var t="left"===this.renderInfo.align?0:-31;return this.positionY+t},iconAlign:function(){return this.renderInfo.align||"top"}}),mounted:function(){this.renderInfo.iconSvg=this.$el.querySelector(".main-icon"),this.renderInfo.mainCircleGroup=this.$el.querySelector(".main-icon-interaction-group")}},Zt=(n(1251),Object(At.a)(Xt,Mt,[],!1,null,"43677227",null).exports);function Jt(t){return(Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Qt(t,e){return(Qt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function $t(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ee(t);if(e){var o=ee(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return te(this,n)}}function te(t,e){if(e&&("object"===Jt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ee(t){return(ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ne=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qt(t,e)}(i,t);var e,n,r,o=$t(i);function i(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),o.call(this,{store:Cf.store,data:{renderInfo:t,scale:e},render:function(t){return t(Zt)}})}return e=i,(n=[{key:"mount",value:function(t){var e=document.createElement("div");t.appendChild(e),this.$mount(e)}}])&&Kt(e.prototype,n),r&&Kt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(window.__APP__.library.Vue);function re(t){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ie(t,e){return(ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function ae(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=se(t);if(e){var o=se(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ce(this,n)}}function ce(t,e){if(e&&("object"===re(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ue(t)}function ue(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function se(t){return(se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var le,he=window.__APP__.library.Vue;!function(t){t[t.None=0]="None",t[t.Selected=1]="Selected"}(le||(le={}));var pe,de=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ie(t,e)}(i,t);var e,n,r,o=ae(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),fe(ue(e=o.call(this,{data:{elementId:t},render:function(t){return t(Rt)}})),"groupViews",[]),fe(ue(e),"scale",{x:1,y:1}),e}return e=i,(n=[{key:"add",value:function(t){var e=new ne(t,this.scale);this.groupViews.push(e),e.mount(this.$el)}},{key:"remove",value:function(t){var e=this.groupViews.findIndex((function(e){return e.renderInfo===t}));if(e>-1){var n=this.groupViews[e];this.groupViews.splice(e,1),n.$el.remove()}}},{key:"mount",value:function(t){var e=document.createElement("div");t.appendChild(e),this.$mount(e),this.onWindowResize=this.onWindowResize.bind(this),window.addEventListener("resize",this.onWindowResize),this.onWindowResize()}},{key:"destroy",value:function(){var t;window.removeEventListener("resize",this.onWindowResize),this.$destroy(),null===(t=this.$el.parentNode)||void 0===t||t.removeChild(this.$el)}},{key:"onWindowResize",value:function(){var t=this.$el.createSVGPoint(),e=Dt(this.$el,0,0,t),n=Dt(this.$el,10,10,t);this.scale.x=(n.x-e.x)/10,this.scale.y=(n.y-e.y)/10}}])&&oe(e.prototype,n),r&&oe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(he);function ye(t){return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ve(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function me(t,e){return(me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function be(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ee(t);if(e){var o=Ee(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ge(this,n)}}function ge(t,e){if(e&&("object"===ye(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return we(t)}function we(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ee(t){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Oe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.None=0]="None",t[t.Hover=1]="Hover",t[t.Down=2]="Down"}(pe||(pe={}));var Se=new Map([["None",{sr:0}],["Hover",{sr:20}],["Down",{sr:24}],["Selected",{sr:24}]]),Pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&me(t,e)}(a,t);var e,n,o,i=be(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Oe(we(e=i.call(this)),"config",void 0),Oe(we(e),"renderInfo",void 0),Oe(we(e),"moved",!1),Oe(we(e),"startPoint",{x:0,y:0}),Oe(we(e),"mouseState",pe.None),Oe(we(e),"svgPoint",void 0),Oe(we(e),"toString",(function(){return"CommentsDrawingEngine.Icon"})),e.config=t,e.renderInfo={id:e.config.guid,visible:!0,state:le.None,status:r.Active,iconPosition:{x:0,y:0},pointPosition:{x:24,y:24},threadNumber:"#",shadowRadius:0,align:t.iconAlign,scrollable:t.scrollable},e.config.overlayView.add(e.renderInfo),e.initEvents(),e.svgPoint=t.overlayView.$el.closest("svg").createSVGPoint(),e.onChange(),e}return e=a,(n=[{key:"number",set:function(t){this.renderInfo.threadNumber=t}},{key:"visible",set:function(t){this.renderInfo.visible=t}},{key:"state",set:function(t){switch(t){case"WAIT_FOR_POST":case"PROGRESS_ACTIVE":this.renderInfo.state=le.Selected,this.renderInfo.status=r.Active,this.renderInfo.mainCircleGroup.addEventListener("mousedown",this.onMouseDown),this.refreshIconShadow();break;case"PROGRESS":this.renderInfo.state=le.None,this.renderInfo.status=r.Active,this.renderInfo.mainCircleGroup.removeEventListener("mousedown",this.onMouseDown),this.refreshIconShadow();break;case"RESOLVE_ACTIVE":this.renderInfo.state=le.Selected,this.renderInfo.status=r.Resolved,this.renderInfo.mainCircleGroup.addEventListener("mousedown",this.onMouseDown),this.refreshIconShadow();break;case"RESOLVE":this.renderInfo.state=le.None,this.renderInfo.status=r.Resolved,this.renderInfo.mainCircleGroup.removeEventListener("mousedown",this.onMouseDown),this.refreshIconShadow()}}},{key:"clientBox",get:function(){return this.renderInfo.iconSvg.getBoundingClientRect()}},{key:"destroy",value:function(){this.config.observableObject.off("change",this.onChange),this.config.observableObject.destroy(),this.config.overlayView.remove(this.renderInfo),this.emit("DESTROY")}},{key:"onChange",value:function(){var t=this,e=this.config.observableObject.areaPoint.x,n=this.config.observableObject.areaPoint.y,r=this.config.observableObject.textPoint.x,o=this.config.observableObject.textPoint.y,i=Dt(this.config.overlayView.$el,e,n,this.svgPoint),a=i;r===e&&o===n||(a=Dt(this.config.overlayView.$el,r,o,this.svgPoint)),(this.renderInfo.iconPosition.x!==a.x||this.renderInfo.iconPosition.y!==a.y||this.renderInfo.pointPosition.x!==i.x||this.renderInfo.pointPosition.y!==i.y||this.renderInfo.scrollable)&&(this.renderInfo.iconPosition.x=a.x,this.renderInfo.iconPosition.y=a.y,this.renderInfo.pointPosition.x=i.x,this.renderInfo.pointPosition.y=i.y,this.config.overlayView.$nextTick((function(){return t.emit("MOVING")})))}},{key:"initEvents",value:function(){var t=this;this.onChange=this.onChange.bind(this),this.config.observableObject.on("change",this.onChange),this.onClick=this.onClick.bind(this),this.renderInfo.mainCircleGroup.addEventListener("click",this.onClick,!0),this.onMouseEnter=this.onMouseEnter.bind(this),this.renderInfo.mainCircleGroup.addEventListener("mouseenter",this.onMouseEnter,!0),this.onMouseLeave=this.onMouseLeave.bind(this),this.renderInfo.mainCircleGroup.addEventListener("mouseleave",this.onMouseLeave,!0),this.onMouseDown=this.onMouseDown.bind(this),this.onMove=this.onMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.renderInfo.mainCircleGroup.addEventListener("mousedown",(function(e){0===e.button&&(t.mouseState|=pe.Down,t.refreshIconShadow())})),this.renderInfo.mainCircleGroup.addEventListener("mouseup",(function(e){0===e.button&&(t.mouseState&=~pe.Down,t.refreshIconShadow())})),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.renderInfo.mainCircleGroup.addEventListener("touchstart",this.onTouchStart,!0)}},{key:"refreshIconShadow",value:function(){var t="None";this.renderInfo.state===le.Selected?t="Selected":0!=(this.mouseState&pe.Down)?t="Down":0!=(this.mouseState&pe.Hover)&&(t="Hover");var e=Se.get(t);this.renderInfo.shadowRadius=e.sr}},{key:"stopBubble",value:function(t){t.stopPropagation(),t.preventDefault()}},{key:"onClick",value:function(t){this.moved?this.moved=!1:this.emit("CLICK"),this.stopBubble(t)}},{key:"onMouseEnter",value:function(t){if(t.target===this.renderInfo.mainCircleGroup){this.mouseState|=pe.Hover,this.refreshIconShadow();var e=this.renderInfo.mainCircleGroup.getBoundingClientRect(),n=e.x+e.width,r=e.y+e.height/2;this.emit("ENTER",n,r)}}},{key:"onMouseLeave",value:function(t){t.target===this.renderInfo.mainCircleGroup&&(this.mouseState&=~pe.Hover,this.mouseState&=~pe.Down,this.refreshIconShadow(),this.emit("LEAVE"))}},{key:"onMouseDown",value:function(t){0===t.button&&(this.startPoint.x=t.clientX,this.startPoint.y=t.clientY,window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMove),this.stopBubble(t))}},{key:"onMouseUp",value:function(t){this.mouseState&=~pe.Down,this.refreshIconShadow(),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMove),this.emit("MOVED"),this.stopBubble(t)}},{key:"onMove",value:function(t){this.moved=!0;var e=this.config.observableObject.textPoint.x+t.clientX-this.startPoint.x,n=this.config.observableObject.textPoint.y+t.clientY-this.startPoint.y;this.startPoint.x=t.clientX,this.startPoint.y=t.clientY,this.emit("TRY_MOVING",e,n)}},{key:"onTouchStart",value:function(t){1===t.touches.length&&(this.startPoint.x=t.touches[0].clientX,this.startPoint.y=t.touches[0].clientY,window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),this.stopBubble(t)),2===t.touches.length&&(window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd))}},{key:"onTouchMove",value:function(t){this.moved=!0;var e=this.config.observableObject.textPoint.x+t.touches[0].clientX-this.startPoint.x,n=this.config.observableObject.textPoint.y+t.touches[0].clientY-this.startPoint.y;this.startPoint.x=t.touches[0].clientX,this.startPoint.y=t.touches[0].clientY,this.emit("TRY_MOVING",e,n)}},{key:"onTouchEnd",value:function(t){1===t.touches.length&&(window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd)),0===t.touches.length&&(window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),this.emit("MOVED"),this.stopBubble(t))}}])&&ve(e.prototype,n),o&&ve(e,o),Object.defineProperty(e,"prototype",{writable:!1}),a}(k.a);function xe(t){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ie(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Te(){return(Te="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=ke(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function ke(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ce(t)););return t}function je(t,e){return(je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _e(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ce(t);if(e){var o=Ce(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return De(this,n)}}function De(t,e){if(e&&("object"===xe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Le(t)}function Le(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ce(t){return(Ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ae(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Re={where:function(t){return["SHOW_ACTIVE"===t.type]},to:"SHOW_ACTIVE"},Me={where:function(t){return["IDLE"===t.type]},to:"IDLE"},Be={IDLE:[{where:function(t){return["SHOW"===t.type]},to:"SHOW"}],SHOW:[Me,Re],SHOW_INACTIVE:[Me,Re],SHOW_ACTIVE:[{where:function(t){return["SHOW_INACTIVE"===t.type]},to:"SHOW_INACTIVE"}]},Ne=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&je(t,e)}(i,t);var e,n,r,o=_e(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Ae(Le(e=o.call(this,"IDLE",Be)),"destroyed",!1),Ae(Le(e),"logger",void 0),i.prototype.toString=function(){return null!=t?t:"?????"},e.logger=c.createLogger("CPGraphicsEditMode_".concat(t)),e.onShow=e.onShow.bind(Le(e)),e.on("SHOW",e.onShow),e.onHide=e.onHide.bind(Le(e)),e.on("IDLE",e.onHide),e.onActivate=e.onActivate.bind(Le(e)),e.on("SHOW_ACTIVE",e.onActivate),e.onDeactivate=e.onDeactivate.bind(Le(e)),e.on("SHOW_INACTIVE",e.onDeactivate),e}return e=i,(n=[{key:"dispatch",value:function(t){return Te(Ce(i.prototype),"dispatch",this).call(this,t)}},{key:"show",value:function(){this.dispatch({type:"SHOW"})}},{key:"hide",value:function(){this.stop(),this.dispatch({type:"IDLE"})}},{key:"start",value:function(){this.dispatch({type:"SHOW_ACTIVE"})}},{key:"stop",value:function(){this.dispatch({type:"SHOW_INACTIVE"})}},{key:"destroy",value:function(){this.hide(),this.destroyed||(this.destroyed=!0,this.onDestroy())}},{key:"getBoundBox",value:function(){var t=this.getBoundRect();return{isInfinite:t.isInfinite,min:{x:t.left,y:t.top,z:0},max:{x:t.left+t.width,y:t.top+t.height,z:0}}}},{key:"onShow",value:function(){}},{key:"onActivate",value:function(){}},{key:"onDeactivate",value:function(){}},{key:"onHide",value:function(){}},{key:"onDestroy",value:function(){}}])&&Ie(e.prototype,n),r&&Ie(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(u.a);function Ve(t){return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ge(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fe(t,e){return(Fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function He(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ye(t);if(e){var o=Ye(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return We(this,n)}}function We(t,e){if(e&&("object"===Ve(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ue(t)}function Ue(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ye(t){return(Ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ze(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var qe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fe(t,e)}(i,t);var e,n,r,o=He(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),ze(Ue(n=o.call(this,"Main")),"modes",new Map),ze(Ue(n),"active",null),n.modes.set("text",t),e&&n.modes.set("drawing",e),n.onChangeEditMode=n.onChangeEditMode.bind(Ue(n)),n}return e=i,(n=[{key:"getBoundRect",value:function(){var t={isInfinite:!0};return Array.from(this.modes.values()).forEach((function(e){if(e){var n=e.getBoundRect();n.isInfinite||(t.isInfinite?(t.isInfinite=!1,t.left=n.left,t.top=n.top,t.width=n.width,t.height=n.height):(t.left=Math.min(t.left,n.left),t.top=Math.min(t.top,n.top),t.width=Math.max(t.left+t.width,n.left+n.width)-t.left,t.height=Math.max(t.top+t.height,n.top+n.height)-t.top))}})),t}},{key:"getBoundBox",value:function(){var t={isInfinite:!0};return Array.from(this.modes.values()).forEach((function(e){if(e){var n=e.getBoundBox();n.isInfinite||(t.isInfinite?(t.isInfinite=!1,t.min=n.min,t.min=n.min):(t.min={x:Math.min(t.min.x,n.min.x),y:Math.min(t.min.y,n.min.y),z:Math.min(t.min.z,n.min.z)},t.max={x:Math.max(t.max.x,n.max.x),y:Math.max(t.max.y,n.max.y),z:Math.max(t.max.z,n.max.z)}))}})),t}},{key:"onShow",value:function(){Array.from(this.modes.values()).forEach((function(t){return t.show()}))}},{key:"onHide",value:function(){Array.from(this.modes.values()).forEach((function(t){return t.hide()}))}},{key:"onDestroy",value:function(){Array.from(this.modes.values()).forEach((function(t){return t.destroy()}))}},{key:"onActivate",value:function(){c.bus.on("CommentsDrawingEngine:changeEditMode",this.onChangeEditMode),this.onChangeEditMode("text")}},{key:"onDeactivate",value:function(){var t;null===(t=this.active)||void 0===t||t.stop(),this.active=null,c.bus.off("CommentsDrawingEngine:changeEditMode",this.onChangeEditMode)}},{key:"onChangeEditMode",value:function(t){var e,n;null===(e=this.active)||void 0===e||e.stop(),this.active=this.modes.get(t),null===(n=this.active)||void 0===n||n.start()}}])&&Ge(e.prototype,n),r&&Ge(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ne);function Xe(t){return(Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Je(t,e){return(Je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ke(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=tn(t);if(e){var o=tn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Qe(this,n)}}function Qe(t,e){if(e&&("object"===Xe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return $e(t)}function $e(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tn(t){return(tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function en(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var nn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Je(t,e)}(i,t);var e,n,r,o=Ke(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),en($e(n=o.call(this)),"logger",void 0),en($e(n),"icon",null),en($e(n),"editMode",null),en($e(n),"dataStore",void 0),en($e(n),"areaPoint",{x:0,y:0}),en($e(n),"textPoint",{x:0,y:0}),en($e(n),"toString",(function(){return"CommentsDrawingEngine.Painters.Base"})),n.logger=c.createLogger("CPGraphicsPainter_".concat(t)),n.dataStore=e,n.onIconMoved=n.onIconMoved.bind($e(n)),n.onIconTryMoving=n.onIconTryMoving.bind($e(n)),n.onIconMoving=n.onIconMoving.bind($e(n)),n.onIconEnter=n.onIconEnter.bind($e(n)),n.onIconLeave=n.onIconLeave.bind($e(n)),n.onIconClick=n.onIconClick.bind($e(n)),n}return e=i,(n=[{key:"iconRect",get:function(){var t={isInfinite:!0};if(this.icon){var e=this.icon.clientBox;t.top=e.top,t.left=e.left,t.width=e.width,t.height=e.height,t.isInfinite=!1}return t}},{key:"paint",value:function(t,e){var n=this.createAndInitEditMode();n&&(this.editMode=n,this.icon=this.createAndInitIcon(),this.updateState(t),this.updateVisibility(e))}},{key:"destroy",value:function(){var t,e;null===(t=this.icon)||void 0===t||t.destroy(),this.icon=null,null===(e=this.editMode)||void 0===e||e.destroy(),this.editMode=null,this.emit("DESTROYED")}},{key:"updateVisibility",value:function(t){this.icon&&(this.icon.visible=t)}},{key:"updateState",value:function(t){var e=this;this.icon&&(this.icon.state=t);var n=function(){var t;return null===(t=e.editMode)||void 0===t?void 0:t.start()},r=function(){var t;return null===(t=e.editMode)||void 0===t?void 0:t.stop()};if(this.editMode)switch(t){case"WAIT_FOR_POST":this.editMode.show(),this.editMode.start(),this.emit("ICON_MOVING");break;case"PROGRESS_ACTIVE":case"RESOLVE_ACTIVE":this.editMode.show(),c.bus.on("CommentsDrawingEngine:startEdit",n),c.bus.on("CommentsDrawingEngine:stopEdit",r),this.emit("ICON_MOVING");break;default:c.bus.off("CommentsDrawingEngine:startEdit",n),c.bus.off("CommentsDrawingEngine:stopEdit",r),this.editMode.hide()}}},{key:"zoomToFit",value:function(){}},{key:"createIcon",value:function(){var t={};return t.observableObject=this.getObservableObject(),t.overlayView=this.getIconOverlayView(),t.guid=this.dataStore.guid,t.type=this.dataStore.type,new Pe(t)}},{key:"tryCommitIconPosition",value:function(){return!0}},{key:"tryMoveIcon",value:function(t){return!1}},{key:"createAndInitIcon",value:function(){var t=this,e=this.createIcon();return this.dataStore.threadNumber>0&&(e.number="".concat(this.dataStore.threadNumber)),e.on("MOVED",this.onIconMoved),e.on("TRY_MOVING",this.onIconTryMoving),e.on("MOVING",this.onIconMoving),e.on("ENTER",this.onIconEnter),e.on("LEAVE",this.onIconLeave),e.on("CLICK",this.onIconClick),e.on("DESTROY",(function(){e.off("MOVED",t.onIconMoved),e.off("TRY_MOVING",t.onIconTryMoving),e.off("MOVING",t.onIconMoving),e.off("ENTER",t.onIconEnter),e.off("LEAVE",t.onIconLeave),e.off("CLICK",t.onIconClick)})),e}},{key:"createAndInitEditMode",value:function(){var t=this.createTextEditMode(this.dataStore);if(!t)return null;var e=this.createDrawingEditMode(this.dataStore);return e?new qe(t,e):new qe(t)}},{key:"onIconMoved",value:function(){this.tryCommitIconPosition()&&this.emit("ICON_MOVED")}},{key:"onIconMoving",value:function(){this.emit("ICON_MOVING")}},{key:"onIconTryMoving",value:function(t,e){var n={x:t,y:e};if(this.tryMoveIcon(n)){var r=this.dataStore.data;if(r.TextRight-r.TextLeft||r.TextBottom-r.TextTop){var o=r.TextRight-r.TextLeft,i=r.TextBottom-r.TextTop;r.TextLeft=n.x,r.TextTop=n.y,r.TextRight=r.TextLeft+o,r.TextBottom=r.TextTop+i}else r.TextLeft=n.x,r.TextTop=n.y,r.TextRight=n.x+105,r.TextBottom=n.y+50;this.textPoint.x=n.x,this.textPoint.y=n.y,this.emit("SCENE_CHANGED")}}},{key:"onIconEnter",value:function(t,e){}},{key:"onIconLeave",value:function(){}},{key:"onIconClick",value:function(){this.emit("CHANGE_STATE")}}])&&Ze(e.prototype,n),r&&Ze(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(k.a);function rn(t){return(rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function on(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function an(t,e){return(an=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function cn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=fn(t);if(e){var o=fn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return un(this,n)}}function un(t,e){if(e&&("object"===rn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return sn(t)}function sn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function fn(t){return(fn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ln(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var hn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&an(t,e)}(i,t);var e,n,r,o=cn(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),ln(sn(e=o.call(this)),"owner",void 0),ln(sn(e),"toString",(function(){return"CommentsDrawingEngine.Icon.ObservableObject"})),e.owner=t,e.onSceneChanged=e.onSceneChanged.bind(sn(e)),e.owner.on("SCENE_CHANGED",e.onSceneChanged),e}return e=i,(n=[{key:"areaPoint",get:function(){return this.owner.areaScreenPoint}},{key:"textPoint",get:function(){return this.owner.textScreenPoint}},{key:"destroy",value:function(){this.owner.off("SCENE_CHANGED",this.onSceneChanged)}},{key:"onSceneChanged",value:function(){this.emit("change")}}])&&on(e.prototype,n),r&&on(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(k.a);function pn(t,e,n,r){var o=r;o||(o=t.closest("svg").createSVGPoint());o.x=e,o.y=n;var i=t.getScreenCTM();return i?o.matrixTransform(i):o}function dn(t){return(dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vn(t,e){return(vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function mn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=wn(t);if(e){var o=wn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return bn(this,n)}}function bn(t,e){if(e&&("object"===dn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return gn(t)}function gn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wn(t){return(wn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function En(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var On=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vn(t,e)}(i,t);var e,n,r,o=mn(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),En(gn(n=o.call(this,t.type)),"nodes",[]),En(gn(n),"dataStore",void 0),En(gn(n),"paintInfo",void 0),En(gn(n),"obj",void 0),n.dataStore=t,n.paintInfo=e,n.rectangleFromData(t,e.sceneGroup),n}return e=i,(n=[{key:"getBoundRect",value:function(){var t,e={isInfinite:!1};if(null!==(t=this.obj)&&void 0!==t&&t.node){var n=this.obj.node.getBBox();e.left=n.x,e.top=n.y,e.width=n.width,e.height=n.height}else{var r=this.dataStore.data;e.left=Math.min(r.AreaLeft,r.AreaRight),e.top=Math.min(r.AreaTop,r.AreaBottom),e.width=Math.abs(r.AreaLeft-r.AreaRight),e.height=Math.abs(r.AreaTop-r.AreaBottom)}return e}},{key:"onShow",value:function(){this.nodes.forEach((function(t){return t.setAttribute("display","")}))}},{key:"onHide",value:function(){this.nodes.forEach((function(t){return t.setAttribute("display","none")}))}},{key:"onDestroy",value:function(){this.nodes.forEach((function(t){return t.remove()})),this.nodes=[]}},{key:"setRectangle",value:function(t,e,n){var r=wt("rect",{class:"thread-contour","vector-effect":"non-scaling-stroke",display:"none","data-guid":t.guid,fill:"none",stroke:"#267FEB","stroke-width":"4","stroke-opacity":"0.48","stroke-linecap":"round","stroke-linejoin":"round"});if(e.appendChild(r),this.nodes.push(r),n)r.x.baseVal.value=n.x,r.y.baseVal.value=n.y,r.width.baseVal.value=n.width,r.height.baseVal.value=n.height;else{var o=t.data;r.x.baseVal.value=Math.min(o.AreaLeft,o.AreaRight),r.y.baseVal.value=Math.min(o.AreaTop,o.AreaBottom),r.width.baseVal.value=Math.abs(o.AreaLeft-o.AreaRight),r.height.baseVal.value=Math.abs(o.AreaTop-o.AreaBottom)}}},{key:"setWire",value:function(t,e){var n=this;if(t&&t.localName){var r=t.localName;if("g"===r)this.forEveryChild(t,(function(t){return n.setWire(t,e)}));else if("line"===r||"polyline"===r){var o=t.cloneNode(!0);o.hasAttribute("id")&&o.removeAttribute("id");var i=window.getComputedStyle(o)["stroke-width"],a=1;i.match(/^\-?\d+(\.?\d*)px$/)&&(a=parseFloat(i.substring(0,i.length-2))),o.setAttribute("stroke-width","".concat(a+2,"px")),o.style.fill="none",o.style.stroke="#267FEB",o.style.strokeOpacity="0.48",o.style.pointerEvents="none",this.nodes.push(o),e.appendChild(o)}}}},{key:"forEveryChild",value:function(t,e){for(var n=t.children,r=0;r<n.length;r++){var o=n[r];o&&e(o)}}},{key:"rectangleFromData",value:function(t,e){switch(t.type){case"OBJECT":var n=this.dataStore.data.ObjectUniqueID;if(this.obj=this.paintInfo.objects.find((function(t){return t.node.getAttribute("id")===n})),this.obj)if(this.obj.kind===br.Wire||this.obj.kind===br.Pin)this.setWire(this.obj.node,e);else{var r=this.obj.node.getBBox();this.setRectangle(t,e,r)}else this.setRectangle(t,e);break;case"POINT":break;case"AREA":this.setRectangle(t,e);break;case"REDLINE":this.setRectangle(t,e);var o=wt("g",{class:"redline-thread-drawing","vector-effect":"non-scaling-stroke",display:"none","data-guid":t.guid,stroke:"rgb(236, 64, 37)","stroke-width":"2px","stroke-opacity":"1",fill:"none"});e.appendChild(o),this.nodes.push(o),this.drawRedline(o,t)}}},{key:"drawRedline",value:function(t,e){var n,r,o,i,a;if(null!==(n=e.data)&&void 0!==n&&null!==(r=n.SerializedData)&&void 0!==r&&r.Vertices){var c=t.closest("svg");null==e||null===(o=e.data)||void 0===o||null===(i=o.SerializedData)||void 0===i||null===(a=i.Vertices)||void 0===a||a.forEach((function(e){if(e){var n=wt("polyline",{});e.forEach((function(t,e){if(e){var r=c.createSVGPoint();r.x=t.X,r.y=t.Y,n.points.appendItem(r)}})),t.appendChild(n)}}))}}}])&&yn(e.prototype,n),r&&yn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ne);function Sn(t){return(Sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pn(t){return function(t){if(Array.isArray(t))return xn(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return xn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xn(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function In(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Tn(t,e){return(Tn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function kn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Dn(t);if(e){var o=Dn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return jn(this,n)}}function jn(t,e){if(e&&("object"===Sn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _n(t)}function _n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Dn(t){return(Dn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ln(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Cn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tn(t,e)}(a,t);var e,n,r,i=kn(a);function a(t,e,n,r,o){var c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Ln(_n(c=i.call(this,null!=o?o:"Drawing")),"color","#FF0000"),Ln(_n(c),"lineThicknessData",{id:1,thickness:2}),Ln(_n(c),"workspace",void 0),Ln(_n(c),"oldCursor",void 0),Ln(_n(c),"canvas",void 0),Ln(_n(c),"poly",null),Ln(_n(c),"points",[]),Ln(_n(c),"dataStore",void 0),Ln(_n(c),"point",void 0),Ln(_n(c),"onChanged",void 0),Ln(_n(c),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.Drawing"})),c.dataStore=t,c.onChanged=r,c.workspace=e,c.canvas=wt("g",{class:"thread-custom-drawing",display:"none","data-guid":t.guid}),n.appendChild(c.canvas),c.onColorChanged=c.onColorChanged.bind(_n(c)),c.onLineChanged=c.onLineChanged.bind(_n(c)),c.onDeleteDrawing=c.onDeleteDrawing.bind(_n(c)),c.onMouseDown=c.onMouseDown.bind(_n(c)),c.onMouseMove=c.onMouseMove.bind(_n(c)),c.onMouseUp=c.onMouseUp.bind(_n(c)),c.onMouseLeave=c.onMouseLeave.bind(_n(c)),c.onTouchStart=c.onTouchStart.bind(_n(c)),c.onTouchMove=c.onTouchMove.bind(_n(c)),c.onTouchEnd=c.onTouchEnd.bind(_n(c)),c.point=n.closest("svg").createSVGPoint(),c.drawBasicPoints(),c}return e=a,(n=[{key:"xPrecision",get:function(){return 1}},{key:"yPrecision",get:function(){return 1}},{key:"getBoundRect",value:function(){var t,e,n={isInfinite:!0},r=null===(t=this.dataStore)||void 0===t||null===(e=t.drawing)||void 0===e?void 0:e.Items;if(r&&r.length){n.isInfinite=!1;var o=r.map((function(t){return{AreaLeft:Math.min(t.AreaLeft,t.AreaRight),AreaRight:Math.max(t.AreaLeft,t.AreaRight),AreaTop:Math.min(t.AreaTop,t.AreaBottom),AreaBottom:Math.max(t.AreaTop,t.AreaBottom)}})),i=Math.min.apply(Math,Pn(o.map((function(t){return t.AreaLeft})))),a=Math.min.apply(Math,Pn(o.map((function(t){return t.AreaTop})))),c=Math.max.apply(Math,Pn(o.map((function(t){return t.AreaRight})))),u=Math.max.apply(Math,Pn(o.map((function(t){return t.AreaBottom}))));n.left=i,n.top=a,n.width=c-i,n.height=u-a}return n}},{key:"onShow",value:function(){this.canvas.setAttribute("display","")}},{key:"onHide",value:function(){this.canvas.setAttribute("display","none")}},{key:"onDestroy",value:function(){this.canvas.remove()}},{key:"onActivate",value:function(){var t,e;c.bus.on("CommentsDrawingEngine:startColorPicker",this.onColorChanged),c.bus.on("CommentsDrawingEngine:startLinePicker",this.onLineChanged),c.bus.on("CommentsDrawingEngine:deleteDrawing",this.onDeleteDrawing),this.workspace.addEventListener("mousedown",this.onMouseDown,!0),this.workspace.addEventListener("mousemove",this.onMouseMove,!0),this.workspace.addEventListener("touchstart",this.onTouchStart,!0),this.oldCursor=null!==(t=null===(e=window.getComputedStyle(this.workspace,null))||void 0===e?void 0:e.cursor)&&void 0!==t?t:"auto",this.workspace.style.cursor="url('".concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAUCAYAAABWMrcvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADiSURBVHgBtVNBEcIwEFxQUAnBARLqAAnEATigKEACsYCCSqiEgILiAK7TvclBm9APN7OTabPb3bukwB/qIIiCTtAK3C+BJ1nL8XlbEnV0uSI5DGu7Rj7WTbARPBjtxL1qTuBIqrjquyDo6TypYXPPL2s0Jc4Ow5mNnms0HznOubQmSoNxghFpcpPyjFGTWBlBoFvWJRZ6+ijN6zM9OUtembxnxgD7eQruGG/AZACBpGCiVUjn5JDpRU/ZI12dCzLNq9O3fUMxSiK9Hg7pgOuSqBHsKH4tEYDR4lKy1hYL/khbb0RWQQonlxdXAAAAAElFTkSuQmCC","') 0 20, auto")}},{key:"onDeactivate",value:function(){c.bus.off("CommentsDrawingEngine:startColorPicker",this.onColorChanged),c.bus.off("CommentsDrawingEngine:startLinePicker",this.onLineChanged),c.bus.off("CommentsDrawingEngine:deleteDrawing",this.onDeleteDrawing),this.workspace.removeEventListener("mousedown",this.onMouseDown,!0),this.workspace.removeEventListener("mousemove",this.onMouseMove,!0),this.workspace.removeEventListener("mouseup",this.onMouseUp,!0),this.workspace.removeEventListener("mouseleave",this.onMouseLeave,!0),this.workspace.removeEventListener("touchstart",this.onTouchStart,!0),this.workspace.removeEventListener("touchmove",this.onTouchMove,!0),this.workspace.removeEventListener("touchend",this.onTouchEnd,!0),this.workspace.style.cursor=this.oldCursor}},{key:"onColorChanged",value:function(t){var e,n,r;this.color=null!==(e=null===(n=Cf.colorPickerData)||void 0===n||null===(r=n.find((function(e){return e.id===t.id})))||void 0===r?void 0:r.color)&&void 0!==e?e:this.color}},{key:"onLineChanged",value:function(t){var e,n;this.lineThicknessData=null!==(e=null===(n=Cf.lineThicknessData)||void 0===n?void 0:n.find((function(e){return e.id===t.id})))&&void 0!==e?e:this.lineThicknessData}},{key:"onDeleteDrawing",value:function(){this.canvas.querySelectorAll("[data-edit]").forEach((function(t){var e=t.didClearItem;e&&(t.dispatchEvent(e),t.remove())})),this.onChanged&&this.onChanged()}},{key:"drawBasicPoints",value:function(){var t,e,n=this,r=this.canvas.closest("svg");null===(t=this.dataStore.drawing)||void 0===t||null===(e=t.Items)||void 0===e||e.forEach((function(t){if(t&&t.Type===o.Polyline){var e,i,a=t,c=null!==(e=Cf.lineThicknessData.find((function(e){return e.id===t.LineSize})))&&void 0!==e?e:n.lineThicknessData,u=t.Color?t.Color:n.color,s=n.createDrawingPolyline(u,c.thickness);n.canvas.appendChild(s),null===(i=a.Vertices)||void 0===i||i.forEach((function(t){var e=r.createSVGPoint();e.x=t.X*n.xPrecision,e.y=t.Y*n.yPrecision,s.points.appendItem(e)}))}}))}},{key:"drawPoint",value:function(t,e,n){var r=this,i=Dt(this.canvas,t,e,this.point);if(1===n)this.points.length=0,this.poly=this.createDrawingPolyline(this.color,this.lineThicknessData.thickness),this.poly.setAttribute("data-edit",""),this.canvas.appendChild(this.poly),this.poly.points.appendItem(i),this.points.push({X:i.x/this.xPrecision,Y:i.y/this.yPrecision});else if(0===n)this.poly&&(this.poly.points.appendItem(i),this.points.push({X:i.x/this.xPrecision,Y:i.y/this.yPrecision}));else{if(this.poly){var a={};a.Color=this.color,a.Type=o.Polyline,a.LineSize=this.lineThicknessData.id,a.Vertices=this.points.slice();var c=this.poly.getBBox();a.AreaTop=c.y/this.yPrecision,a.AreaLeft=c.x/this.xPrecision,a.AreaBottom=(c.y+c.height)/this.yPrecision,a.AreaRight=(c.x+c.width)/this.xPrecision;var u=new CustomEvent("didClearItem");this.poly.didClearItem=u,this.poly.addEventListener("didClearItem",(function(){var t=r.dataStore.drawing.Items,e=t.findIndex((function(t){return t==a}));e>-1&&t.splice(e,1)})),this.dataStore.drawing.Items.push(a),this.onChanged&&this.onChanged()}this.poly=null,this.points.length=0}}},{key:"createDrawingPolyline",value:function(t,e){var n=wt("polyline",{"vector-effect":"non-scaling-stroke"});return n.style.stroke=t,n.style.strokeWidth="".concat(e,"px"),n.style.strokeOpacity="1",n.style.fill="none",n}},{key:"stopBubble",value:function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()}},{key:"onMouseDown",value:function(t){var e=this;if(0===t.button){var n=t.clientX,r=t.clientY,o=this.workspace;o.addEventListener("mouseup",this.onMouseUp,!0),o.addEventListener("mouseleave",this.onMouseLeave,!0),setTimeout((function(t){e.drawPoint(n,r,1)}),0),this.stopBubble(t),c.bus.emit("CommentsDrawingEngine:startDraw")}}},{key:"onMouseMove",value:function(t){var e=this;if(1===t.buttons){var n=t.clientX,r=t.clientY;setTimeout((function(t){e.drawPoint(n,r,0)}),0)}2!==t.buttons&&this.stopBubble(t)}},{key:"onMouseUp",value:function(t){var e=this,n=this.workspace;n.removeEventListener("mouseup",this.onMouseUp,!0),n.removeEventListener("mouseleave",this.onMouseLeave,!0);var r=t.clientX,o=t.clientY;setTimeout((function(){e.drawPoint(r,o,2)}),0),c.bus.emit("CommentsDrawingEngine:endDraw")}},{key:"onMouseLeave",value:function(t){t.target===this.workspace&&this.onMouseUp(t)}},{key:"onTouchStart",value:function(t){var e=this;if(1===t.touches.length){var n=t.touches[0].clientX,r=t.touches[0].clientY,o=this.workspace;o.addEventListener("touchmove",this.onTouchMove,!0),o.addEventListener("touchend",this.onTouchEnd,!0),setTimeout((function(t){e.drawPoint(n,r,1)}),0),this.stopBubble(t),c.bus.emit("CommentsDrawingEngine:startDraw")}if(2===t.touches.length){var i=this.workspace;i.removeEventListener("touchmove",this.onTouchMove,!0),i.removeEventListener("touchend",this.onTouchEnd,!0)}}},{key:"onTouchMove",value:function(t){var e=this,n=t.touches[0].clientX,r=t.touches[0].clientY;setTimeout((function(t){e.drawPoint(n,r,0)}),0)}},{key:"onTouchEnd",value:function(t){var e=this;if(1===t.touches.length){var n=this.workspace;n.addEventListener("touchmove",this.onTouchMove,!0),n.addEventListener("touchend",this.onTouchEnd,!0)}if(0===t.touches.length){var r=this.workspace;r.removeEventListener("touchmove",this.onTouchMove,!0),r.removeEventListener("touchend",this.onTouchEnd,!0);var o=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY;setTimeout((function(){e.drawPoint(o,i,2)}),0),c.bus.emit("CommentsDrawingEngine:endDraw")}}}])&&In(e.prototype,n),r&&In(e,r),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ne),An=Cn;function Rn(t){return(Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Bn(){return(Bn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=Nn(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function Nn(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Wn(t)););return t}function Vn(t,e){return(Vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Gn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Wn(t);if(e){var o=Wn(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Fn(this,n)}}function Fn(t,e){if(e&&("object"===Rn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Hn(t)}function Hn(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Wn(t){return(Wn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Un(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Yn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vn(t,e)}(i,t);var e,n,r,o=Gn(i);function i(t,e){var n,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Un(Hn(r=o.call(this,"Sch",t)),"paintInfo",void 0),Un(Hn(r),"point",void 0),Un(Hn(r),"toString",(function(){return"CommentsDrawingEngine.Painters.Sch"})),r.paintInfo=e,r.setPoints(),r.onSceneTransform=r.onSceneTransform.bind(Hn(r)),r.point=e.sceneGroup.closest("svg").createSVGPoint(),null===(n=r.paintInfo.sceneGroup.parentElement)||void 0===n||n.addEventListener("didTransformChange",r.onSceneTransform),r}return e=i,(n=[{key:"areaScreenPoint",get:function(){return pn(this.paintInfo.sceneGroup,this.areaPoint.x,this.areaPoint.y,this.point)}},{key:"textScreenPoint",get:function(){return pn(this.paintInfo.sceneGroup,this.textPoint.x,this.textPoint.y,this.point)}},{key:"destroy",value:function(){var t;null===(t=this.paintInfo.sceneGroup.parentElement)||void 0===t||t.removeEventListener("didTransformChange",this.onSceneTransform),Bn(Wn(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){var t,e,n,r;if(this.editMode){var o=this.editMode.getBoundRect();if(!o.isInfinite){var i=(null===(t=this.paintInfo)||void 0===t||null===(e=t.workspace)||void 0===e?void 0:e.offsetHeight)||0,a=(null===(n=this.paintInfo)||void 0===n||null===(r=n.workspace)||void 0===r?void 0:r.offsetWidth)||0,u=Math.round(.3*i),s=Math.round(.3*a),f={};o.width>s?(f.x=o.left,f.width=o.width):(f.x=Math.round(o.left-s/2),f.width=s),o.height>u?(f.y=o.top,f.height=o.height):(f.y=Math.round(o.top-u/2),f.height=u);var l=this.dataStore.data;l.TextLeft!==l.TextRight&&l.TextTop!==l.TextBottom&&(f.x=Math.min(f.x,l.TextLeft),f.y=Math.min(f.y,l.TextTop),f.width=Math.max(o.left+o.width,l.TextLeft)-f.x,f.height=Math.max(o.top+o.height,l.TextTop)-f.y),c.bus.emit("SCHView:zoomToFit",{rect:f,changeScale:!0,margin:.6})}}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(t){switch(t.type){case"POINT":case"AREA":case"REDLINE":case"OBJECT":return new On(t,this.paintInfo)}return this.logger.LogWarn("Method not implemented for type ".concat(t.type,".")),null}},{key:"createDrawingEditMode",value:function(t){var e=this;return new An(t,this.paintInfo.workspace,this.paintInfo.sceneGroup,(function(){return e.emit("DRAWINGS_CHANGED")}))}},{key:"tryMoveIcon",value:function(t){var e=Dt(this.paintInfo.sceneGroup,t.x,t.y,this.point);return t.x=e.x,t.y=e.y,!0}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var t=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(t.AreaLeft+t.AreaRight),this.areaPoint.y=.5*(t.AreaTop+t.AreaBottom);break;case"AREA":case"REDLINE":this.areaPoint.x=t.AreaRight,this.areaPoint.y=t.AreaTop;break;case"OBJECT":var e=this.dataStore.data.ObjectUniqueID,n=this.paintInfo.objects.find((function(t){return t.node.getAttribute("id")===e}));if(n)if(n.kind===br.Wire||n.kind===br.Pin)this.areaPoint.x=.5*(t.AreaLeft+t.AreaRight),this.areaPoint.y=.5*(t.AreaTop+t.AreaBottom);else{var r=n.node.getBBox();this.areaPoint.x=r.x+r.width,this.areaPoint.y=r.y}else this.areaPoint.x=t.AreaRight,this.areaPoint.y=t.AreaTop}t.TextLeft!==t.TextRight&&t.TextTop!==t.TextBottom?(this.textPoint.x=t.TextLeft,this.textPoint.y=t.TextTop):(this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y)}}])&&Mn(e.prototype,n),r&&Mn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(nn);function zn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function qn(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Xn=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),qn(this,"svg",void 0),qn(this,"canvas",void 0),qn(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Sch.UiThreadEditOptions"})),this.svg=e}var e,n,r;return e=t,(n=[{key:"disableCustomDraw",get:function(){return!1}}])&&zn(e.prototype,n),r&&zn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Zn=n(67);function Jn(t){return(Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qn(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $n(){return($n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=tr(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function tr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ir(t)););return t}function er(t,e){return(er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ir(t);if(e){var o=ir(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return rr(this,n)}}function rr(t,e){if(e&&("object"===Jn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return or(t)}function or(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ir(t){return(ir=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ar(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var cr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&er(t,e)}(i,t);var e,n,r,o=nr(i);function i(){var t;Kn(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return ar(or(t=o.call.apply(o,[this].concat(n))),"runnig",!1),ar(or(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Sch.ActiveThreadSession"})),t}return e=i,(n=[{key:"run",value:function(t){$n(ir(i.prototype),"run",this).call(this,t),this.runnig=!0,c.bus.emit("SCHView:enableSelection",!1)}},{key:"stop",value:function(){var t=this;this.runnig=!1,$n(ir(i.prototype),"stop",this).call(this),Object(Zn.a)((function(){t.runnig||c.bus.emit("SCHView:enableSelection",!0)}))}}])&&Qn(e.prototype,n),r&&Qn(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(F);function ur(t){return(ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sr(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */sr=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==ur(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function fr(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function lr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hr(t,e){return(hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function pr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=vr(t);if(e){var o=vr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return dr(this,n)}}function dr(t,e){if(e&&("object"===ur(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return yr(t)}function yr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vr(t){return(vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var br,gr="sch-document-viewer-comment-overlay";!function(t){t[t.FirstObjectID=0]="FirstObjectID",t[t.ClipBoardContainer=1]="ClipBoardContainer",t[t.Note=2]="Note",t[t.Probe=3]="Probe",t[t.Rectangle=4]="Rectangle",t[t.Line=5]="Line",t[t.ConnectionLine=6]="ConnectionLine",t[t.BusEntry=7]="BusEntry",t[t.Arc=8]="Arc",t[t.EllipticalArc=9]="EllipticalArc",t[t.RoundRectangle=10]="RoundRectangle",t[t.Image=11]="Image",t[t.Pie=12]="Pie",t[t.TextFrame=13]="TextFrame",t[t.RichTextDocument=14]="RichTextDocument",t[t.Ellipse=15]="Ellipse",t[t.Junction=16]="Junction",t[t.Polygon=17]="Polygon",t[t.Polyline=18]="Polyline",t[t.Wire=19]="Wire",t[t.Bus=20]="Bus",t[t.Bezier=21]="Bezier",t[t.Label=22]="Label",t[t.Hyperlink=23]="Hyperlink",t[t.NetLabel=24]="NetLabel",t[t.Designator=25]="Designator",t[t.SchComponent=26]="SchComponent",t[t.Parameter=27]="Parameter",t[t.ParameterSet=28]="ParameterSet",t[t.ParameterList=29]="ParameterList",t[t.SheetName=30]="SheetName",t[t.SheetFileName=31]="SheetFileName",t[t.Sheet=32]="Sheet",t[t.SchLib=33]="SchLib",t[t.Symbol=34]="Symbol",t[t.NoERC=35]="NoERC",t[t.ErrorMarker=36]="ErrorMarker",t[t.Pin=37]="Pin",t[t.Port=38]="Port",t[t.PowerObject=39]="PowerObject",t[t.SheetEntry=40]="SheetEntry",t[t.SheetSymbol=41]="SheetSymbol",t[t.Template=42]="Template",t[t.TaskHolder=43]="TaskHolder",t[t.MapDefiner=44]="MapDefiner",t[t.ImplementationMap=45]="ImplementationMap",t[t.Implementation=46]="Implementation",t[t.ImplementationsList=47]="ImplementationsList",t[t.CrossSheetConnector=48]="CrossSheetConnector",t[t.CompileMask=49]="CompileMask",t[t.OpenBusComponent=50]="OpenBusComponent",t[t.OpenBusLink=51]="OpenBusLink",t[t.OpenBusDesignator=52]="OpenBusDesignator",t[t.HarnessConnector=53]="HarnessConnector",t[t.HarnessEntry=54]="HarnessEntry",t[t.HarnessConnectorType=55]="HarnessConnectorType",t[t.SignalHarness=56]="SignalHarness",t[t.OpenBusPort=57]="OpenBusPort",t[t.HighLevelCodeSymbol=58]="HighLevelCodeSymbol",t[t.HighLevelCodeEntry=59]="HighLevelCodeEntry",t[t.OpenBusPinGroup=60]="OpenBusPinGroup",t[t.Blanket=61]="Blanket",t[t.RTFLink=62]="RTFLink",t[t.FSMState=63]="FSMState",t[t.FSMTransition=64]="FSMTransition",t[t.CommentThread=65]="CommentThread",t[t.CommentThreadNote=66]="CommentThreadNote",t[t.FSMNote=67]="FSMNote",t[t.DiagramModule=68]="DiagramModule",t[t.DiagramModuleName=69]="DiagramModuleName",t[t.DiagramModuleSource=70]="DiagramModuleSource",t[t.DiagramConnector=71]="DiagramConnector",t[t.DiagramBlock=72]="DiagramBlock",t[t.DiagramHarness=73]="DiagramHarness",t[t.DiagramHarnessName=74]="DiagramHarnessName",t[t.DiagramHarnessSource=75]="DiagramHarnessSource",t[t.DiagramConnectorLink=76]="DiagramConnectorLink",t[t.DiagramPin=77]="DiagramPin",t[t.LastObjectId=78]="LastObjectId"}(br||(br={}));var wr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hr(t,e)}(u,t);var e,n,r,o,i,a=pr(u);function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),mr(yr(t=a.call(this,"Sch")),"acceptedObjectKinds",new Set([br.Bus,br.Pin,br.Port,br.PowerObject,br.Wire,br.SheetSymbol,br.SheetEntry,br.SignalHarness,br.HarnessEntry,br.SchComponent])),mr(yr(t),"viewShown",!1),mr(yr(t),"paintInfo",null),mr(yr(t),"documentIds",new Set),mr(yr(t),"primitivesMap",new Map),mr(yr(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Sch"})),t.setupViewDisplayEvents(),t}return e=u,(n=[{key:"isEngineForThread",value:function(t){return"SCH"===(null==t?void 0:t.documentType)||this.documentIds.has(t.data.DocumentUniqueID)}},{key:"hasDocument",value:function(t){return this.documentIds.has(t)}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new _t(this.paintInfo)}},{key:"createGraphicsPainter",value:function(t){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new Yn(t,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var t,e;return new Xn(null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.sceneGroup.closest("svg"))&&void 0!==t?t:void 0)}},{key:"createActiveThreadSession",value:function(){return new cr}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"setupMetadata",value:function(){var t,e,n,r=this,o=c.response;return null!=o&&o.metadata?(null===(t=o.metadata.schDocuments)||void 0===t||t.forEach((function(t){return r.documentIds.add(null==t?void 0:t.id)})),null===(e=o.metadata.components)||void 0===e||e.forEach((function(t){var e;r.addPrimitiveInfo(t,t.kind),null===(e=t.subParts)||void 0===e||e.filter((function(t){return t.schId})).forEach((function(e){return r.addPrimitiveInfo(e.schId,t.kind)}))})),null===(n=o.metadata.primitives)||void 0===n||n.forEach((function(t){return r.addPrimitiveInfo(t,t.kind)})),Promise.resolve()):Promise.resolve()}},{key:"createOverlay",value:function(){var t={},e={id:"",name:""};c.bus.emit("SCHView:documentInfo",e),t.documentId=e.id,t.documentName=e.name;var n=this.workspace;if(!n)throw new Error("Workspace was not found.");t.workspace=n;var r={};c.bus.emit("SCHView:renderDocumentData",r);var o=r.renderDocumentData;if(!o)throw new Error("Render document data is not ready");t.documentWidth=(null==o?void 0:o.documentWidth)||0,t.documentHeight=(null==o?void 0:o.documentHeight)||0;var i=this.primitivesMap.get(e.id),a="#".concat(e.id,">#DocumentItemsGroup [id]"),u=document.querySelectorAll(a),s=Array.from(u).map((function(t){var e,n=t.getAttribute("id");if(!n)return{node:t,kind:br.FirstObjectID};var r=null==i||null===(e=i.get(n))||void 0===e?void 0:e.kind;return r?{node:t,kind:r}:{node:t,kind:br.FirstObjectID}})).filter((function(t){return t.kind!==br.FirstObjectID})).sort((function(t,e){var n=t.kind===br.SchComponent?0:1,r=e.kind===br.SchComponent?0:1;return n<r?-1:n>r?1:0}));t.objects=s;var f=o.overlay;t.sceneGroup=wt("g",{"data-owner":"comment-panel"}),f.appendChild(t.sceneGroup);var l=document.getElementById(gr);l&&l.remove();var h=new de(gr);h.mount(t.sceneGroup.closest("svg")),h.$el.style.overflow="visible",t.overlayView=h,this.paintInfo=t}},{key:"destroyOverlay",value:function(){var t,e;null===(t=this.paintInfo)||void 0===t||t.sceneGroup.remove(),null===(e=this.paintInfo)||void 0===e||e.overlayView.destroy(),this.paintInfo=null}},{key:"coordXToDocument",value:function(t){return t?Math.round(1e5*t):0}},{key:"coordYToDocument",value:function(t){var e,n,r=null!==(e=null===(n=this.paintInfo)||void 0===n?void 0:n.documentHeight)&&void 0!==e?e:0;return t?Math.round(1e5*(r-t)):0}},{key:"coordXToScene",value:function(t){return Math.round((null!=t?t:0)/1e5)}},{key:"coordYToScene",value:function(t){var e,n,r=null!==(e=null===(n=this.paintInfo)||void 0===n?void 0:n.documentHeight)&&void 0!==e?e:0;return Math.round(r-(null!=t?t:0)/1e5)}},{key:"canBePaint",value:function(t){var e;return"ACTIVE"===this.getState()&&(null===(e=this.paintInfo)||void 0===e?void 0:e.documentId)===t.documentId}},{key:"activateGraphics",value:(o=sr().mark((function t(e,n,r){return sr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isViewEnabled()){t.next=4;break}return r(null),t.abrupt("return");case 4:return t.next=6,this.activateView();case 6:return t.next=8,this.activateDocument(e.documentId);case 8:e.expand(),n&&e.zoomToFit(),r(e),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),this.logger.LogError("Activate graphics error.",t.t0),r(null);case 17:case"end":return t.stop()}}),t,this,[[0,13]])})),i=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){fr(i,n,r,a,c,"next",t)}function c(t){fr(i,n,r,a,c,"throw",t)}a(void 0)}))},function(t,e,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){var t=c.views.SCHView;return t&&!t.hidden}},{key:"activateView",value:function(){var t=this;return new Promise((function(e){"ACTIVE"===t.getState()?e():(t.on("ACTIVE",(function n(){t.off("ACTIVE",n),e()})),c.bus.emit("View:set","SCHView"))}))}},{key:"activateDocument",value:function(t){return new Promise((function(e){var n={id:"",name:""};c.bus.emit("SCHView:documentInfo",n),t===n.id?e():(c.bus.on("SCHView:documentChanged",(function t(){c.bus.off("SCHView:documentChanged",t),e()})),c.bus.emit("SCHView:showDocument",t))}))}},{key:"setupViewDisplayEvents",value:function(){var t=this,e=!1,n=!1,r=null;c.bus.on("SCHView:shown",(function(o){r=o,n=!0,e&&(t.viewShown=!0,t.emit("viewShown",r))})),c.bus.on("SCHView:hidden",(function(){n=!1,e&&(t.viewShown=!1,t.emit("viewHidden"))})),c.bus.on("SCHView:documentChanged",(function(o){!e&&n?(t.viewShown=!0,t.emit("viewShown",r)):t.viewShown&&(t.emit("viewHidden"),t.emit("viewShown",r)),e=!0}))}},{key:"addPrimitiveInfo",value:function(t,e){if(t.schDocId&&t.schId){this.primitivesMap.has(t.schDocId)||this.primitivesMap.set(t.schDocId,new Map);var n=e?e>>8&255:0;if(!this.acceptedObjectKinds.has(n))return;var r=this.primitivesMap.get(t.schDocId);if(r){if(r.has(t.schId))return;r.set(t.schId,{kind:n})}}}}])&&lr(e.prototype,n),r&&lr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(at);function Er(t){return(Er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Or(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Sr(t,e){return(Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Pr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Tr(t);if(e){var o=Tr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return xr(this,n)}}function xr(t,e){if(e&&("object"===Er(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ir(t)}function Ir(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Tr(t){return(Tr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var jr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sr(t,e)}(c,t);var e,n,o,i=Pr(c);function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),kr(Ir(e=i.call(this,{name:"PCBDWF",supportedTypes:["AREA","POINT"],workspace:t.workspace})),"rect",void 0),kr(Ir(e),"domPoint",void 0),kr(Ir(e),"paintInfo",void 0),kr(Ir(e),"toString",(function(){return"CommentPanel.CreationSession.PCBDWF"})),e.paintInfo=t,e.on("before",(function(){t.workspace.style.cursor="crosshair"})),e.on("after",(function(){var n;null===(n=e.rect)||void 0===n||n.remove(),t.workspace.style.cursor="auto"})),e.on("drawRect",(function(t){return e.drawRect(t)})),e}return e=c,(n=[{key:"createData",value:function(t){var e={coordType:"scene"};return e.guid=a,e.drawing={Items:[]},e.status=r.Active,e.threadNumber=-1,e.documentName=this.paintInfo.documentName,e.documentType="PCBDWF",e.data={},e.data.DocumentUniqueID=this.paintInfo.hasRealDocumentId?this.paintInfo.documentId:"",e.data.ObjectUniqueID=this.paintInfo.pageId,e.data.PageUniqueID=this.paintInfo.pageId,e.data.TextLeft=0,e.data.TextTop=0,e.data.TextRight=0,e.data.TextBottom=0,t.width||t.height?(e.type="AREA",this.setRectData(e,t)):(e.type="POINT",this.setPointData(e,t)),Promise.resolve(e)}},{key:"drawRect",value:function(t){this.rect||(this.rect=wt("rect",{class:"comment-area-selection-rect",fill:"none",stroke:"#267FEB","stroke-width":"4","stroke-opacity":"0.48","stroke-linecap":"round","stroke-linejoin":"round","vector-effect":"non-scaling-stroke"}),this.paintInfo.sceneGroup.appendChild(this.rect));var e=this.screenToSVG(t.x,t.y,this.paintInfo.sceneGroup.getScreenCTM()),n=this.screenToSVG(t.x+t.width,t.y+t.height,this.paintInfo.sceneGroup.getScreenCTM());this.rect.width.baseVal.value=Math.abs(e.x-n.x),this.rect.height.baseVal.value=Math.abs(e.y-n.y),this.rect.x.baseVal.value=Math.min(e.x,n.x),this.rect.y.baseVal.value=Math.min(e.y,n.y)}},{key:"screenToSVG",value:function(t,e,n){var r,o;this.domPoint=null!==(r=this.domPoint)&&void 0!==r?r:null===(o=this.paintInfo.sceneGroup.closest("svg"))||void 0===o?void 0:o.createSVGPoint(),this.domPoint.x=t,this.domPoint.y=e;var i=n;return this.domPoint.matrixTransform(i.inverse())}},{key:"setPointData",value:function(t,e){var n=this.screenToSVG(e.x,e.y,this.paintInfo.sceneGroup.getScreenCTM());t.data.AreaLeft=Math.round(n.x)+5,t.data.AreaTop=Math.round(n.y)+5,t.data.AreaRight=Math.round(n.x)-5,t.data.AreaBottom=Math.round(n.y)-5}},{key:"setRectData",value:function(t,e){var n=this.screenToSVG(e.x,e.y,this.paintInfo.sceneGroup.getScreenCTM()),r=this.screenToSVG(e.x+e.width,e.y+e.height,this.paintInfo.sceneGroup.getScreenCTM());t.data.AreaLeft=Math.round(n.x),t.data.AreaTop=Math.round(n.y),t.data.AreaRight=Math.round(r.x),t.data.AreaBottom=Math.round(r.y)}}])&&Or(e.prototype,n),o&&Or(e,o),Object.defineProperty(e,"prototype",{writable:!1}),c}(bt);function _r(t){return(_r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Lr(t,e){return(Lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Cr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Mr(t);if(e){var o=Mr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ar(this,n)}}function Ar(t,e){if(e&&("object"===_r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Rr(t)}function Rr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Mr(t){return(Mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Br(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Nr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lr(t,e)}(i,t);var e,n,r,o=Cr(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Br(Rr(n=o.call(this,t.type)),"nodes",[]),Br(Rr(n),"dataStore",void 0),Br(Rr(n),"paintInfo",void 0),Br(Rr(n),"obj",void 0),n.dataStore=t,n.paintInfo=e,n.rectangleFromData(t,e.sceneGroup),n}return e=i,(n=[{key:"getBoundRect",value:function(){var t,e={isInfinite:!1};if(null!==(t=this.obj)&&void 0!==t&&t.node){var n=this.obj.node.getBBox();e.left=n.x,e.top=n.y,e.width=n.width,e.height=n.height}else{var r=this.dataStore.data;e.left=Math.min(r.AreaLeft,r.AreaRight),e.top=Math.min(r.AreaTop,r.AreaBottom),e.width=Math.abs(r.AreaLeft-r.AreaRight),e.height=Math.abs(r.AreaTop-r.AreaBottom)}return e}},{key:"onShow",value:function(){this.nodes.forEach((function(t){return t.setAttribute("display","")}))}},{key:"onHide",value:function(){this.nodes.forEach((function(t){return t.setAttribute("display","none")}))}},{key:"onDestroy",value:function(){this.nodes.forEach((function(t){return t.remove()})),this.nodes=[]}},{key:"setRectangle",value:function(t,e,n){var r=wt("rect",{class:"thread-contour","vector-effect":"non-scaling-stroke",display:"none","data-guid":t.guid,fill:"none",stroke:"#267FEB","stroke-width":"4","stroke-opacity":"0.48","stroke-linecap":"round","stroke-linejoin":"round"});if(e.appendChild(r),this.nodes.push(r),n)r.x.baseVal.value=n.x,r.y.baseVal.value=n.y,r.width.baseVal.value=n.width,r.height.baseVal.value=n.height;else{var o=t.data;r.x.baseVal.value=Math.min(o.AreaLeft,o.AreaRight),r.y.baseVal.value=Math.min(o.AreaTop,o.AreaBottom),r.width.baseVal.value=Math.abs(o.AreaLeft-o.AreaRight),r.height.baseVal.value=Math.abs(o.AreaTop-o.AreaBottom)}}},{key:"setWire",value:function(t,e){var n=this;if(t&&t.localName){var r=t.localName;if("g"===r)this.forEveryChild(t,(function(t){return n.setWire(t,e)}));else if("line"===r||"polyline"===r){var o=t.cloneNode(!0);o.hasAttribute("id")&&o.removeAttribute("id");var i=window.getComputedStyle(o)["stroke-width"],a=1;i.match(/^\-?\d+(\.?\d*)px$/)&&(a=parseFloat(i.substring(0,i.length-2))),o.setAttribute("stroke-width","".concat(a+2,"px")),o.style.fill="none",o.style.stroke="#267FEB",o.style.strokeOpacity="0.48",o.style.pointerEvents="none",this.nodes.push(o),e.appendChild(o)}}}},{key:"forEveryChild",value:function(t,e){for(var n=t.children,r=0;r<n.length;r++){var o=n[r];o&&e(o)}}},{key:"rectangleFromData",value:function(t,e){switch(t.type){case"POINT":break;case"AREA":this.setRectangle(t,e);break;case"REDLINE":this.setRectangle(t,e);var n=wt("g",{class:"redline-thread-drawing","vector-effect":"non-scaling-stroke",display:"none","data-guid":t.guid,stroke:"rgb(236, 64, 37)","stroke-width":"2px","stroke-opacity":"1",fill:"none"});e.appendChild(n),this.nodes.push(n),this.drawRedline(n,t)}}},{key:"drawRedline",value:function(t,e){var n,r,o,i,a;if(null!==(n=e.data)&&void 0!==n&&null!==(r=n.SerializedData)&&void 0!==r&&r.Vertices){var c=t.closest("svg");null==e||null===(o=e.data)||void 0===o||null===(i=o.SerializedData)||void 0===i||null===(a=i.Vertices)||void 0===a||a.forEach((function(e){if(e){var n=wt("polyline",{});e.forEach((function(t,e){if(e){var r=c.createSVGPoint();r.x=t.X,r.y=t.Y,n.points.appendItem(r)}})),t.appendChild(n)}}))}}}])&&Dr(e.prototype,n),r&&Dr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ne);function Vr(t){return(Vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fr(){return(Fr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=Hr(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function Hr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qr(t)););return t}function Wr(t,e){return(Wr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ur(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=qr(t);if(e){var o=qr(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Yr(this,n)}}function Yr(t,e){if(e&&("object"===Vr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return zr(t)}function zr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qr(t){return(qr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Xr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Zr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wr(t,e)}(i,t);var e,n,r,o=Ur(i);function i(t,e){var n,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Xr(zr(r=o.call(this,"PCBDWF",t)),"paintInfo",void 0),Xr(zr(r),"point",void 0),Xr(zr(r),"toString",(function(){return"CommentPanel.Painters.PCBDWF"})),r.paintInfo=e,r.setPoints(),r.onSceneTransform=r.onSceneTransform.bind(zr(r)),r.point=e.sceneGroup.closest("svg").createSVGPoint(),null===(n=r.paintInfo.sceneGroup.parentElement)||void 0===n||n.addEventListener("didTransformChange",r.onSceneTransform),r}return e=i,(n=[{key:"areaScreenPoint",get:function(){return pn(this.paintInfo.sceneGroup,this.areaPoint.x,this.areaPoint.y,this.point)}},{key:"textScreenPoint",get:function(){return pn(this.paintInfo.sceneGroup,this.textPoint.x,this.textPoint.y,this.point)}},{key:"destroy",value:function(){var t;null===(t=this.paintInfo.sceneGroup.parentElement)||void 0===t||t.removeEventListener("didTransformChange",this.onSceneTransform),Fr(qr(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){var t,e,n,r;if(this.editMode){var o=this.editMode.getBoundRect();if(!o.isInfinite){var i=(null===(t=this.paintInfo)||void 0===t||null===(e=t.workspace)||void 0===e?void 0:e.offsetHeight)||0,a=(null===(n=this.paintInfo)||void 0===n||null===(r=n.workspace)||void 0===r?void 0:r.offsetWidth)||0,u=Math.round(.3*i),s=Math.round(.3*a),f={};o.width>s?(f.x=o.left,f.width=o.width):(f.x=Math.round(o.left-s/2),f.width=s),o.height>u?(f.y=o.top,f.height=o.height):(f.y=Math.round(o.top-u/2),f.height=u);var l=this.dataStore.data;l.TextLeft!==l.TextRight&&l.TextTop!==l.TextBottom&&(f.x=Math.min(f.x,l.TextLeft),f.y=Math.min(f.y,l.TextTop),f.width=Math.max(o.left+o.width,l.TextLeft)-f.x,f.height=Math.max(o.top+o.height,l.TextTop)-f.y),c.bus.emit("PCBDWFView:zoomToFit",{rect:f,changeScale:!0,margin:.6})}}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(t){switch(t.type){case"POINT":case"AREA":case"REDLINE":case"OBJECT":return new Nr(t,this.paintInfo)}return this.logger.LogWarn("Method not implemented for type ".concat(t.type,".")),null}},{key:"createDrawingEditMode",value:function(t){var e=this;return new An(t,this.paintInfo.workspace,this.paintInfo.sceneGroup,(function(){return e.emit("DRAWINGS_CHANGED")}))}},{key:"tryMoveIcon",value:function(t){var e=Dt(this.paintInfo.sceneGroup,t.x,t.y,this.point);return t.x=e.x,t.y=e.y,!0}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var t=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(t.AreaLeft+t.AreaRight),this.areaPoint.y=.5*(t.AreaTop+t.AreaBottom);break;case"AREA":case"REDLINE":this.areaPoint.x=t.AreaRight,this.areaPoint.y=t.AreaTop}t.TextLeft!==t.TextRight&&t.TextTop!==t.TextBottom?(this.textPoint.x=t.TextLeft,this.textPoint.y=t.TextTop):(this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y)}}])&&Gr(e.prototype,n),r&&Gr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(nn);function Jr(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Kr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Qr=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Kr(this,"svg",void 0),Kr(this,"canvas",void 0),Kr(this,"toString",(function(){return"CommentPanel.ViewEngines.PCBDWF.UiThreadEditOptions"})),this.svg=e}var e,n,r;return e=t,(n=[{key:"disableCustomDraw",get:function(){return!1}}])&&Jr(e.prototype,n),r&&Jr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),$r=n(14);function to(t){return(to="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function eo(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */eo=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==to(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function no(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function ro(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function oo(t,e){return(oo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function io(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=uo(t);if(e){var o=uo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ao(this,n)}}function ao(t,e){if(e&&("object"===to(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return co(t)}function co(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uo(t){return(uo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function so(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var fo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&oo(t,e)}(u,t);var e,n,r,o,i,a=io(u);function u(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),so(co(t=a.call(this,"PCBDWF")),"viewShown",!1),so(co(t),"isEnabled",!1),so(co(t),"paintInfo",null),so(co(t),"documents",[]),so(co(t),"toString",(function(){return"CommentPanel.ViewEngines.PCBDWF"}));var e=$r.a.getLicenseDetails($r.a.names.draftsmanComment).isEnabled;return t.isEnabled=e,t.setupViewDisplayEvents(),c.bus.on("PCBDWFEngine:documentsSetupCompleted",(function(e){t.documents=e.documents||[]})),t}return e=u,(n=[{key:"isThreadForDocument",value:function(t,e){return"PCBDWF"===e.documentType&&(t.documentId===e.data.DocumentUniqueID||(!e.data.DocumentUniqueID||!t.hasRealDocumentId&&!!e.data.DocumentUniqueID)&&t.viewDataOriginalFileName===e.documentName)}},{key:"isEngineForThread",value:function(t){var e=this;return this.isEnabled&&this.documents.some((function(n){return e.isThreadForDocument(n,t)}))}},{key:"hasDocument",value:function(t){return this.isEnabled&&this.documents.findIndex((function(e){return e.uniqueId===t}))>=0}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new jr(this.paintInfo)}},{key:"createGraphicsPainter",value:function(t){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new Zr(t,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var t,e;return new Qr(null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.sceneGroup.closest("svg"))&&void 0!==t?t:void 0)}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"createOverlay",value:function(){var t={},e={};c.bus.emit("PCBDWFEngine:documentInfo",e),t.documentId=e.current.documentId,t.hasRealDocumentId=e.current.hasRealDocumentId,t.pageId=e.current.pageId,t.documentName=e.current.viewDataOriginalFileName;var n=this.workspace;if(!n)throw new Error("Workspace was not found.");t.workspace=n;var r={};c.bus.emit("PCBDWFEngine:renderDocumentData",r);var o=r.renderDocumentData;if(o){t.documentWidth=(null==o?void 0:o.documentWidth)||0,t.documentHeight=(null==o?void 0:o.documentHeight)||0;var i=o.overlay;t.sceneGroup=wt("g",{"data-owner":"comment-panel"}),i.appendChild(t.sceneGroup);var a=document.getElementById("pcbdwf-document-viewer-comment-overlay");a&&a.remove();var u=new de("pcbdwf-document-viewer-comment-overlay");u.mount(t.sceneGroup.closest("svg")),u.$el.style.overflow="visible",t.overlayView=u,this.paintInfo=t}}},{key:"destroyOverlay",value:function(){var t,e;null===(t=this.paintInfo)||void 0===t||t.sceneGroup.remove(),null===(e=this.paintInfo)||void 0===e||e.overlayView.destroy(),this.paintInfo=null}},{key:"coordXToDocument",value:function(t){return t?Math.round(1e5*t):0}},{key:"coordYToDocument",value:function(t){var e,n,r=null!==(e=null===(n=this.paintInfo)||void 0===n?void 0:n.documentHeight)&&void 0!==e?e:0;return t?Math.round(1e5*(r-t)):0}},{key:"coordXToScene",value:function(t){return Math.round((null!=t?t:0)/1e5)}},{key:"coordYToScene",value:function(t){var e,n,r=null!==(e=null===(n=this.paintInfo)||void 0===n?void 0:n.documentHeight)&&void 0!==e?e:0;return Math.round(r-(null!=t?t:0)/1e5)}},{key:"testThreadForCurrentPage",value:function(t){var e,n,r,o;return!((null===(e=this.paintInfo)||void 0===e?void 0:e.documentId)!==t.documentId&&(t.documentId.trim()&&(null!==(n=this.paintInfo)&&void 0!==n&&n.hasRealDocumentId||!t.documentId.trim())||t.documentName!==(null===(r=this.paintInfo)||void 0===r?void 0:r.documentName))||(null===(o=this.paintInfo)||void 0===o?void 0:o.pageId)!==t.pageId)}},{key:"canBePaint",value:function(t){return"ACTIVE"===this.getState()&&this.testThreadForCurrentPage(t)}},{key:"activateGraphics",value:(o=eo().mark((function t(e,n,r){return eo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isViewEnabled()){t.next=4;break}return r(null),t.abrupt("return");case 4:return t.next=6,this.activateView();case 6:return t.next=8,this.activateDocument(e);case 8:e.expand(),n&&e.zoomToFit(),r(e),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),this.logger.LogError("Activate graphics error.",t.t0),r(null);case 17:case"end":return t.stop()}}),t,this,[[0,13]])})),i=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){no(i,n,r,a,c,"next",t)}function c(t){no(i,n,r,a,c,"throw",t)}a(void 0)}))},function(t,e,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){var t=c.views.PCBDWFView;return t&&!t.hidden}},{key:"activateView",value:function(){var t=this;return new Promise((function(e){"ACTIVE"===t.getState()?e():(t.on("ACTIVE",(function n(){t.off("ACTIVE",n),e()})),c.bus.emit("View:set","PCBDWFView"))}))}},{key:"activateDocument",value:function(t){return new Promise((function(e){var n,r={};c.bus.emit("PCBDWFEngine:documentInfo",r),t.uniqueId===(null===(n=r.current)||void 0===n?void 0:n.uniqueId)?e():(c.bus.on("PCBDWFView:documentChanged",(function t(){c.bus.off("PCBDWFView:documentChanged",t),e()})),c.bus.emit("PCBDWFView:showDocument",{uniqueId:t.uniqueId,fileName:t.documentName,pageId:t.pageId}))}))}},{key:"setupViewDisplayEvents",value:function(){var t=this,e=!1,n=!1,r=null;c.bus.on("PCBDWFView:shown",(function(o){r=o,n=!0,e&&(t.viewShown=!0,t.emit("viewShown",r))})),c.bus.on("PCBDWFView:hidden",(function(){n=!1,e&&(t.viewShown=!1,t.emit("viewHidden"))})),c.bus.on("PCBDWFView:documentChanged",(function(o){!e&&n?(t.viewShown=!0,t.emit("viewShown",r)):t.viewShown&&(t.emit("viewHidden"),t.emit("viewShown",r)),e=!0}))}}])&&ro(e.prototype,n),r&&ro(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(at);function lo(t){return(lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ho(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function po(t,e){return(po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function yo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=bo(t);if(e){var o=bo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return vo(this,n)}}function vo(t,e){if(e&&("object"===lo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return mo(t)}function mo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bo(t){return(bo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function go(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var wo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&po(t,e)}(i,t);var e,n,r,o=yo(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),go(mo(e=o.call(this)),"viewIsShown",!1),go(mo(e),"workspace",null),go(mo(e),"documentId",""),go(mo(e),"viewName",void 0),go(mo(e),"hasCustomDrawing",!0),go(mo(e),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.BaseState"})),e.viewName=t,e.setupViewDisplayEvents(t),e}return e=i,(n=[{key:"setupViewDisplayEvents",value:function(t){var e=this,n=!1,r=!1;c.bus.on(t+":shown",(function(t){e.workspace=t,r=!0,n&&(e.viewIsShown=!0,e.emit("VIEW_SHOWN",e))})),c.bus.on(t+":hidden",(function(){r=!1,n&&(e.viewIsShown=!1,e.emit("VIEW_HIDDEN"))})),c.bus.on("PcbEngine:didDocumentAttach",(function(t){!n&&r?(e.viewIsShown=!0,e.documentId=t.altiumDesignerId,e.emit("VIEW_SHOWN",e)):e.viewIsShown?(e.emit("VIEW_HIDDEN"),e.documentId=t.altiumDesignerId,e.emit("VIEW_SHOWN",e)):(e.documentId=t.altiumDesignerId,n=!0)}))}}])&&ho(e.prototype,n),r&&ho(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(k.a),Eo=function(t){return 255&t.kind};function Oo(t){return(Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function So(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Po(t,e){return(Po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function xo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ko(t);if(e){var o=ko(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Io(this,n)}}function Io(t,e){if(e&&("object"===Oo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return To(t)}function To(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ko(t){return(ko=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function jo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _o=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Po(t,e)}(u,t);var e,n,o,i=xo(u);function u(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),jo(To(e=i.call(this,{name:"Pcb2D",supportedTypes:["OBJECT","AREA","POINT"],workspace:t.workspace})),"nodeItem",null),jo(To(e),"paintInfo",void 0),jo(To(e),"s_currentObject",null),jo(To(e),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Pcb2D"})),e.paintInfo=t,e.on("before",(function(){t.workspace.style.cursor="crosshair"})),e.on("after",(function(){t.workspace.style.cursor="auto",e.cancelled&&c.bus.emit("PcbEngine:enableSelection",!0),e.setNodeItem(null)})),e.on("drawRect",(function(t){var n=e.dataScene.viewportToWorld([t.x,t.y]),r=e.dataScene.viewportToWorld([t.x+t.width,t.y+t.height]),o={left:n[0],top:n[1],right:r[0],bottom:r[1]},i=e.draw({boundBox:o,primitive:null});e.setNodeItem(i)})),e}return e=u,(n=[{key:"dataScene",get:function(){var t;return null!==(t=this.paintInfo.scene.parentScene)&&void 0!==t?t:this.paintInfo.scene}},{key:"currentObject",get:function(){return this.s_currentObject},set:function(t){this.s_currentObject!=t&&(this.s_currentObject=t,null===t?this.setNodeItem(null):this.setNodeItem(this.draw(t)))}},{key:"startHighlight",value:function(t){var e=this.findTargetInfoByPoint(t.x,t.y);e?this.currentObject&&this.currentObject.primitive!==e.primitive?(this.paintInfo.workspace.style.cursor="pointer",this.currentObject=e):this.currentObject||(this.paintInfo.workspace.style.cursor="pointer",this.currentObject=e):(this.paintInfo.workspace.style.cursor="crosshair",this.currentObject=null)}},{key:"stopHighlight",value:function(){this.paintInfo.workspace.style.cursor="crosshair",this.currentObject=null}},{key:"createData",value:function(t){var e={coordType:"scene"};if(e.guid=a,e.drawing={Items:[]},e.status=r.Active,e.threadNumber=-1,e.documentName=this.paintInfo.documentName,e.documentType="PCB",e.data={},e.data.DocumentUniqueID=this.paintInfo.documentId,e.data.TextLeft=0,e.data.TextTop=0,e.data.TextRight=0,e.data.TextBottom=0,this.currentObject){e.sceneNodeId=this.currentObject.primitive.pcbId,e.objectType=Et($a,Eo(this.currentObject.primitive));var n=this.currentObject.primitive.pcbUniqueId;if(n){e.type="OBJECT",e.data.ObjectUniqueID=n;var o=this.currentObject.boundBox;o?(e.data.AreaLeft=o.left,e.data.AreaTop=o.top,e.data.AreaRight=o.right,e.data.AreaBottom=o.bottom):this.setPointData(e,t)}else e.type="POINT",this.setPointData(e,t)}else t.width||t.height?(e.type="AREA",this.setRectData(e,t)):(e.type="POINT",this.setPointData(e,t));return Promise.resolve(e)}},{key:"setNodeItem",value:function(t){this.nodeItem&&this.paintInfo.scene.removeItem(this.nodeItem),this.nodeItem=t,this.paintInfo.scene.setDirty(!0),this.paintInfo.renderer.invalidate()}},{key:"draw",value:function(t){try{var e=t.primitive;if(null!=e&&e.pcbId&&Eo(e)!=$a.Component){var n=this.dataScene.getNodeItemById(e.pcbId);if(n)return this.dataScene.cloneNodeItemToLayer(n,this.paintInfo.layerId,this.paintInfo.materialId,0,this.paintInfo.scene)}if(t.boundBox){for(var r=t.boundBox,o=[[r.left,r.top,0],[r.right,r.top,0],[r.right,r.bottom,0],[r.left,r.bottom,0],[r.left,r.top,0]],i=[],a=0;a<o.length-1;a++){var c=o[a],u=o[a+1];i.push({from:c,to:u,color:this.paintInfo.materialColor,width:4,dash:0})}return this.paintInfo.scene.addItem(this.paintInfo.layerId,[],[],[],[],i,[])}return null}catch(t){return null}}},{key:"setPointData",value:function(t,e){var n=this.dataScene.viewportToWorld([e.x,e.y]);t.data.AreaLeft=n[0]+5,t.data.AreaTop=n[1]+5,t.data.AreaRight=n[0]-5,t.data.AreaBottom=n[1]-5}},{key:"setRectData",value:function(t,e){var n=this.dataScene.viewportToWorld([e.x,e.y]),r=this.dataScene.viewportToWorld([e.x+e.width,e.y+e.height]);t.data.AreaLeft=n[0],t.data.AreaTop=n[1],t.data.AreaRight=r[0],t.data.AreaBottom=r[1]}},{key:"findTargetInfoByPoint",value:function(t,e){var n,r,o,i=this,a=null===(n=this.paintInfo.layerManager)||void 0===n||null===(r=n.getLayers())||void 0===r?void 0:r.filter((function(t){return t.isVisible||"Multi-Layer"===t.searchName}));if(!a)return null;var c=this.dataScene.viewportToWorld([t,e]);if(!c)return null;var u=[];this.paintInfo.metadata.components.forEach((function(t){a.find((function(e){return e.metaId===t.layerId}))&&t.boundRect&&i.pointInRectangle(c[0],c[1],t.boundRect)&&u.push({primitive:t,node:null})})),null===(o=this.dataScene.getNodeItemsAtPoint(c,a.map((function(t){return t.id}))))||void 0===o||o.forEach((function(t){var e=i.paintInfo.metadata.primitives.get(t.GetId());e&&u.push({primitive:e,node:t})}));var s=this.dataScene.flipped;return u.length?(u.sort((function(t,e){return s?i.getStackIndex(e,a)-i.getStackIndex(t,a):i.getStackIndex(t,a)-i.getStackIndex(e,a)})),{primitive:u[0].primitive,boundBox:this.getBoundBox(u[0])}):null}},{key:"getBoundBox",value:function(t){if(t.primitive.boundRect){var e=t.primitive.boundRect;return{left:e[0]/1e6,top:e[3]/1e6,right:e[2]/1e6,bottom:e[1]/1e6}}if(t.node){var n=this.dataScene.getBoundingBoxForItem(t.node);if(n)return{left:Math.min(n[0],n[3]),top:Math.max(n[1],n[4]),right:Math.max(n[0],n[3]),bottom:Math.min(n[1],n[4])}}return null}},{key:"pointInRectangle",value:function(t,e,n){return t>=n[0]/1e6&&t<=n[2]/1e6&&e>=n[1]/1e6&&e<=n[3]/1e6}},{key:"getStackIndex",value:function(t,e){var n=e.find((function(e){return e.metaId===t.primitive.layerId}));return n?1e4*n.stackIndex+this.getPrimitiveStackIndex(t.primitive):Number.MAX_VALUE}},{key:"getPrimitiveStackIndex",value:function(t){var e=255&t.kind;return e===$a.Pad?99:e===$a.Component?100:e}}])&&So(e.prototype,n),o&&So(e,o),Object.defineProperty(e,"prototype",{writable:!1}),u}(bt);function Do(t){return(Do="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Lo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Co(t,e){return(Co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ao(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Bo(t);if(e){var o=Bo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ro(this,n)}}function Ro(t,e){if(e&&("object"===Do(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Mo(t)}function Mo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Bo(t){return(Bo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function No(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Vo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Co(t,e)}(i,t);var e,n,r,o=Ao(i);function i(t,e,n){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),No(Mo(r=o.call(this,null!=n?n:"GerberText")),"nodes",[]),No(Mo(r),"dataStore",void 0),No(Mo(r),"paintInfo",void 0),No(Mo(r),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.GerberText"})),r.dataStore=t,r.paintInfo=e,r}return e=i,(n=[{key:"getBoundRect",value:function(){var t={isInfinite:!1},e=this.dataStore.data;return t.left=Math.min(e.AreaLeft,e.AreaRight),t.top=Math.max(e.AreaTop,e.AreaBottom),t.width=Math.abs(e.AreaLeft-e.AreaRight),t.height=Math.abs(e.AreaTop-e.AreaBottom),t}},{key:"onShow",value:function(){this.draw()}},{key:"onHide",value:function(){this.clear()}},{key:"onDestroy",value:function(){this.clear()}},{key:"draw",value:function(){switch(this.dataStore.type){case"AREA":case"REDLINE":this.drawRect()}this.paintInfo.renderer.invalidate()}},{key:"drawRect",value:function(){for(var t=this.dataStore.data,e=[[t.AreaLeft,t.AreaTop,0],[t.AreaRight,t.AreaTop,0],[t.AreaRight,t.AreaBottom,0],[t.AreaLeft,t.AreaBottom,0],[t.AreaLeft,t.AreaTop,0]],n=[],r=0;r<e.length-1;r++){var o=e[r],i=e[r+1];n.push(this.createLine(o,i))}var a=this.paintInfo.scene.addItem(this.paintInfo.layerId,[],[],[],[],n,[]);a&&this.nodes.push(a),this.paintInfo.scene.setDirty(!0)}},{key:"createLine",value:function(t,e){return{from:t,to:e,color:this.paintInfo.materialColor,width:4,dash:0}}},{key:"clear",value:function(){var t=this;this.nodes.filter((function(t){return t})).forEach((function(e){return t.paintInfo.scene.removeItem(e)})),this.nodes=[],this.paintInfo.scene.setDirty(!0),this.paintInfo.renderer.invalidate()}}])&&Lo(e.prototype,n),r&&Lo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ne);function Go(t){return(Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ho(t,e){return(Ho=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Wo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zo(t);if(e){var o=zo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Uo(this,n)}}function Uo(t,e){if(e&&("object"===Go(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Yo(t)}function Yo(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zo(t){return(zo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qo(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Xo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ho(t,e)}(i,t);var e,n,r,o=Wo(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),qo(Yo(n=o.call(this,t,e,"Pcb2DText")),"dataStore",void 0),qo(Yo(n),"paintInfo",void 0),qo(Yo(n),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.Pcb2DText"})),n.dataStore=t,n.paintInfo=e,n}return e=i,(n=[{key:"dataScene",get:function(){var t;return null!==(t=this.paintInfo.scene.parentScene)&&void 0!==t?t:this.paintInfo.scene}},{key:"draw",value:function(){switch(this.dataStore.type){case"OBJECT":var t=this.dataStore.data.ObjectUniqueID,e=this.paintInfo.metadata.primitivesByUniqueId.get(t);if(e)if(Eo(e)===$a.Component){var n=e;n.boundBox&&(this.dataStore.data.AreaLeft=n.boundBox[0],this.dataStore.data.AreaTop=n.boundBox[1],this.dataStore.data.AreaRight=n.boundBox[2],this.dataStore.data.AreaBottom=n.boundBox[3]),this.drawRect()}else this.drawNode(e.pcbId);else this.drawRect();break;case"POINT":this.drawNode(this.dataStore.sceneNodeId);break;case"AREA":case"REDLINE":this.drawRect()}this.paintInfo.renderer.invalidate()}},{key:"createLine",value:function(t,e){return{from:t,to:e,material:this.paintInfo.materialId,width:4,dash:0}}},{key:"drawNode",value:function(t){if(t){var e=this.dataScene.getNodeItemById(t);if(e){var n=this.dataScene.cloneNodeItemToLayer(e,this.paintInfo.layerId,this.paintInfo.materialId,0,this.paintInfo.scene);n&&(this.nodes.push(n),this.paintInfo.scene.setDirty(!0))}}}}])&&Fo(e.prototype,n),r&&Fo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Vo);function Zo(t){return(Zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jo(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ko(t,e){return(Ko=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Qo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ei(t);if(e){var o=ei(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return $o(this,n)}}function $o(t,e){if(e&&("object"===Zo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ti(t)}function ti(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ei(t){return(ei=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ni=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ko(t,e)}(i,t);var e,n,r,o=Qo(i);function i(t,e,n,r){var a,c,u,s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),a=o.call(this,t,e,n,r,"PcbOverlayDrawing"),c=ti(a),s=function(){return"CommentsDrawingEngine.Painters.EditModes.PcbOverlayDrawing"},(u="toString")in c?Object.defineProperty(c,u,{value:s,enumerable:!0,configurable:!0,writable:!0}):c[u]=s,a}return e=i,(n=[{key:"xPrecision",get:function(){return 100}},{key:"yPrecision",get:function(){return-100}}])&&Jo(e.prototype,n),r&&Jo(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Cn);function ri(t){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ii(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ai(){return(ai="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=ci(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function ci(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=hi(t)););return t}function ui(t,e){return(ui=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function si(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=hi(t);if(e){var o=hi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return fi(this,n)}}function fi(t,e){if(e&&("object"===ri(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return li(t)}function li(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function hi(t){return(hi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var di=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ui(t,e)}(i,t);var e,n,r,o=si(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),pi(li(n=o.call(this,"Pcb2D",t)),"paintInfo",void 0),pi(li(n),"toString",(function(){return"CommentsDrawingEngine.Painters.Pcb2D"})),n.paintInfo=e,n.setPoints(),n.onSceneTransform=n.onSceneTransform.bind(li(n)),n.paintInfo.renderer.on("transformScene",n.onSceneTransform),n}return e=i,(n=[{key:"areaScreenPoint",get:function(){var t=this.paintInfo.scene.worldToViewport([this.areaPoint.x,this.areaPoint.y]);return{x:t[0],y:t[1]}}},{key:"textScreenPoint",get:function(){var t=this.paintInfo.scene.worldToViewport([this.textPoint.x,this.textPoint.y]);return{x:t[0],y:t[1]}}},{key:"destroy",value:function(){this.paintInfo.renderer.off("transformScene",this.onSceneTransform),ai(hi(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){var t;if(this.editMode){var e=this.editMode.getBoundRect();if(!e.isInfinite){var n=this.dataStore.data,r=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?oi(Object(n),!0).forEach((function(e){pi(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},e),o=r.left,i=r.top,a=r.left+r.width,c=r.top-r.width;n.TextLeft!==n.TextRight&&n.TextTop!==n.TextBottom&&(o=Math.min(o,n.TextLeft),a=Math.max(a,n.TextLeft),i=Math.max(i,n.TextTop),c=Math.min(c,n.TextTop)),(null!==(t=this.paintInfo.scene.parentScene)&&void 0!==t?t:this.paintInfo.scene).zoomToFit([o,c,0],[a,i,0],.75,.5)}}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(t){switch(t.type){case"POINT":case"AREA":case"OBJECT":return new Xo(t,this.paintInfo)}return this.logger.LogWarn("Method not implemented for type ".concat(t.type,".")),null}},{key:"createDrawingEditMode",value:function(t){var e=this;return new ni(t,this.paintInfo.workspace,this.paintInfo.sceneGroup,(function(){return e.emit("DRAWINGS_CHANGED")}))}},{key:"tryMoveIcon",value:function(t){var e=this.paintInfo.scene.viewportToWorld([t.x,t.y]);return t.x=e[0],t.y=e[1],!0}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var t=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(t.AreaLeft+t.AreaRight),this.areaPoint.y=.5*(t.AreaTop+t.AreaBottom);break;case"AREA":case"REDLINE":this.areaPoint.x=t.AreaRight,this.areaPoint.y=t.AreaTop;break;case"OBJECT":var e=this.dataStore.data.ObjectUniqueID,n=this.paintInfo.metadata.primitivesByUniqueId.get(e);if(n)if(Eo(n)===$a.Component){var r=n;r.boundBox?(this.areaPoint.x=r.boundBox[2]/1e6,this.areaPoint.y=r.boundBox[1]/1e6):(this.areaPoint.x=t.AreaRight,this.areaPoint.y=t.AreaTop)}else this.areaPoint.x=.5*(t.AreaLeft+t.AreaRight),this.areaPoint.y=.5*(t.AreaTop+t.AreaBottom);else this.areaPoint.x=t.AreaRight,this.areaPoint.y=t.AreaTop}t.TextLeft!==t.TextRight&&t.TextTop!==t.TextBottom?(this.textPoint.x=t.TextLeft,this.textPoint.y=t.TextTop):(this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y)}}])&&ii(e.prototype,n),r&&ii(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(nn),yi=n(105);function vi(t){return(vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function bi(t,e){return(bi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function gi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Oi(t);if(e){var o=Oi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return wi(this,n)}}function wi(t,e){if(e&&("object"===vi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ei(t)}function Ei(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Oi(t){return(Oi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Si(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Pi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bi(t,e)}(i,t);var e,n,r,o=gi(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Si(Ei(t=o.call(this,"PCBView")),"paintInfo",null),Si(Ei(t),"metadata",new Map),Si(Ei(t),"scene",void 0),Si(Ei(t),"materialId",void 0),Si(Ei(t),"layerId",void 0),Si(Ei(t),"acceptedPrimitivesToSelect",new Set([$a.Arc,$a.Via,$a.Track,$a.Pad,$a.Component,$a.EmbeddedBoard])),Si(Ei(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.2DState"})),c.bus.on("GraphiteEngine:createdScene2D",(function(e){var n={Diffuse:i.materialColor,Hatching:yi.b.None,Bordered:!1,GrayscaleMesh:!1,OnTop:!1,Offset2D:0};t.scene=e.createOverlayScene("PCB_2D_Comment_Scene",[{name:"Default_Comment_Layer",z_range:[-1,1],is_keepout:!1,is_inverted:!1,is_cutout:!1,is_barrel:!1,show3d:!0}],[n]),t.materialId=0,t.layerId=0})),t}return e=i,(n=[{key:"svg",get:function(){var t,e;return null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.sceneGroup.closest("svg"))&&void 0!==t?t:void 0}},{key:"canvas",get:function(){var t,e;return null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.canvas)&&void 0!==t?t:void 0}},{key:"setupDocumentMetadata",value:function(t,e){var n,r,o,i=this,a={};a.components=null!==(n=null===(r=e.components)||void 0===r?void 0:r.filter((function(t){return t.pcbId})))&&void 0!==n?n:[],a.primitivesByUniqueId=new Map,a.components.forEach((function(t){return t.pcbUniqueId&&a.primitivesByUniqueId.set(t.pcbUniqueId,t)}));var c=new Map;null===(o=e.primitives)||void 0===o||o.forEach((function(t){t.pcbId&&i.acceptedPrimitivesToSelect.has(Eo(t))&&(c.set(t.pcbId,t),t.pcbUniqueId&&a.primitivesByUniqueId.set(t.pcbUniqueId,t))})),a.primitives=c,this.metadata.set(t,a)}},{key:"createOverlay",value:function(){var t,e,n={},r={id:"",name:"",altiumDesignerId:""};c.bus.emit("PCBView:documentInfo",r),n.documentId=r.altiumDesignerId,n.documentName=r.name,n.metadata=null!==(t=this.metadata.get(n.documentId))&&void 0!==t?t:{components:[],primitives:new Map,primitivesByUniqueId:new Map},n.layerManager=c.engines.PcbEngine.layerManager;var o=this.workspace;if(!o)throw new Error("Workspace was not found.");n.workspace=o;var a=o.querySelector("canvas");if(!a)throw new Error("Canvas was not found.");n.canvas=a;var u={renderDocumentData:null};c.bus.emit("PcbEngine:renderDocumentData",u);var s=u.renderDocumentData,f=s.overlay;n.sceneGroup=null!==(e=f.querySelector("#pcb2d-overlay-scene-for-comments"))&&void 0!==e?e:wt("g",{"data-owner":"comment-panel",id:"gerber-overlay-scene-for-comments"}),f.appendChild(n.sceneGroup);var l=document.getElementById("pcb2d-document-viewer-comment-overlay");l&&l.remove();var h=new de("pcb2d-document-viewer-comment-overlay");h.mount(s.overlay.parentElement),n.overlayView=h,n.renderer=s.renderer,n.scene=this.scene,n.layerId=this.layerId,n.materialColor=i.materialColor,n.materialId=this.materialId,this.paintInfo=n}},{key:"destoyOverlay",value:function(){var t=this.paintInfo;t&&(t.sceneGroup.remove(),t.overlayView.destroy()),this.paintInfo=null}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new _o(this.paintInfo)}},{key:"createGraphicsPainter",value:function(t){if(!this.paintInfo)throw new Error("No paint info to get painter.");return new di(t,this.paintInfo)}},{key:"canBePaint",value:function(){return!0}}])&&mi(e.prototype,n),r&&mi(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(wo);function xi(t,e){var n=window.vec3.create(),r=window.vec3.create(),o=function(t){return window.vec3.set(n,t[0],t[1],t[2])},i=function(t){return window.vec3.set(r,t[3],t[4],t[5])},a=!1,c=window.vec3.create(),u=window.vec3.create();return e.filter((function(t){return t})).forEach((function(e){var s=t.getBoundingBoxForItem(e);s&&(a?(window.vec3.min(c,c,window.vec3.min(n,o(s),i(s))),window.vec3.max(u,u,window.vec3.max(r,o(s),i(s)))):(a=!0,window.vec3.min(c,o(s),i(s)),window.vec3.max(u,o(s),i(s))))})),[c,u]}function Ii(t){return(Ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ti(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ti=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==Ii(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function ki(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ji(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ji(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ji(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _i(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Di(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Li(t,e){return(Li=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ci(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Mi(t);if(e){var o=Mi(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ai(this,n)}}function Ai(t,e){if(e&&("object"===Ii(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ri(t)}function Ri(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Mi(t){return(Mi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Si(Pi,"materialColor",new Uint8Array([38,127,235,225]));var Ni=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Li(t,e)}(f,t);var e,n,o,i,u,s=Ci(f);function f(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),Bi(Ri(e=s.call(this,{name:"Pcb3D",supportedTypes:["OBJECT","POINT"],workspace:t.workspace})),"paintInfo",void 0),Bi(Ri(e),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Pcb3D"})),e.paintInfo=t,e.on("before",(function(){t.workspace.style.cursor="crosshair",c.bus.emit("PcbEngine:enableSelection",!1)})),e.on("after",(function(){t.workspace.style.cursor="auto",e.cancelled&&c.bus.emit("PcbEngine:enableSelection",!0)})),e}return e=f,(n=[{key:"doStopBubble",value:function(t){return!1}},{key:"createData",value:(i=Ti().mark((function t(e){var n,o,i,c,u,s,f,l,h,p,d;return Ti().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.width&&!e.height){t.next=2;break}return t.abrupt("return",Promise.resolve(null));case 2:if(null!==(n=this.findTargetByScreenPoint(e.x,e.y))){t.next=5;break}return t.abrupt("return",Promise.resolve(null));case 5:if((o={}).coordType="scene",o.guid=a,o.drawing={Items:[]},o.status=r.Active,o.threadNumber=-1,o.documentName=this.paintInfo.documentName,o.documentType="PCB3D",o.data={},o.data.DocumentUniqueID=this.paintInfo.documentId,o.data.TextLeft=0,o.data.TextTop=0,o.data.TextRight=0,o.data.TextBottom=0,!n.primitives.length){t.next=30;break}return t.next=22,this.paintInfo.selectionSession.draw(n.primitives);case 22:u=t.sent,s=xi(this.paintInfo.scene,u),f=ki(s,2),i=f[0],c=f[1],o.objectType=Et($a,n.kind),t.next=36;break;case 30:if(l=this.paintInfo.scene.getNodeItemById(n.sceneId)){t.next=33;break}return t.abrupt("return",Promise.resolve(null));case 33:h=this.paintInfo.scene.getBoundingBoxForItem(l),i=this.paintInfo.scene.viewportIntersectWithZ([e.x,e.y],h[2]),c=this.paintInfo.scene.viewportIntersectWithZ([e.x,e.y],h[5]);case 36:return n.documentId?(o.type="OBJECT",o.data.ObjectUniqueID=n.documentId,o.data.AreaLeft=i[0],o.data.AreaTop=c[1],o.data.AreaRight=c[0],o.data.AreaBottom=i[1]):(p=(i[0]+c[0])/2,d=(i[1]+c[1])/2,o.type="POINT",o.data.AreaLeft=p-5,o.data.AreaTop=d+5,o.data.AreaRight=p+5,o.data.AreaBottom=d-5),o.sceneNodeId=n.sceneId,t.abrupt("return",Promise.resolve(o));case 39:case"end":return t.stop()}}),t,this)})),u=function(){var t=this,e=arguments;return new Promise((function(n,r){var o=i.apply(t,e);function a(t){_i(o,n,r,a,c,"next",t)}function c(t){_i(o,n,r,a,c,"throw",t)}a(void 0)}))},function(t){return u.apply(this,arguments)})},{key:"findTargetByScreenPoint",value:function(t,e){var n=this.paintInfo.scene.unproject([t,e]);if(n){var r=this.firstItemIdByRay(n);if(r){var o,i=this.paintInfo.metadata.primitivesBySceneId.get(r);if(i)return{sceneId:r,documentId:i.pcbUniqueId,kind:Eo(i),primitives:[i]};var a=this.paintInfo.metadata.componentsBySceneId.get(r);return a?{sceneId:a.pcbId,documentId:a.pcbUniqueId,kind:Eo(a),primitives:null!==(o=this.paintInfo.metadata.components.get(a))&&void 0!==o?o:[]}:{sceneId:r,documentId:"",kind:$a.No,primitives:[]}}}return null}},{key:"firstItemIdByRay",value:function(t){var e=window.vec4.create(),n=this.paintInfo.scene.getEye();window.vec3.sub(e,t,n),window.vec3.normalize(e,e);var r=this.paintInfo.scene.getNodeItemsAtRay(n,e);if(r&&r.length)for(var o=0;o<r.length;o++){var i=r[o];if(this.is3DItemDisplayed(i))return i.GetId()}return null}},{key:"is3DItemDisplayed",value:function(t){if(!t)return!1;if(t.GetMeshesCount()>0)return!0;for(var e=t.GetLayersCount(),n=0;n<e;n++){var r=t.GetLayerGeometry(n);if(r){var o=this.paintInfo.scene.layerMap.GetLayer(r.GetLayerIndex());if(null!=o&&o.show3d)return!0}}return!1}}])&&Di(e.prototype,n),o&&Di(e,o),Object.defineProperty(e,"prototype",{writable:!1}),f}(bt),Vi=n(137);function Gi(t){return(Gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fi(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Fi=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==Gi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function Hi(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Wi(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Hi(i,r,o,a,c,"next",t)}function c(t){Hi(i,r,o,a,c,"throw",t)}a(void 0)}))}}function Ui(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Yi(){return(Yi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=zi(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function zi(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ki(t)););return t}function qi(t,e){return(qi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Xi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ki(t);if(e){var o=Ki(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Zi(this,n)}}function Zi(t,e){if(e&&("object"===Gi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ji(t)}function Ji(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ki(t){return(Ki=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $i={where:function(t){return["READY"===t.type]},to:"READY"},ta={where:function(t){return["DRAW"===t.type]},to:"DRAW"},ea={where:function(t){return["CLEAR"===t.type]},to:"CLEAR"},na={where:function(t){return["COMPLETE"===t.type]},to:"COMPLETE"},ra={IDLE:[$i,ta],READY:[ta],DRAW:[$i,{where:function(t){return["BREAK"===t.type]},to:"BREAK"},ea,na],BREAK:[na],COMPLETE:[ea],CLEAR:[$i]},oa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qi(t,e)}(s,t);var e,n,r,o,i,a,u=Xi(s);function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),Qi(Ji(e=u.call(this,"IDLE",ra)),"renderer",void 0),Qi(Ji(e),"currentVariant",null),Qi(Ji(e),"logger",void 0),e.renderer=t,e.logger=c.createLogger("CP_PcbDrawSelectionSession"),e.on("READY",(function(){return e.logger.LogDebug("READY")})),e.on("DRAW",(function(){return e.logger.LogDebug("DRAW")})),e.on("BREAK",(function(){return e.logger.LogDebug("BREAK")})),e.on("COMPLETE",(function(){return e.logger.LogDebug("COMPLETE")})),e.on("CLEAR",(function(){return e.logger.LogDebug("CLEAR")})),e.doDraw=e.doDraw.bind(Ji(e)),e.doClear=e.doClear.bind(Ji(e)),e.on("DRAW",e.doDraw),e.on("CLEAR",e.doClear),e.onVariantChanged=e.onVariantChanged.bind(Ji(e)),c.bus.on("Variants:changed",e.onVariantChanged),e.dispatch({type:"READY"}),e}return e=s,(n=[{key:"selected",get:function(){return"COMPLETE"===this.state}},{key:"draw",value:(a=Wi(Fi().mark((function t(e){var n=this;return Fi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.gotoReady(!0);case 2:return t.next=4,new Promise((function(t,r){n.dispatch({type:"DRAW",resolve:t,reject:r,primitives:e})}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"clear",value:(i=Wi(Fi().mark((function t(){return Fi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.gotoReady(!0);case 2:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"destoy",value:function(){c.bus.off("Variants:changed",this.onVariantChanged),this.clear()}},{key:"dispatch",value:function(t){return Yi(Ki(s.prototype),"dispatch",this).call(this,t)}},{key:"gotoReady",value:function(t){var e=this;return new Promise((function(n){"READY"===e.state?Object(Zn.a)((function(){return n()})):(e.on("READY",(function t(){e.off("READY",t),setTimeout((function(){return n()}),0)})),"DRAW"===e.state&&(e.on("COMPLETE",(function n(){e.off("COMPLETE",n),Object(Zn.a)((function(){return e.dispatch({type:"CLEAR",deselect:t})}))})),e.dispatch({type:"BREAK"})),"COMPLETE"===e.state&&e.dispatch({type:"CLEAR",deselect:t}))}))}},{key:"doClear",value:function(t){var e=this;try{t.deselect&&this.renderer.setSelected(!1),this.renderer.clearSelection(t.deselect)}catch(t){this.logger.LogError("Clear error.",t)}Object(Zn.a)((function(){return e.dispatch({type:"READY"})}))}},{key:"doDraw",value:(o=Wi(Fi().mark((function t(e){var n,r,o,i=this;return Fi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Vi.b,r=function t(){Object(Zn.a)((function(){return n.isCancellationRequested=!0})),i.off("BREAK",t)},this.on("BREAK",r),t.prev=3,this.renderer.setSelected(!0),t.next=7,this.renderer.addSelection(e.primitives,n);case 7:o=t.sent,this.dispatch({type:"COMPLETE"}),e.resolve(o),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(3),t.t0 instanceof Vi.a?(Object(Zn.a)((function(){return i.dispatch({type:"COMPLETE"})})),e.resolve()):(Object(Zn.a)((function(){return i.dispatch({type:"CLEAR",deselect:!0})})),e.reject(t.t0));case 15:return t.prev=15,this.off("BREAK",r),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[3,12,15,18]])}))),function(t){return o.apply(this,arguments)})},{key:"onVariantChanged",value:function(t){this.currentVariant=null==t?void 0:t.projectVariant}}])&&Ui(e.prototype,n),r&&Ui(e,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(u.a);function ia(t){return(ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function aa(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ca(t,e){return(ca=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function ua(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=la(t);if(e){var o=la(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return sa(this,n)}}function sa(t,e){if(e&&("object"===ia(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return fa(t)}function fa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function la(t){return(la=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ha(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ca(t,e)}(i,t);var e,n,r,o=ua(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),ha(fa(n=o.call(this,"Pcb3DText")),"dataStore",void 0),ha(fa(n),"paintInfo",void 0),ha(fa(n),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.Pcb3DText"})),n.dataStore=t,n.paintInfo=e,n}return e=i,(n=[{key:"getBoundRect",value:function(){throw new Error("Method not implemented.")}},{key:"onShow",value:function(){if(!this.paintInfo.selectionSession.selected)switch(this.dataStore.type){case"OBJECT":var t=this.paintInfo.metadata.primitivesByDocumentId.get(this.dataStore.data.ObjectUniqueID);if(t)if(Eo(t)===$a.Component){var e=t,n=this.paintInfo.metadata.components.get(e);n&&this.paintInfo.selectionSession.draw(n)}else this.paintInfo.selectionSession.draw([t])}}},{key:"onHide",value:function(){this.paintInfo.selectionSession.clear()}}])&&aa(e.prototype,n),r&&aa(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ne),da=n(338);function ya(t){return(ya="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function va(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return ma(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ma(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ma(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ba(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ga(){return(ga="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=wa(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function wa(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xa(t)););return t}function Ea(t,e){return(Ea=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Oa(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xa(t);if(e){var o=xa(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Sa(this,n)}}function Sa(t,e){if(e&&("object"===ya(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Pa(t)}function Pa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xa(t){return(xa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ia(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ta,ka=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ea(t,e)}(i,t);var e,n,r,o=Oa(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Ia(Pa(n=o.call(this,"Pcb3D",t)),"paintInfo",void 0),Ia(Pa(n),"layerKind",Ta.Top),Ia(Pa(n),"min",[0,0,0]),Ia(Pa(n),"max",[0,0,0]),Ia(Pa(n),"areaPoint",{x:0,y:0,z:0}),Ia(Pa(n),"textPoint",{x:0,y:0,z:0}),Ia(Pa(n),"toString",(function(){return"CommentsDrawingEngine.Painters.Pcb3D"})),n.paintInfo=e,n.setPoints(),n.onSceneTransform=n.onSceneTransform.bind(Pa(n)),n.paintInfo.renderer.on("transformScene",n.onSceneTransform),n}return e=i,(n=[{key:"areaScreenPoint",get:function(){var t=this.paintInfo.scene.project([this.areaPoint.x,this.areaPoint.y,this.areaPoint.z]);return{x:t[0],y:t[1]}}},{key:"textScreenPoint",get:function(){var t=this.paintInfo.scene.project([this.textPoint.x,this.textPoint.y,this.textPoint.z]);return{x:t[0],y:t[1]}}},{key:"destroy",value:function(){this.paintInfo.renderer.off("transformScene",this.onSceneTransform),ga(xa(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){var t=this.layerKind===Ta.Top?da.a.Front:da.a.Back;this.paintInfo.scene.zoomToFitFixedView(t,this.min,this.max,.6)}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(t){return new pa(t,this.paintInfo)}},{key:"createDrawingEditMode",value:function(){return null}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var t,e=this,n=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(n.AreaLeft+n.AreaRight),this.areaPoint.y=.5*(n.AreaTop+n.AreaBottom),this.min[0]=n.AreaLeft,this.min[1]=n.AreaBottom,this.max[0]=n.AreaRight,this.max[1]=n.AreaTop;break;case"OBJECT":var r,o=this.paintInfo.metadata.primitivesByDocumentId.get(this.dataStore.data.ObjectUniqueID);if(o)if(Eo(o)===$a.Component){var i=o,a=this.paintInfo.metadata.components.get(i);a&&(r=this.paintInfo.scene.getNodeItemsByIds(a.filter((function(t){return Eo(t)!==$a.Text})).map((function(t){return t.pcbId}))),this.layerKind=i.layerId)}else{var c=this.paintInfo.metadata.componentsBySceneId.get(o.pcbId);null!=c&&c.layerId&&(this.layerKind=c.layerId);var u=this.paintInfo.scene.getNodeItemById(o.pcbId);u&&(r=[u])}if(null!==(t=r)&&void 0!==t&&t.length){var s=va(xi(this.paintInfo.scene,r),2),f=s[0],l=s[1];this.areaPoint.x=f[0]+(l[0]-f[0])/2,this.areaPoint.y=f[1]+(l[1]-f[1])/2,this.areaPoint.z=this.layerKind===Ta.Top?f[2]:l[2],f.forEach((function(t,n){return e.min[n]=t})),l.forEach((function(t,n){return e.max[n]=t}))}else this.areaPoint.x=.5*(n.AreaLeft+n.AreaRight),this.areaPoint.y=.5*(n.AreaTop+n.AreaBottom),this.min[0]=n.AreaLeft,this.min[1]=n.AreaBottom,this.max[0]=n.AreaRight,this.max[1]=n.AreaTop}this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y,this.textPoint.z=this.areaPoint.z,this.min[2]=this.paintInfo.boxForLayers[2],this.max[2]=this.paintInfo.boxForLayers[5]}}])&&ba(e.prototype,n),r&&ba(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(nn);function ja(t){return(ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Da(t,e){return(Da=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function La(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ra(t);if(e){var o=Ra(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ca(this,n)}}function Ca(t,e){if(e&&("object"===ja(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Aa(t)}function Aa(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ra(t){return(Ra=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ma(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.Top=1]="Top",t[t.Bottom=32]="Bottom"}(Ta||(Ta={}));var Ba=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Da(t,e)}(i,t);var e,n,r,o=La(i);function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Ma(Aa(t=o.call(this,"PCBView3D")),"paintInfo",null),Ma(Aa(t),"metadata",new Map),Ma(Aa(t),"acceptedPrimitivesToSelect",new Set([$a.Pad,$a.Track,$a.Via])),Ma(Aa(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.3DState"})),t.hasCustomDrawing=!1,t}return e=i,(n=[{key:"svg",get:function(){var t,e;return null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.overlayView.$el)&&void 0!==t?t:void 0}},{key:"canvas",get:function(){var t,e;return null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.canvas)&&void 0!==t?t:void 0}},{key:"createMetaInfo",value:function(){var t={};return t.components=new Map,t.componentsBySceneId=new Map,t.primitivesBySceneId=new Map,t.primitivesByDocumentId=new Map,t}},{key:"setupDocumentMetadata",value:function(t,e){var n=this,r=Date.now();try{!function(){var r=n.createMetaInfo();if(n.metadata.set(t,r),e.components)for(var o=function(t){var n=e.components[t];if(!n.pcbUniqueId)return"continue";r.primitivesByDocumentId.set(n.pcbUniqueId,n),r.componentsBySceneId.set(n.pcbId,n);var o=[];n.primitives&&e.primitives&&(n.primitives.map((function(t){return e.primitives.length>t?e.primitives[t]:null})).filter((function(t){return t&&t.pcbId})).forEach((function(t){t&&(o.push(t),r.componentsBySceneId.set(t.pcbId,n))})),r.components.set(n,o))},i=0;i<e.components.length;i++)o(i);e.primitives&&e.primitives.forEach((function(t){n.acceptedPrimitivesToSelect.has(Eo(t))&&(t.pcbUniqueId&&r.primitivesByDocumentId.set(t.pcbUniqueId,t),r.primitivesBySceneId.set(t.pcbId,t))}))}()}finally{var o=Date.now();console.log("".concat(this,".setupDocumentMetadata: ").concat(o-r," ms."))}}},{key:"createOverlay",value:function(){var t,e={},n={id:"",name:"",altiumDesignerId:""};c.bus.emit("PCBView:documentInfo",n),e.documentId=n.altiumDesignerId,e.documentName=n.name,e.metadata=null!==(t=this.metadata.get(e.documentId))&&void 0!==t?t:this.createMetaInfo();var r=this.workspace;if(!r)throw new Error("Workspace was not found.");e.workspace=r;var o=r.querySelector("canvas");if(!o)throw new Error("Canvas was not found.");e.canvas=o;var i=document.getElementById("pcb3d-document-viewer-comment-overlay");i&&i.remove();var a=new de("pcb3d-document-viewer-comment-overlay");a.mount(r),a.$destroy(),e.overlayView=a;var u=c.engines.PcbEngine;e.renderer=u.pcbRenderer,e.scene=u.pcbRenderer.scene3d,e.boxForLayers=e.scene.getBoxForLayers(),e.selectionSession=new oa(e.renderer),this.paintInfo=e}},{key:"destoyOverlay",value:function(){var t=this.paintInfo;t&&(t.selectionSession.destoy(),t.overlayView.destroy()),this.paintInfo=null}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new Ni(this.paintInfo)}},{key:"createGraphicsPainter",value:function(t){if(!this.paintInfo)throw new Error("No paint info to get painter.");return new ka(t,this.paintInfo)}},{key:"canBePaint",value:function(t){return"OBJECT"===t.type||"POINT"===t.type}}])&&_a(e.prototype,n),r&&_a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(wo);function Na(t){return(Na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Va(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ga(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fa(){return(Fa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=Ha(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function Ha(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=qa(t)););return t}function Wa(t,e){return(Wa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ua(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=qa(t);if(e){var o=qa(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ya(this,n)}}function Ya(t,e){if(e&&("object"===Na(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return za(t)}function za(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qa(t){return(qa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Xa(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Za=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wa(t,e)}(i,t);var e,n,r,o=Ua(i);function i(){var t;Va(this,i);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Xa(za(t=o.call.apply(o,[this].concat(n))),"runnig",!1),Xa(za(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.ActiveThreadSession"})),t}return e=i,(n=[{key:"run",value:function(t){Fa(qa(i.prototype),"run",this).call(this,t),this.runnig=!0,c.bus.emit("PcbEngine:enableSelection",!1)}},{key:"stop",value:function(){var t=this;this.runnig=!1,Fa(qa(i.prototype),"stop",this).call(this),Object(Zn.a)((function(){t.runnig||c.bus.emit("PcbEngine:enableSelection",!0)}))}}])&&Ga(e.prototype,n),r&&Ga(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(F);function Ja(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ka(t,e,n){return e&&Ja(t.prototype,e),n&&Ja(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Qa(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var $a,tc=Ka((function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Qa(this,"disableCustomDraw",void 0),Qa(this,"svg",void 0),Qa(this,"canvas",void 0),Qa(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb.UiThreadEditOptions"})),this.svg=e,this.canvas=n,this.disableCustomDraw=r}));function ec(t){return(ec="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nc(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */nc=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==ec(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function rc(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function oc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ic(t,e){return(ic=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function ac(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=sc(t);if(e){var o=sc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return cc(this,n)}}function cc(t,e){if(e&&("object"===ec(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return uc(t)}function uc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function sc(t){return(sc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fc(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.No=0]="No",t[t.Arc=1]="Arc",t[t.Pad=2]="Pad",t[t.Via=3]="Via",t[t.Track=4]="Track",t[t.Text=5]="Text",t[t.Fill=6]="Fill",t[t.Connection=7]="Connection",t[t.Net=8]="Net",t[t.Component=9]="Component",t[t.Poly=10]="Poly",t[t.Region=11]="Region",t[t.ComponentBody=12]="ComponentBody",t[t.Dimension=13]="Dimension",t[t.Coordinate=14]="Coordinate",t[t.Class=15]="Class",t[t.Rule=16]="Rule",t[t.FromTo=17]="FromTo",t[t.DifferentialPair=18]="DifferentialPair",t[t.Violation=19]="Violation",t[t.Embedded=20]="Embedded",t[t.EmbeddedBoard=21]="EmbeddedBoard",t[t.SplitPlane=22]="SplitPlane",t[t.Trace=23]="Trace",t[t.SpareVia=24]="SpareVia",t[t.Board=25]="Board",t[t.BoardOutline=26]="BoardOutline"}($a||($a={}));var lc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ic(t,e)}(u,t);var e,n,r,o,i,a=ac(u);function u(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),fc(uc(t=a.call(this,"Pcb")),"currentActiveState",null),fc(uc(t),"documentIds",new Set),fc(uc(t),"states",new Set),fc(uc(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Pcb"}));var e=function(e){var n=new e;n.on("VIEW_SHOWN",(function(e){return t.onStateViewShown(e)})),n.on("VIEW_HIDDEN",(function(){return t.onStateViewHidden()})),t.states.add(n)};return e(Pi),e(Ba),t}return e=u,(n=[{key:"isEngineForThread",value:function(t){return"PCB"===(null==t?void 0:t.documentType)||this.documentIds.has(t.data.DocumentUniqueID)}},{key:"createCreationSession",value:function(){if(!this.currentActiveState)throw new Error("No active state to get creation session.");return this.currentActiveState.createCreationSession()}},{key:"createGraphicsPainter",value:function(t){if(!this.currentActiveState)throw new Error("No active state to get painter.");return this.currentActiveState.createGraphicsPainter(t)}},{key:"createUiThreadEditOptions",value:function(){var t,e,n,r,o,i,a=null!==(t=null===(e=this.currentActiveState)||void 0===e?void 0:e.svg)&&void 0!==t?t:void 0,c=null!==(n=null===(r=this.currentActiveState)||void 0===r?void 0:r.canvas)&&void 0!==n?n:void 0;return new tc(a,c,null!==(o=!(null!==(i=this.currentActiveState)&&void 0!==i&&i.hasCustomDrawing))&&void 0!==o&&o)}},{key:"createActiveThreadSession",value:function(){return new Za}},{key:"viewIsShown",value:function(){var t;return!(null===(t=this.currentActiveState)||void 0===t||!t.viewIsShown)}},{key:"setupMetadata",value:function(){var t,e=this,n=c.response;return null!=n&&n.metadata&&(null===(t=n.metadata.pcbDocuments)||void 0===t||t.forEach((function(t){var r=null==t?void 0:t.id;r&&e.setupDocument(r,n.metadata)}))),Promise.resolve()}},{key:"createOverlay",value:function(){if(!this.currentActiveState)throw new Error("Create overlay for empty state.");this.logger.LogDebug("Create overlay [".concat(this.currentActiveState,":").concat(this.currentActiveState.documentId,"]")),this.currentActiveState.createOverlay()}},{key:"destroyOverlay",value:function(){this.currentActiveState&&(this.logger.LogDebug("Destroy overlay [".concat(this.currentActiveState,":").concat(this.currentActiveState.documentId,"]")),this.currentActiveState.destoyOverlay())}},{key:"coordXToDocument",value:function(t){return t?Math.round(1e6*t):0}},{key:"coordYToDocument",value:function(t){return t?Math.round(1e6*t):0}},{key:"coordXToScene",value:function(t){return t?t/1e6:0}},{key:"coordYToScene",value:function(t){return t?t/1e6:0}},{key:"canBePaint",value:function(t){var e,n;return"ACTIVE"===this.getState()&&(null===(e=this.currentActiveState)||void 0===e?void 0:e.documentId)===t.documentId&&(null===(n=this.currentActiveState)||void 0===n?void 0:n.canBePaint(t))}},{key:"activateGraphics",value:(o=nc().mark((function t(e,n,r){var o;return nc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o="PCB"===e.documentType?"PCBView":"PCBView3D",this.currentActiveState&&(this.currentActiveState.canBePaint(e)?n||(o=null):o="PCBView"),t.next=5,this.activateView(e.documentName,o);case 5:e.expand(),n&&(e.zoomToFit(),c.bus.emit("PcbEngine:onSetDocumentLocation","PCB"===e.documentType?"pcb":"3d")),r(e),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(0),this.logger.LogError("Activate graphics error.",t.t0),r(null);case 14:case"end":return t.stop()}}),t,this,[[0,10]])})),i=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){rc(i,n,r,a,c,"next",t)}function c(t){rc(i,n,r,a,c,"throw",t)}a(void 0)}))},function(t,e,n){return i.apply(this,arguments)})},{key:"activateView",value:function(t,e){var n=this;return new Promise((function(r){var o;"ACTIVE"!==n.getState()||e&&n.currentActiveState&&e!==n.currentActiveState.viewName||(null===(o=n.Core.engines.PcbEngine.activeDocument)||void 0===o?void 0:o.name)!=t?(n.on("ACTIVE",(function t(){n.off("ACTIVE",t),r()})),c.bus.emit("PcbEngine:showDocument",t),c.bus.emit("View:set",null!=e?e:"PCBView")):r()}))}},{key:"onStateViewShown",value:function(t){this.onStateViewHidden(),this.currentActiveState=t;try{this.emit("viewShown",this.currentActiveState.workspace)}catch(t){this.logger.LogError("Activate for state ".concat(this.currentActiveState," error."),t)}}},{key:"onStateViewHidden",value:function(){if(null!==this.currentActiveState){try{this.emit("viewHidden")}catch(t){this.logger.LogError("Deactivate for state ".concat(this.currentActiveState," error."),t)}this.currentActiveState=null}}},{key:"setupDocument",value:function(t,e){this.logger.LogDebug("Setup for document "+t),this.documentIds.add(t),this.states.forEach((function(n){return n.setupDocumentMetadata(t,e)}))}}])&&oc(e.prototype,n),r&&oc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(at),hc=n(116);function pc(t){return(pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function yc(t,e){return(yc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function vc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=gc(t);if(e){var o=gc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return mc(this,n)}}function mc(t,e){if(e&&("object"===pc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return bc(t)}function bc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gc(t){return(gc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wc(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ec=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yc(t,e)}(c,t);var e,n,o,i=vc(c);function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),wc(bc(e=i.call(this,{name:"Gerber",supportedTypes:["AREA","POINT"],workspace:t.workspace})),"nodeItem",null),wc(bc(e),"paintInfo",void 0),wc(bc(e),"toString",(function(){return"CommentsDrawingEngine.CreationSession.Gerber"})),e.paintInfo=t,e.on("before",(function(){t.workspace.style.cursor="crosshair"})),e.on("after",(function(){t.workspace.style.cursor="auto",e.setNodeItem(null)})),e.on("drawRect",(function(t){return e.drawRect(t)})),e}return e=c,(n=[{key:"scene",get:function(){return this.paintInfo.scene}},{key:"createData",value:function(t){var e={coordType:"scene"};return e.guid=a,e.drawing={Items:[]},e.status=r.Active,e.threadNumber=-1,e.documentName=this.paintInfo.documentName,e.documentType="Gerber",e.data={},e.data.DocumentUniqueID=this.paintInfo.documentId,e.data.TextLeft=0,e.data.TextTop=0,e.data.TextRight=0,e.data.TextBottom=0,t.width||t.height?(e.type="AREA",this.setRectData(e,t)):(e.type="POINT",this.setPointData(e,t)),Promise.resolve(e)}},{key:"setNodeItem",value:function(t){this.nodeItem&&this.scene.removeItem(this.nodeItem),this.nodeItem=t,this.paintInfo.renderer.invalidate()}},{key:"drawRect",value:function(t){for(var e,n=this.scene.viewportToWorld([t.x,t.y]),r=this.scene.viewportToWorld([t.x+t.width,t.y+t.height]),o={left:n[0],top:n[1],right:r[0],bottom:r[1]},i=[[o.left,o.top,0],[o.right,o.top,0],[o.right,o.bottom,0],[o.left,o.bottom,0],[o.left,o.top,0]],a=[],c=0;c<i.length-1;c++){var u=i[c],s=i[c+1];a.push({from:u,to:s,color:this.paintInfo.materialColor,width:4,dash:0})}var f=new hc.a;(e=f.lines).push.apply(e,a);var l=this.scene.addNode(this.paintInfo.layerId,f);this.setNodeItem(l)}},{key:"setPointData",value:function(t,e){var n=this.scene.viewportToWorld([e.x,e.y]);t.data.AreaLeft=n[0]+5,t.data.AreaTop=n[1]+5,t.data.AreaRight=n[0]-5,t.data.AreaBottom=n[1]-5}},{key:"setRectData",value:function(t,e){var n=this.scene.viewportToWorld([e.x,e.y]),r=this.scene.viewportToWorld([e.x+e.width,e.y+e.height]);t.data.AreaLeft=n[0],t.data.AreaTop=n[1],t.data.AreaRight=r[0],t.data.AreaBottom=r[1]}}])&&dc(e.prototype,n),o&&dc(e,o),Object.defineProperty(e,"prototype",{writable:!1}),c}(bt);function Oc(t){return(Oc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Pc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function xc(){return(xc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=Ic(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(arguments.length<3?t:n):o.value}}).apply(this,arguments)}function Ic(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Dc(t)););return t}function Tc(t,e){return(Tc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function kc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Dc(t);if(e){var o=Dc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return jc(this,n)}}function jc(t,e){if(e&&("object"===Oc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _c(t)}function _c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Dc(t){return(Dc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lc(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Cc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tc(t,e)}(i,t);var e,n,r,o=kc(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Lc(_c(n=o.call(this,"Gerber",t)),"paintInfo",void 0),Lc(_c(n),"toString",(function(){return"CommentsDrawingEngine.Painters.Gerber"})),n.paintInfo=e,n.setPoints(),n.onSceneTransform=n.onSceneTransform.bind(_c(n)),n.paintInfo.renderer.on("transformScene",n.onSceneTransform),n}return e=i,(n=[{key:"areaScreenPoint",get:function(){var t=this.paintInfo.scene.worldToViewport([this.areaPoint.x,this.areaPoint.y]);return{x:t[0],y:t[1]}}},{key:"textScreenPoint",get:function(){var t=this.paintInfo.scene.worldToViewport([this.textPoint.x,this.textPoint.y]);return{x:t[0],y:t[1]}}},{key:"destroy",value:function(){this.paintInfo.renderer.off("transformScene",this.onSceneTransform),xc(Dc(i.prototype),"destroy",this).call(this)}},{key:"zoomToFit",value:function(){if(this.editMode){var t=this.editMode.getBoundRect();if(!t.isInfinite){var e=this.dataStore.data,n=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Sc(Object(n),!0).forEach((function(e){Lc(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Sc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t),r=n.left,o=n.top,i=n.left+n.width,a=n.top-n.height;e.TextLeft!==e.TextRight&&e.TextTop!==e.TextBottom&&(r=Math.min(r,e.TextLeft),i=Math.max(i,e.TextLeft),o=Math.max(o,e.TextTop),a=Math.min(a,e.TextTop)),this.paintInfo.scene.zoomToFit([r,a,0],[i,o,0],.6,.3)}}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(t){switch(t.type){case"POINT":case"AREA":return new Vo(t,this.paintInfo)}return this.logger.LogWarn("Method not implemented for type ".concat(t.type,".")),null}},{key:"createDrawingEditMode",value:function(t){var e=this;return new ni(t,this.paintInfo.workspace,this.paintInfo.sceneGroup,(function(){return e.emit("DRAWINGS_CHANGED")}))}},{key:"tryMoveIcon",value:function(t){var e=this.paintInfo.scene.viewportToWorld([t.x,t.y]);return t.x=e[0],t.y=e[1],!0}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"setPoints",value:function(){var t=this.dataStore.data;switch(this.dataStore.type){case"POINT":this.areaPoint.x=.5*(t.AreaLeft+t.AreaRight),this.areaPoint.y=.5*(t.AreaTop+t.AreaBottom);break;case"AREA":case"REDLINE":this.areaPoint.x=t.AreaRight,this.areaPoint.y=t.AreaTop}t.TextLeft!==t.TextRight&&t.TextTop!==t.TextBottom?(this.textPoint.x=t.TextLeft,this.textPoint.y=t.TextTop):(this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y)}}])&&Pc(e.prototype,n),r&&Pc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(nn);function Ac(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Rc(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Mc=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Rc(this,"svg",void 0),Rc(this,"canvas",void 0),Rc(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Gerber.UiThreadEditOptions"})),this.svg=e,this.canvas=n}var e,n,r;return e=t,(n=[{key:"disableCustomDraw",get:function(){return!1}}])&&Ac(e.prototype,n),r&&Ac(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Bc=n(78);function Nc(t){return(Nc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vc(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Vc=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==Nc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function Gc(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Fc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Hc(t,e){return(Hc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Wc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=zc(t);if(e){var o=zc(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Uc(this,n)}}function Uc(t,e){if(e&&("object"===Nc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Yc(t)}function Yc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zc(t){return(zc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qc(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Xc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Hc(t,e)}(u,t);var e,n,r,o,i,a=Wc(u);function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),qc(Yc(t=a.call(this,"Gerber")),"defaultDocumentId",void 0),qc(Yc(t),"viewShown",!1),qc(Yc(t),"paintInfo",null),qc(Yc(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Gerber"})),t.setupViewDisplayEvents(),t}return e=u,(n=[{key:"isEngineForThread",value:function(t){var e,n=null==t||null===(e=t.data)||void 0===e?void 0:e.DocumentUniqueID;return"Gerber"===(null==t?void 0:t.documentType)||n===this.defaultDocumentId||(null==n?void 0:n.endsWith("_GERBER"))}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new Ec(this.paintInfo)}},{key:"createGraphicsPainter",value:function(t){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new Cc(t,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var t,e,n,r,o=null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.sceneGroup.closest("svg"))&&void 0!==t?t:void 0,i=null!==(n=null===(r=this.paintInfo)||void 0===r?void 0:r.canvas)&&void 0!==n?n:void 0;return new Mc(o,i)}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"setupMetadata",value:function(){var t=this,e=c.engines.GerberEngine;return null==e||e.allDocuments.forEach((function(e,n){0===n&&(t.defaultDocumentId=e.id)})),Promise.resolve()}},{key:"createOverlay",value:function(){var t,e={},n={id:this.defaultDocumentId,name:""};c.bus.emit("GerberView:documentInfo",n),e.documentId=n.id,e.documentName=n.name;var r=this.workspace;if(!r)throw new Error("Workspace was not found.");e.workspace=r;var o=r.querySelector("canvas");if(!o)throw new Error("Canvas was not found.");e.canvas=o;var i={renderDocumentData:null};c.bus.emit("GerberEngine:renderDocumentData",i);var a=i.renderDocumentData,u=a.overlay;e.sceneGroup=null!==(t=u.querySelector("#gerber-overlay-scene-for-comments"))&&void 0!==t?t:wt("g",{"data-owner":"comment-panel",id:"gerber-overlay-scene-for-comments"}),u.appendChild(e.sceneGroup);var s=document.getElementById("gerber-document-viewer-comment-overlay");s&&s.remove();var f=new de("gerber-document-viewer-comment-overlay");f.mount(a.overlay.parentElement),e.overlayView=f,e.renderer=a.renderer,e.scene=a.scene2d,e.layerId=e.scene.layerMap.GetLayersCount()-1,e.materialColor=new Uint8Array([38,127,235,225]),e.materialId=e.scene.addMaterial(new Bc.a(e.materialColor,yi.b.None,!1)),this.paintInfo=e}},{key:"destroyOverlay",value:function(){var t=this.paintInfo;if(t){t.sceneGroup.remove(),t.overlayView.destroy();var e=t.scene.getMaterialMap().GetMaterial(t.materialId);e&&t.scene.removeMaterial(e)}this.paintInfo=null}},{key:"coordXToDocument",value:function(t){return t?Math.round(1e6*t):0}},{key:"coordYToDocument",value:function(t){return t?Math.round(1e6*t):0}},{key:"coordXToScene",value:function(t){return t?t/1e6:0}},{key:"coordYToScene",value:function(t){return t?t/1e6:0}},{key:"canBePaint",value:function(t){return"ACTIVE"===this.getState()&&(t.documentId.endsWith("_GERBER")||this.defaultDocumentId===t.documentId)}},{key:"activateGraphics",value:(o=Vc().mark((function t(e,n,r){return Vc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isViewEnabled()){t.next=4;break}return r(null),t.abrupt("return");case 4:return t.next=6,this.activateView();case 6:e.expand(),n&&e.zoomToFit(),r(e),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),this.logger.LogError("Activate graphics error.",t.t0),r(null);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})),i=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){Gc(i,n,r,a,c,"next",t)}function c(t){Gc(i,n,r,a,c,"throw",t)}a(void 0)}))},function(t,e,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){var t=c.views.GerberView;return t&&!t.hidden}},{key:"activateView",value:function(){var t=this;return new Promise((function(e){"ACTIVE"===t.getState()?e():(t.on("ACTIVE",(function n(){t.off("ACTIVE",n),e()})),c.bus.emit("View:set","GerberView"))}))}},{key:"setupViewDisplayEvents",value:function(){var t=this,e=!1,n=!1,r=null;c.bus.on("GerberView:shown",(function(o){r=o,n=!0,e&&(t.viewShown=!0,t.emit("viewShown",r))})),c.bus.on("GerberView:hidden",(function(){n=!1,e&&(t.viewShown=!1,t.emit("viewHidden"))})),c.bus.on("GerberView:documentChanged",(function(o){!e&&n?(t.viewShown=!0,t.emit("viewShown",r)):t.viewShown&&(t.emit("viewHidden"),t.emit("viewShown",r)),e=!0}))}}])&&Fc(e.prototype,n),r&&Fc(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(at);function Zc(t){return(Zc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jc(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Jc=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==Zc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function Kc(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Qc(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function $c(t,e){return($c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function tu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ru(t);if(e){var o=ru(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return eu(this,n)}}function eu(t,e){if(e&&("object"===Zc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return nu(t)}function nu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ru(t){return(ru=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ou=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$c(t,e)}(f,t);var e,n,o,i,u,s=tu(f);function f(t){var e,n,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),e=s.call(this,{name:"LSM",supportedTypes:["OBJECT"],workspace:t.workspace}),n=nu(e),o=void 0,(r="paintInfo")in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,e.paintInfo=t,e.onSelect=e.onSelect.bind(nu(e)),e.on("before",(function(){c.bus.on("Lsm:select",e.onSelect)})),e.on("after",(function(){c.bus.off("Lsm:select",e.onSelect)})),e}return e=f,(n=[{key:"onSelect",value:function(t){var e=null,n=null;if(t)switch(t.name){case"layer":(n={}).name=t.name,n.id=t.item.id;break;case"via":(n={}).name=t.name,n.id=t.item.name}n&&((e={}).coordType="scene",e.guid=a,e.drawing={Items:[]},e.status=r.Active,e.threadNumber=-1,e.documentName=this.paintInfo.documentId,e.documentType="LSM",e.type="OBJECT",e.objectType=n.name,e.data={},e.data.DocumentUniqueID=this.paintInfo.documentName,e.data.ObjectUniqueID=n.id,e.data.TextLeft=0,e.data.TextTop=0,e.data.TextRight=0,e.data.TextBottom=0,e.data.AreaLeft=0,e.data.AreaTop=0,e.data.AreaRight=0,e.data.AreaBottom=0,c.engines.LsmEngine.scrollIntoView(e.documentName,e.data.DocumentUniqueID,e.objectType,e.data.ObjectUniqueID,50)),this.emit("executed",e)}},{key:"doStopBubble",value:function(t){return!1}},{key:"doCreateData",value:(i=Jc().mark((function t(){return Jc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})),u=function(){var t=this,e=arguments;return new Promise((function(n,r){var o=i.apply(t,e);function a(t){Kc(o,n,r,a,c,"next",t)}function c(t){Kc(o,n,r,a,c,"throw",t)}a(void 0)}))},function(){return u.apply(this,arguments)})}])&&Qc(e.prototype,n),o&&Qc(e,o),Object.defineProperty(e,"prototype",{writable:!1}),f}(bt);function iu(t){return(iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function au(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function cu(t,e){return(cu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function uu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=lu(t);if(e){var o=lu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return su(this,n)}}function su(t,e){if(e&&("object"===iu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return fu(t)}function fu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function lu(t){return(lu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hu(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cu(t,e)}(i,t);var e,n,r,o=uu(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),hu(fu(e=o.call(this,t.type)),"engine",void 0),hu(fu(e),"pcbId",void 0),hu(fu(e),"stackName",void 0),hu(fu(e),"objId",void 0),hu(fu(e),"view",void 0),e.engine=c.engines.LsmEngine,e.view=c.views.LSMView,e.pcbId=t.documentName,e.stackName=t.data.DocumentUniqueID,e.objId=t.data.ObjectUniqueID,e}return e=i,(n=[{key:"getBoundRect",value:function(){var t={isInfinite:!0};return t}},{key:"onShow",value:function(){this.emitSelection(this.objId)}},{key:"onHide",value:function(){this.view&&this.view.active&&this.emitSelection(null)}},{key:"onDestroy",value:function(){this.view&&this.view.active&&this.emitSelection(null)}},{key:"emitSelection",value:function(t){var e=this.engine.findStackByPcbId(this.pcbId,this.stackName),n=this.engine.createSelectionData(e,t);n||(n=this.engine.createSelectionData(e,null)),c.bus.emit("Lsm:select",n)}}])&&au(e.prototype,n),r&&au(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ne);function du(t){return(du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function vu(t,e){return(vu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function mu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=wu(t);if(e){var o=wu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return bu(this,n)}}function bu(t,e){if(e&&("object"===du(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return gu(t)}function gu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function wu(t){return(wu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Eu(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ou=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vu(t,e)}(i,t);var e,n,r,o=mu(i);function i(t,e){var n,r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Eu(gu(r=o.call(this,"Lsm",t)),"paintInfo",void 0),Eu(gu(r),"engine",void 0),Eu(gu(r),"point",void 0),Eu(gu(r),"toString",(function(){return"CommentsDrawingEngine.Painters.Lsm"})),r.paintInfo=e,r.engine=c.engines.LsmEngine,r.point=e.svg.closest("svg").createSVGPoint(),r.onSceneTransform=r.onSceneTransform.bind(gu(r)),null===(n=r.paintInfo.svg)||void 0===n||n.addEventListener("didTransformChange",r.onSceneTransform),r}return e=i,(n=[{key:"areaScreenPoint",get:function(){return pn(this.paintInfo.sceneGroup,this.areaPoint.x,this.areaPoint.y,this.point)}},{key:"textScreenPoint",get:function(){return pn(this.paintInfo.sceneGroup,this.textPoint.x,this.textPoint.y,this.point)}},{key:"zoomToFit",value:function(){this.engine.scrollIntoView(this.dataStore.documentName,this.dataStore.data.DocumentUniqueID,this.dataStore.objectType,this.dataStore.data.ObjectUniqueID,50)}},{key:"createTextEditMode",value:function(t){return new pu(t)}},{key:"createDrawingEditMode",value:function(){return null}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"createIcon",value:function(){var t={};t.observableObject=this.getObservableObject(),t.overlayView=this.getIconOverlayView(),t.guid=this.dataStore.guid,t.type=this.dataStore.type,t.scrollable=!0;var e=this.engine.getItemCellInfo(this.dataStore.documentName,this.dataStore.data.DocumentUniqueID,this.dataStore.objectType,this.dataStore.data.ObjectUniqueID,"I");return e&&(this.areaPoint.x=e.x,this.areaPoint.y=e.y,this.textPoint.x=this.areaPoint.x,this.textPoint.y=this.areaPoint.y,t.iconAlign=e.iconAlign),new Pe(t)}}])&&yu(e.prototype,n),r&&yu(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(nn);function Su(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Pu(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var xu=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Pu(this,"svg",void 0),Pu(this,"canvas",void 0),Pu(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Lsm.UiThreadEditOptions"})),this.svg=e}var e,n,r;return e=t,(n=[{key:"disableCustomDraw",get:function(){return!0}}])&&Su(e.prototype,n),r&&Su(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Iu(t){return(Iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tu(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Tu=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==Iu(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function ku(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function ju(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _u(t,e){return(_u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Du(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Au(t);if(e){var o=Au(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Lu(this,n)}}function Lu(t,e){if(e&&("object"===Iu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Cu(t)}function Cu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Au(t){return(Au=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ru(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Mu,Bu,Nu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_u(t,e)}(u,t);var e,n,r,o,i,a=Du(u);function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),Ru(Cu(t=a.call(this,"Lsm")),"paintInfo",null),Ru(Cu(t),"viewShown",!1),Ru(Cu(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Sch"})),t.onWorkSpaceClick=t.onWorkSpaceClick.bind(Cu(t)),t.setupViewDisplayEvents(),t}return e=u,(n=[{key:"isEngineForThread",value:function(t){return"LSM"===(null==t?void 0:t.documentType)}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new ou(this.paintInfo)}},{key:"createGraphicsPainter",value:function(t){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new Ou(t,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var t,e;return new xu(null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.workspace.querySelector("svg"))&&void 0!==t?t:void 0)}},{key:"createOverlay",value:function(){var t={},e={id:"",name:"",stackId:""};c.bus.emit("LSMView:documentInfo",e),t.documentId=e.id,t.documentName=e.name,t.documentStackId=e.stackId;var n=this.workspace;if(!n)throw new Error("Workspace was not found.");t.workspace=n,document.addEventListener("click",this.onWorkSpaceClick);var r=n.querySelector("svg");if(r){t.svg=r,t.sceneGroup=r.querySelector("#scene")||wt("g",{"data-owner":"comment-panel"});var o=document.getElementById("lsm-document-viewer-comment-overlay");o&&o.remove();var i=new de("lsm-document-viewer-comment-overlay");i.mount(t.svg),i.$el.style.overflow="visible",t.overlayView=i}this.paintInfo=t}},{key:"destroyOverlay",value:function(){var t;document.removeEventListener("click",this.onWorkSpaceClick),null===(t=this.paintInfo)||void 0===t||t.overlayView.destroy(),this.paintInfo=null}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"canBePaint",value:function(){return"ACTIVE"===this.getState()}},{key:"activateGraphics",value:(o=Tu().mark((function t(e,n,r){return Tu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isViewEnabled()){t.next=4;break}return r(null),t.abrupt("return");case 4:return t.next=6,this.activateView();case 6:e.expand(),n&&e.zoomToFit(),r(e),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),this.logger.LogError("Activate graphics error.",t.t0),r(null);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})),i=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){ku(i,n,r,a,c,"next",t)}function c(t){ku(i,n,r,a,c,"throw",t)}a(void 0)}))},function(t,e,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){return c.views.LSMView}},{key:"activateView",value:function(){var t=this;return new Promise((function(e){"ACTIVE"===t.getState()?e():(t.on("ACTIVE",(function n(){t.off("ACTIVE",n),e()})),c.bus.emit("View:set","LSMView"))}))}},{key:"setupViewDisplayEvents",value:function(){var t=this,e=!1,n=!1,r=null;c.bus.on("LSMView:shown",(function(o){r=o,n=!0,e&&(t.viewShown=!0,t.emit("viewShown",r))})),c.bus.on("LSMView:hidden",(function(){n=!1,e&&(t.viewShown=!1,t.emit("viewHidden"))})),c.bus.on("LSMView:documentChanged",(function(o){!e&&n?(t.viewShown=!0,t.emit("viewShown",r)):t.viewShown&&(t.emit("viewHidden"),t.emit("viewShown",r)),e=!0}))}},{key:"onWorkSpaceClick",value:function(t){var e=document.elementsFromPoint(t.clientX,t.clientY);if(e){var n=e.find((function(t){return t.getAttribute("data-comment-guid")}));if(!n)return;var r=n.getAttribute("data-comment-guid");if(!r)return;var o=this.getByGuid(r);if(!o)return;var i=o.getState();"PROGRESS"===i||"RESOLVE"===i?c.bus.emit("CommentsDrawingEngine:changeActiveState",r):"PROGRESS_ACTIVE"!==i&&"RESOLVE_ACTIVE"!==i||c.bus.emit("CommentsDrawingEngine:changeActiveState",null)}}}])&&ju(e.prototype,n),r&&ju(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(at);function Vu(t){return(Vu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gu(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Gu=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==Vu(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function Fu(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Hu(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Wu(t,e){return(Wu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Uu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=qu(t);if(e){var o=qu(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Yu(this,n)}}function Yu(t,e){if(e&&("object"===Vu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return zu(t)}function zu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function qu(t){return(qu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Xu(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.Global=-2]="Global",t[t.None=-1]="None",t[t.Shape=0]="Shape",t[t.Vertex=1]="Vertex"}(Mu||(Mu={})),function(t){t[t.Global=-1]="Global",t[t.Wireframe=0]="Wireframe",t[t.Shaded=1]="Shaded",t[t.ShadedWithBoundaries=2]="ShadedWithBoundaries"}(Bu||(Bu={}));var Zu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wu(t,e)}(s,t);var e,n,o,i,c,u=Uu(s);function s(t,e,n){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),Xu(zu(r=u.call(this,{name:"Cadex",supportedTypes:["OBJECT"],workspace:t.workspace})),"paintInfo",void 0),Xu(zu(r),"cadexViewState",void 0),Xu(zu(r),"documentType",void 0),r.paintInfo=t,r.cadexViewState=e,r.documentType=n;var o=e.scene.globalSelectionMode;return r.on("before",(function(){return e.scene.globalSelectionMode=Mu.Shape})),r.on("after",(function(){return e.scene.globalSelectionMode=o})),r}return e=s,(n=[{key:"doStopBubble",value:function(t){return!1}},{key:"doExecute",value:(i=Gu().mark((function t(){var e,n=this;return Gu().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=function(t){if(t.added&&t.added.length>0){var e=t.added[0].object,o=e.modelId;if(o||0===o){var i=n.cadexViewState.model.modelObjectsList.find((function(t){return t.id===o})),c=n.cadexViewState.model.modelObjectsList.find((function(t){return t.id===(null==i?void 0:i.parentId)}));if(i&&i.instance.uuid){var u,s=e.boundingBox,f={};return f.guid=a,f.drawing={Items:[]},f.status=r.Active,f.threadNumber=-1,f.type="OBJECT",f.documentName=null!==(u=null==c?void 0:c.text)&&void 0!==u?u:"Undefined",f.documentType=n.documentType,f.objectType=i.text,f.data={},f.data.ObjectUniqueID=i.instance.uuid.toString(),f.data.DocumentUniqueID=n.cadexViewState.model.name,f.data.AreaLeft=s.minCorner.x,f.data.AreaTop=s.minCorner.y,f.data.AreaNear=s.minCorner.z,f.data.AreaRight=s.maxCorner.x,f.data.AreaBottom=s.maxCorner.y,f.data.AreaFar=s.maxCorner.z,n.emit("executed",f),void n.cadexViewState.scene.select([],!0,!1,!1)}}}n.cadexViewState.scene.select([],!0,!1,!0),n.emit("executed",null)},this.cadexViewState.scene.addEventListener("selectionChanged",e),t.prev=2,t.next=5,new Promise((function(t){return n.once("executed",(function(e){return t(e)}))}));case 5:return t.abrupt("return",t.sent);case 6:return t.prev=6,this.cadexViewState.scene.removeEventListener("selectionChanged",e),t.finish(6);case 9:case"end":return t.stop()}}),t,this,[[2,,6,9]])})),c=function(){var t=this,e=arguments;return new Promise((function(n,r){var o=i.apply(t,e);function a(t){Fu(o,n,r,a,c,"next",t)}function c(t){Fu(o,n,r,a,c,"throw",t)}a(void 0)}))},function(){return c.apply(this,arguments)})}])&&Hu(e.prototype,n),o&&Hu(e,o),Object.defineProperty(e,"prototype",{writable:!1}),s}(bt);function Ju(t){return(Ju="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ku(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Qu(t,e){return(Qu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function $u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ns(t);if(e){var o=ns(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ts(this,n)}}function ts(t,e){if(e&&("object"===Ju(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return es(t)}function es(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ns(t){return(ns=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rs(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var os=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qu(t,e)}(i,t);var e,n,r,o=$u(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),rs(es(n=o.call(this,"CadexText")),"dataStore",void 0),rs(es(n),"paintInfo",void 0),rs(es(n),"toString",(function(){return"CommentsDrawingEngine.Painters.EditModes.CadexText"})),n.dataStore=t,n.paintInfo=e,n}return e=i,(n=[{key:"getBoundRect",value:function(){throw new Error("Method not implemented.")}},{key:"onShow",value:function(){this.updateSelection(!0)}},{key:"onHide",value:function(){this.updateSelection(!1)}},{key:"updateSelection",value:function(t){var e,n;if(this.paintInfo.viewState&&null!==(e=this.dataStore)&&void 0!==e&&null!==(n=e.data)&&void 0!==n&&n.ObjectUniqueID){var r,o=this.paintInfo.viewState.getCadexModelInstanceById(this.dataStore.data.ObjectUniqueID);o&&(t?this.paintInfo.viewState.scene.select(o.view3dObjects,!0,!1,!0):null===(r=this.paintInfo.viewState)||void 0===r||r.scene.deselect(o.view3dObjects,!0))}}}])&&Ku(e.prototype,n),r&&Ku(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ne);function is(t){return(is="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function as(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function cs(t,e){return(cs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function us(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ls(t);if(e){var o=ls(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ss(this,n)}}function ss(t,e){if(e&&("object"===is(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return fs(t)}function fs(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ls(t){return(ls=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hs(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ps=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cs(t,e)}(i,t);var e,n,r,o=us(i);function i(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),hs(fs(n=o.call(this,"Cadex",t)),"paintInfo",void 0),hs(fs(n),"globalPoint",void 0),n.paintInfo=e,n.setPoints(t),n.paintInfo.viewState.viewPort.addEventListener("cameraChanged",n.onSceneTransform.bind(fs(n))),n}return e=i,(n=[{key:"areaScreenPoint",get:function(){var t,e;return{x:null===(t=this.paintInfo.viewState)||void 0===t?void 0:t.viewPort.globalCoordsToScreen(this.globalPoint).x,y:(null===(e=this.paintInfo.viewState)||void 0===e?void 0:e.viewPort.globalCoordsToScreen(this.globalPoint).y)+32}}},{key:"textScreenPoint",get:function(){var t,e;return{x:null===(t=this.paintInfo.viewState)||void 0===t?void 0:t.viewPort.globalCoordsToScreen(this.globalPoint).x,y:(null===(e=this.paintInfo.viewState)||void 0===e?void 0:e.viewPort.globalCoordsToScreen(this.globalPoint).y)+32}}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"createTextEditMode",value:function(t){return new os(t,this.paintInfo)}},{key:"createDrawingEditMode",value:function(t){return null}},{key:"setPoints",value:function(t){var e=function(t,e){return t+(e-t)/2};this.globalPoint=new window.cadex.ModelData_Point,this.globalPoint.x=e(t.data.AreaLeft,t.data.AreaRight),this.globalPoint.y=e(t.data.AreaTop,t.data.AreaBottom),this.globalPoint.z=e(t.data.AreaNear,t.data.AreaFar)}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}}])&&as(e.prototype,n),r&&as(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(nn);function ds(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ys(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vs=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),ys(this,"svg",void 0),ys(this,"canvas",void 0),ys(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Cadex.UiThreadEditOptions"})),this.svg=e,this.canvas=n}var e,n,r;return e=t,(n=[{key:"disableCustomDraw",get:function(){return!0}}])&&ds(e.prototype,n),r&&ds(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ms(t){return(ms="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bs(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */bs=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==ms(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function gs(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function ws(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Es(t,e){return(Es=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Os(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=xs(t);if(e){var o=xs(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ss(this,n)}}function Ss(t,e){if(e&&("object"===ms(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ps(t)}function Ps(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function xs(t){return(xs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Is(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Ts=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Es(t,e)}(u,t);var e,n,r,o,i,a=Os(u);function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),Is(Ps(t=a.call(this,"Cadex")),"overlayId","aov365_cadex_model_viewer_3D_comment_overlay"),Is(Ps(t),"viewShown",!1),Is(Ps(t),"paintInfo",null),Is(Ps(t),"cadexViewState",void 0),t.setupViewDisplayEvents(),t}return e=u,(n=[{key:"isEngineForThread",value:function(t){return"CadEx"===(null==t?void 0:t.documentType)}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new Zu(this.paintInfo,this.cadexViewState,"CadEx")}},{key:"createUiThreadEditOptions",value:function(){var t,e,n,r,o=null!==(t=null===(e=this.paintInfo)||void 0===e?void 0:e.sceneGroup.closest("svg"))&&void 0!==t?t:void 0,i=null!==(n=null===(r=this.paintInfo)||void 0===r?void 0:r.canvas)&&void 0!==n?n:void 0;return new vs(o,i)}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"activateGraphics",value:(o=bs().mark((function t(e,n,r){return bs().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isViewEnabled()){t.next=4;break}return r(null),t.abrupt("return");case 4:return t.next=6,this.activateView();case 6:e.expand(),n&&this.cadexViewState.viewPort.fitAll(!0),r(e),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),this.logger.LogError("Activate graphics error.",t.t0),r(null);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})),i=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){gs(i,n,r,a,c,"next",t)}function c(t){gs(i,n,r,a,c,"throw",t)}a(void 0)}))},function(t,e,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){var t=c.views.CadexView;return t&&!t.hidden}},{key:"activateView",value:function(){var t=this;return new Promise((function(e){"ACTIVE"===t.getState()?e():(t.on("ACTIVE",(function n(){t.off("ACTIVE",n),e()})),c.bus.emit("View:set","CadexView"))}))}},{key:"setupViewDisplayEvents",value:function(){var t=this,e=!1,n=!1,r=null;c.bus.on("CadexView:shown",(function(o,i){t.logger.LogDebug("Attach [".concat(o,"] to overlay")),t.cadexViewState=o.currentModel,r=i,n=!0,e&&(t.viewShown=!0,t.emit("viewShown",r))})),c.bus.on("CadexView:hidden",(function(){n=!1,e&&(t.viewShown=!1,t.emit("viewHidden"))})),c.bus.on("CadexView:documentChanged",(function(o){!e&&n?(t.viewShown=!0,t.emit("viewShown",r)):t.viewShown&&(t.emit("viewHidden"),t.emit("viewShown",r)),e=!0}))}},{key:"createOverlay",value:function(){var t,e,n,r={},o=document.getElementById(this.overlayId);o&&o.remove(),(o=document.createElementNS("http://www.w3.org/2000/svg","svg")).id=this.overlayId;var i=this.workspace;if(!i)throw new Error("Workspace was not found.");r.sceneGroup=o,r.workspace=i,r.documentId=null!==(t=this.cadexViewState.model.name)&&void 0!==t?t:"",r.canvas=null===(e=this.cadexViewState)||void 0===e||null===(n=e.screenshot)||void 0===n?void 0:n.canvas,r.viewState=this.cadexViewState,i.appendChild(o);var a=new de(this.overlayId);a.mount(o),r.overlayView=a,this.paintInfo=r}},{key:"createGraphicsPainter",value:function(t){if(!this.paintInfo)throw new Error("No paint info to get painter.");return new ps(t,this.paintInfo)}},{key:"canBePaint",value:function(){return"ACTIVE"===this.getState()}},{key:"destroyOverlay",value:function(){var t=this.paintInfo;t&&(t.sceneGroup.remove(),t.overlayView.destroy()),this.paintInfo=null}}])&&ws(e.prototype,n),r&&ws(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(at);function ks(t){return(ks="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function js(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */js=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==ks(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function _s(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Ds(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ls(t,e){return(Ls=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Cs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ms(t);if(e){var o=Ms(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return As(this,n)}}function As(t,e){if(e&&("object"===ks(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Rs(t)}function Rs(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ms(t){return(Ms=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bs=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ls(t,e)}(f,t);var e,n,o,i,u,s=Cs(f);function f(t){var e,n,r,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),e=s.call(this,{name:"FBOM",supportedTypes:["OBJECT"],workspace:t.workspace}),n=Rs(e),o=void 0,(r="paintInfo")in n?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o,e.paintInfo=t,e.onSelect=e.onSelect.bind(Rs(e)),e.on("before",(function(){t.workspace.style.cursor="url('".concat("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjIiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMiAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZF8xMjYwNl8xMjA4MikiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTYuODcgMTNDNi42MzE2NiAxMyA2LjQwMTE0IDEzLjA4NTEgNi4yMiAxMy4yNEwzIDE2VjRDMyAzLjQ2OTU3IDMuMjEwNzEgMi45NjA4NiAzLjU4NTc5IDIuNTg1NzlDMy45NjA4NiAyLjIxMDcxIDQuNDY5NTcgMiA1IDJIMTdDMTcuNTMwNCAyIDE4LjAzOTEgMi4yMTA3MSAxOC40MTQyIDIuNTg1NzlDMTguNzg5MyAyLjk2MDg2IDE5IDMuNDY5NTcgMTkgNFYxMUMxOSAxMS41MzA0IDE4Ljc4OTMgMTIuMDM5MSAxOC40MTQyIDEyLjQxNDJDMTguMDM5MSAxMi43ODkzIDE3LjUzMDQgMTMgMTcgMTNINi44N1oiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xMC41IDRIMTEuNVY3SDE0LjVWOEgxMS41VjExSDEwLjVWOEg3LjVWN0gxMC41VjRaIiBmaWxsPSJibGFjayIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTYuODcgMTNDNi42MzE2NiAxMyA2LjQwMTE0IDEzLjA4NTEgNi4yMiAxMy4yNEwzIDE2VjRDMyAzLjQ2OTU3IDMuMjEwNzEgMi45NjA4NiAzLjU4NTc5IDIuNTg1NzlDMy45NjA4NiAyLjIxMDcxIDQuNDY5NTcgMiA1IDJIMTdDMTcuNTMwNCAyIDE4LjAzOTEgMi4yMTA3MSAxOC40MTQyIDIuNTg1NzlDMTguNzg5MyAyLjk2MDg2IDE5IDMuNDY5NTcgMTkgNFYxMUMxOSAxMS41MzA0IDE4Ljc4OTMgMTIuMDM5MSAxOC40MTQyIDEyLjQxNDJDMTguMDM5MSAxMi43ODkzIDE3LjUzMDQgMTMgMTcgMTNINi44N1pNNCAxNEw1Ljg1IDEyLjI0QzYuMDMxMTQgMTIuMDg1MSA2LjI2MTY2IDEyIDYuNSAxMkgxN0MxNy4yNjUyIDEyIDE3LjUxOTYgMTEuODk0NiAxNy43MDcxIDExLjcwNzFDMTcuODk0NiAxMS41MTk2IDE4IDExLjI2NTIgMTggMTFWNEMxOCAzLjczNDc4IDE3Ljg5NDYgMy40ODA0MyAxNy43MDcxIDMuMjkyODlDMTcuNTE5NiAzLjEwNTM2IDE3LjI2NTIgMyAxNyAzSDVDNC43MzQ3OCAzIDQuNDgwNDMgMy4xMDUzNiA0LjI5Mjg5IDMuMjkyODlDNC4xMDUzNiAzLjQ4MDQzIDQgMy43MzQ3OCA0IDRWMTRaIiBmaWxsPSJibGFjayIvPgo8L2c+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2RfMTI2MDZfMTIwODIiIHg9IjAiIHk9IjAiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMCIgZmlsdGVyVW5pdHM9InVzZXJTcGFjZU9uVXNlIiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnM9InNSR0IiPgo8ZmVGbG9vZCBmbG9vZC1vcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIvPgo8ZmVDb2xvck1hdHJpeCBpbj0iU291cmNlQWxwaGEiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAxMjcgMCIgcmVzdWx0PSJoYXJkQWxwaGEiLz4KPGZlT2Zmc2V0IGR5PSIxIi8+CjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjEuNSIvPgo8ZmVDb2xvck1hdHJpeCB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMC4zNSAwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW4yPSJCYWNrZ3JvdW5kSW1hZ2VGaXgiIHJlc3VsdD0iZWZmZWN0MV9kcm9wU2hhZG93XzEyNjA2XzEyMDgyIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93XzEyNjA2XzEyMDgyIiByZXN1bHQ9InNoYXBlIi8+CjwvZmlsdGVyPgo8L2RlZnM+Cjwvc3ZnPgo=","') 0 20, auto"),c.bus.emit("FBOMEngine:disableSelect",!0),c.bus.on("FBOMEngine:select",e.onSelect)})),e.on("after",(function(){t.workspace.style.cursor="auto",c.bus.off("FBOMEngine:select",e.onSelect),c.bus.emit("FBOMEngine:disableSelect",!1)})),e}return e=f,(n=[{key:"onSelect",value:function(t){if(this.logger.LogDebug("FbomCreationSession:onSelect "+t.rowId),t.rowId){var e={rowId:t.rowId,threadId:null};if(c.bus.emit("FBOM:findCommentThreadForRow",e),e.threadId)c.bus.emit("CommentsDrawingEngine:changeActiveState",e.threadId);else{var n={coordType:"scene"};n.guid=a,n.drawing={Items:[]},n.status=r.Active,n.threadNumber=-1,n.documentName=this.paintInfo.documentName,n.documentType="BOM",n.type="OBJECT",n.objectType="row",n.data={},n.data.DocumentUniqueID=this.paintInfo.documentId,n.data.ObjectUniqueID=t.rowId,n.data.TextLeft=0,n.data.TextTop=0,n.data.TextRight=0,n.data.TextBottom=0,n.data.AreaLeft=0,n.data.AreaTop=0,n.data.AreaRight=0,n.data.AreaBottom=0,n.bomRowCommentBinding=t.commentBinding,n.properties={BomDesignator:JSON.stringify(t.commentBinding.designator),BomSchPartUniqueId:JSON.stringify(t.commentBinding.uniqueId),BomCatalogItemUniqueId:t.commentBinding.catalogItemUniqueId||void 0,BomParameter_Comment:t.commentParam.comment,BomParameter_Quantity:t.commentParam.quantity},Object.assign(n.properties,t.commentParam.extra),this.emit("executed",n)}}}},{key:"doStopBubble",value:function(t){return!1}},{key:"doCreateData",value:(i=js().mark((function t(){return js().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})),u=function(){var t=this,e=arguments;return new Promise((function(n,r){var o=i.apply(t,e);function a(t){_s(o,n,r,a,c,"next",t)}function c(t){_s(o,n,r,a,c,"throw",t)}a(void 0)}))},function(){return u.apply(this,arguments)})}])&&Ds(e.prototype,n),o&&Ds(e,o),Object.defineProperty(e,"prototype",{writable:!1}),f}(bt);function Ns(t){return(Ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Gs(t,e){return(Gs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Fs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Us(t);if(e){var o=Us(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Hs(this,n)}}function Hs(t,e){if(e&&("object"===Ns(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ws(t)}function Ws(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Us(t){return(Us=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ys(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var zs=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gs(t,e)}(i,t);var e,n,r,o=Fs(i);function i(t){var e,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),Ys(Ws(n=o.call(this)),"config",void 0),Ys(Ws(n),"iconElement",void 0),Ys(Ws(n),"toString",(function(){return"CommentsDrawingEngine.CellIcon"})),n.config=t,n.onChange=n.onChange.bind(Ws(n)),n.config.observableObject.on("change",n.onChange),n.iconElement=i.createIcon(),n.iconElement.setAttribute("data-comment-guid",t.guid),n.iconElement.setAttribute("data-skip-selection",""),null!==(e=t.cell)&&void 0!==e&&e.firstElementChild&&(t.cell.firstElementChild.appendChild(n.iconElement),n.initEvents()),n.onChange(),n}return e=i,r=[{key:"createIcon",value:function(){var t=window.document.createElement("div");t.style.position="absolute",t.style.height="24px",t.style.width="63px";var e=wt("svg",{height:16,width:16}),n=wt("polygon",{class:"main-icon-interaction-group",points:"12,0 0,12 0,0",fill:"#FFFFFF",stroke:"none",opacity:"1"});return t.appendChild(e),e.appendChild(n),t}}],(n=[{key:"initEvents",value:function(){var t,e,n;this.onClick=this.onClick.bind(this),null===(t=this.iconElement)||void 0===t||t.addEventListener("click",this.onClick,!0),this.onMouseEnter=this.onMouseEnter.bind(this),null===(e=this.iconElement)||void 0===e||e.addEventListener("mouseenter",this.onMouseEnter,!0),this.onMouseLeave=this.onMouseLeave.bind(this),null===(n=this.iconElement)||void 0===n||n.addEventListener("mouseleave",this.onMouseLeave,!0)}},{key:"number",set:function(t){}},{key:"visible",set:function(t){this.iconElement&&(this.iconElement.style.visibility=t?"visible":"hidden")}},{key:"state",set:function(t){var e,n=null===(e=this.iconElement)||void 0===e?void 0:e.querySelector("polygon");n&&(n.style.fill=i.ACTIVE_STATES.includes(t)?"#267FEB":"#FFFFFF",n.style.opacity=i.RESOLVE_STATES.includes(t)?"0.48":"1")}},{key:"clientBox",get:function(){var t,e;return null!==(t=null===(e=this.iconElement)||void 0===e?void 0:e.getBoundingClientRect())&&void 0!==t?t:{top:0,left:0,width:0,height:0}}},{key:"destroy",value:function(){var t;this.config.observableObject.off("change",this.onChange),this.config.observableObject.destroy(),null===(t=this.iconElement)||void 0===t||t.remove(),this.iconElement=null,this.emit("DESTROY")}},{key:"onChange",value:function(){this.emit("MOVING")}},{key:"stopBubble",value:function(t){t.stopPropagation(),t.preventDefault()}},{key:"onClick",value:function(t){this.stopBubble(t),this.emit("CLICK")}},{key:"onMouseEnter",value:function(t){var e;if(this.iconElement){var n=null===(e=this.iconElement)||void 0===e?void 0:e.getBoundingClientRect(),r=n.x+n.width,o=n.y+n.height/2;this.emit("ENTER",r,o)}}},{key:"onMouseLeave",value:function(t){this.emit("LEAVE")}}])&&Vs(e.prototype,n),r&&Vs(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(k.a);function qs(t){return(qs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xs(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Zs(t,e){return(Zs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Js(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=$s(t);if(e){var o=$s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ks(this,n)}}function Ks(t,e){if(e&&("object"===qs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Qs(t)}function Qs(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $s(t){return($s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Ys(zs,"ACTIVE_STATES",["WAIT_FOR_POST","PROGRESS_ACTIVE","RESOLVE_ACTIVE"]),Ys(zs,"RESOLVE_STATES",["RESOLVE","RESOLVE_ACTIVE","REMOVE"]);var tf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zs(t,e)}(i,t);var e,n,r,o=Js(i);function i(t,e){var n,r,a,c;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=o.call(this,t.type),r=Qs(n),c=void 0,(a="row")in r?Object.defineProperty(r,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[a]=c;var u,s={commentBinding:t.bomRowCommentBinding,rowId:null};(window.__CORE__.bus.emit("FBOM:findRowForCommentThread",s),s.rowId)&&(n.row=null===(u=e.table)||void 0===u?void 0:u.querySelector("#row-".concat(s.rowId)));return n}return e=i,(n=[{key:"getBoundRect",value:function(){var t={isInfinite:!0};return t}},{key:"onShow",value:function(){this.updateSelection(!0)}},{key:"onHide",value:function(){this.updateSelection(!1)}},{key:"onDestroy",value:function(){this.updateSelection(!1)}},{key:"updateSelection",value:function(t){if(this.row)for(var e=this.row.childElementCount,n="1px solid ".concat(t?"#64D2FF":"transparent"),r=0;r<e;++r){var o=this.row.children[r];0===r&&(o.style.borderLeft=n),o.style.borderTop=n,r===e-1&&(o.style.borderRight=n),o.style.borderBottom=n}}}])&&Xs(e.prototype,n),r&&Xs(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ne);function ef(t){return(ef="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function rf(t,e){return(rf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function of(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=uf(t);if(e){var o=uf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return af(this,n)}}function af(t,e){if(e&&("object"===ef(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return cf(t)}function cf(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function uf(t){return(uf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function sf(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var ff=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rf(t,e)}(i,t);var e,n,r,o=of(i);function i(t,e){var n,r,a,c,u;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),sf(cf(u=o.call(this,"Fbom",t)),"paintInfo",void 0),sf(cf(u),"point",void 0),sf(cf(u),"toString",(function(){return"CommentsDrawingEngine.Painters.Fbom"})),u.paintInfo=e;var s=null===(n=e.table)||void 0===n?void 0:n.getBoundingClientRect();return u.point=new DOMPoint,u.point.x=null==s?void 0:s.x,u.point.y=null==s?void 0:s.y,u.onSceneTransform=u.onSceneTransform.bind(cf(u)),null===(r=e.table)||void 0===r||r.addEventListener("didTransformChange",u.onSceneTransform),null===(a=e.table)||void 0===a||null===(c=a.parentNode)||void 0===c||c.addEventListener("scroll",u.onSceneTransform),u}return e=i,(n=[{key:"areaScreenPoint",get:function(){var t=this.paintInfo.sceneGroup;return DOMPoint.fromPoint(null==t?void 0:t.getBoundingClientRect())}},{key:"textScreenPoint",get:function(){var t=this.paintInfo.sceneGroup;return DOMPoint.fromPoint(null==t?void 0:t.getBoundingClientRect())}},{key:"zoomToFit",value:function(){var t;null===(t=this.getCurrentRowElement())||void 0===t||t.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})}},{key:"createTextEditMode",value:function(t){return new tf(t,this.paintInfo)}},{key:"createDrawingEditMode",value:function(){return null}},{key:"getObservableObject",value:function(){return new hn(this)}},{key:"getIconOverlayView",value:function(){return this.paintInfo.overlayView}},{key:"getCurrentRowElement",value:function(){var t,e={commentBinding:this.dataStore.bomRowCommentBinding,rowId:null};return window.__CORE__.bus.emit("FBOM:findRowForCommentThread",e),e.rowId?null===(t=this.paintInfo.table)||void 0===t?void 0:t.querySelector("#row-".concat(e.rowId)):null}},{key:"onSceneTransform",value:function(){this.emit("SCENE_CHANGED")}},{key:"onIconEnter",value:function(t,e){this.emit("SHOW_TOOLTIP",t,e)}},{key:"onIconLeave",value:function(){this.emit("HIDE_TOOLTIP")}},{key:"createIcon",value:function(){var t,e={};return e.observableObject=this.getObservableObject(),e.guid=this.dataStore.guid,e.type=this.dataStore.type,e.cell=null===(t=this.getCurrentRowElement())||void 0===t?void 0:t.firstElementChild,new zs(e)}}])&&nf(e.prototype,n),r&&nf(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(nn);function lf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function hf(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var pf=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),hf(this,"svg",void 0),hf(this,"canvas",void 0),hf(this,"html",void 0),hf(this,"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Fbom.UiThreadEditOptions"})),this.html=e}var e,n,r;return e=t,(n=[{key:"disableCustomDraw",get:function(){return!0}}])&&lf(e.prototype,n),r&&lf(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function df(t){return(df="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yf(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */yf=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==df(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function vf(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function mf(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function bf(t,e){return(bf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function gf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Of(t);if(e){var o=Of(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return wf(this,n)}}function wf(t,e){if(e&&("object"===df(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Ef(t)}function Ef(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Of(t){return(Of=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Sf(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Pf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bf(t,e)}(u,t);var e,n,r,o,i,a=gf(u);function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),Sf(Ef(t=a.call(this,"Fbom")),"paintInfo",null),Sf(Ef(t),"viewShown",!1),Sf(Ef(t),"isEnabled",!1),Sf(Ef(t),"toString",(function(){return"CommentsDrawingEngine.ViewEngines.Fbom"})),$r.a.getLicenseDetails($r.a.names.bomComment).isEnabled&&(t.isEnabled=!0,t.onWorkSpaceClick=t.onWorkSpaceClick.bind(Ef(t)),t.setupViewDisplayEvents()),t}return e=u,(n=[{key:"isEngineForThread",value:function(t){return this.isEnabled&&"BOM"===(null==t?void 0:t.documentType)}},{key:"customizeDataStore",value:function(t,e){var n={designator:JSON.parse(e.Properties.BomDesignator||"[]"),comment:e.Properties.BomParameter_Comment,quantity:e.Properties.BomParameter_Quantity,uniqueId:JSON.parse(e.Properties.BomSchPartUniqueId||"[]"),catalogItemUniqueId:e.Properties.BomCatalogItemUniqueId||null};Object.assign(t,{bomRowCommentBinding:n})}},{key:"createCreationSession",value:function(){if(!this.paintInfo)throw new Error("No paint info to get creation session.");return new Bs(this.paintInfo)}},{key:"createGraphicsPainter",value:function(t){if(!this.paintInfo)throw new Error("No paint info to create painter.");return new ff(t,this.paintInfo)}},{key:"createUiThreadEditOptions",value:function(){var t;return new pf(null===(t=this.paintInfo)||void 0===t?void 0:t.sceneGroup)}},{key:"createOverlay",value:function(){var t,e={documentId:"BOM",documentName:"BOM"},n=this.workspace;if(!n)throw new Error("Workspace was not found.");e.workspace=n,document.addEventListener("click",this.onWorkSpaceClick);var r=null===(t=this.workspace)||void 0===t?void 0:t.querySelector("table");r&&(e.table=r,e.sceneGroup=r),this.paintInfo=e}},{key:"destroyOverlay",value:function(){document.removeEventListener("click",this.onWorkSpaceClick),this.paintInfo=null}},{key:"viewIsShown",value:function(){return this.viewShown}},{key:"canBePaint",value:function(){return"ACTIVE"===this.getState()}},{key:"activateGraphics",value:(o=yf().mark((function t(e,n,r){return yf().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isViewEnabled()){t.next=4;break}return r(null),t.abrupt("return");case 4:return t.next=6,this.activateView();case 6:e.expand(),n&&e.zoomToFit(),r(e),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),this.logger.LogError("Activate graphics error.",t.t0),r(null);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})),i=function(){var t=this,e=arguments;return new Promise((function(n,r){var i=o.apply(t,e);function a(t){vf(i,n,r,a,c,"next",t)}function c(t){vf(i,n,r,a,c,"throw",t)}a(void 0)}))},function(t,e,n){return i.apply(this,arguments)})},{key:"isViewEnabled",value:function(){return c.views.FBOM}},{key:"activateView",value:function(){var t=this;return new Promise((function(e){"ACTIVE"===t.getState()?e():(t.on("ACTIVE",(function n(){t.off("ACTIVE",n),e()})),c.bus.emit("View:set","FBOM"))}))}},{key:"setupViewDisplayEvents",value:function(){var t=this,e=!1,n=!1,r=null;c.bus.on("FBOM:shown",(function(o){r=o,n=!0,e&&(t.viewShown=!0,t.emit("viewShown",r))})),c.bus.on("FBOM:hidden",(function(){n=!1,e&&(t.viewShown=!1,t.emit("viewHidden"))})),c.bus.on("FBOM:documentChanged",(function(o){!e&&n?(t.viewShown=!0,t.emit("viewShown",r)):t.viewShown&&(t.emit("viewHidden"),t.emit("viewShown",r)),e=!0}))}},{key:"onWorkSpaceClick",value:function(t){var e=document.elementsFromPoint(t.clientX,t.clientY);if(e){var n=e.find((function(t){return t.getAttribute("data-comment-guid")}));if(!n)return;var r=n.getAttribute("data-comment-guid");if(!r)return;var o=this.getByGuid(r);if(!o)return;var i=o.getState();"PROGRESS"===i||"RESOLVE"===i?c.bus.emit("CommentsDrawingEngine:changeActiveState",r):"PROGRESS_ACTIVE"!==i&&"RESOLVE_ACTIVE"!==i||c.bus.emit("CommentsDrawingEngine:changeActiveState",null)}}}])&&mf(e.prototype,n),r&&mf(e,r),Object.defineProperty(e,"prototype",{writable:!1}),u}(at);function xf(t){return(xf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function If(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */If=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var o=e&&e.prototype instanceof l?e:l,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return x()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=s(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),i}function s(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function l(){}function h(){}function p(){}var d={};c(d,o,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(P([])));v&&v!==e&&n.call(v,o)&&(d=v);var m=p.prototype=l.prototype=Object.create(d);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var r;this._invoke=function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,c){var u=s(t[o],t,i);if("throw"!==u.type){var f=u.arg,l=f.value;return l&&"object"==xf(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){f.value=t,a(f)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=s(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return h.prototype=p,c(m,"constructor",p),c(p,"constructor",h),h.displayName=c(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(g.prototype),c(g.prototype,i,(function(){return this})),t.AsyncIterator=g,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new g(u(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(m),c(m,a,"Generator"),c(m,o,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=P,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),O(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:P(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function Tf(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function kf(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){Tf(i,r,o,a,c,"next",t)}function c(t){Tf(i,r,o,a,c,"throw",t)}a(void 0)}))}}function jf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Df(t,e,n){return e&&_f(t.prototype,e),n&&_f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Lf(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Cf,Af=function(){function t(){jf(this,t),Lf(this,"ignoreDefaults",!1),Lf(this,"toString",(function(){return"CommentsDrawingEngine.DefaultViewEngineCreator"}))}return Df(t,[{key:"createViewEngines",value:function(){var t=[];return t.push(new wr),t.push(new fo),t.push(new lc),t.push(new Xc),t.push(new Nu),t.push(new Ts),t.push(new Pf),t}}]),t}(),Rf=function(){function t(){jf(this,t),Lf(this,"_viewEngines",[]),Lf(this,"logger",void 0),Lf(this,"graphicsMap",new Map),Lf(this,"toString",(function(){return"CommentsDrawingEngine"})),this.logger=c.createLogger("CommentsDrawingEngine")}var e;return Df(t,[{key:"name",get:function(){return"CommentsDrawingEngine"}},{key:"comment",get:function(){return"Provides methods to add and draw graphical presentation of comments."}},{key:"dependencies",get:function(){return[]}},{key:"metaInfo",get:function(){return this}},{key:"viewEngines",get:function(){return this._viewEngines.slice()}},{key:"events",get:function(){return["CommentsDrawingEngine:create","CommentsDrawingEngine:add","CommentsDrawingEngine:find","CommentsDrawingEngine:remove","CommentsDrawingEngine:commit","CommentsDrawingEngine:activate","CommentsDrawingEngine:changeActiveState","CommentsDrawingEngine:resolve","CommentsDrawingEngine:didCreate","CommentsDrawingEngine:didAdd","CommentsDrawingEngine:showTooltip","CommentsDrawingEngine:hideTooltip","CommentsDrawingEngine:changeEditMode","CommentsDrawingEngine:deleteDrawing","CommentsDrawingEngine:startColorPicker","CommentsDrawingEngine:startLinePicker","CommentsDrawingEngine:startDraw","CommentsDrawingEngine:endDraw","CommentsDrawingEngine:startEdit","CommentsDrawingEngine:stopEdit","CommentsDrawingEngine:commitEdit","CommentsDrawingEngine:visibilityChange","CommentsDrawingEngine:filterChange","CommentsDrawingEngine:documentClick","CommentsDrawingEngine:cancelEdit"]}},{key:"setup",value:function(t){return Promise.resolve()}},{key:"setupComment",value:(e=kf(If().mark((function t(e,n){var r,o=this;return If().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return f.setup(),this.createViewEngines(e),r=this._viewEngines.map((function(t){return t.setup()})),t.next=5,Promise.all(r);case 5:this.onCreateThreadGraphics=this.onCreateThreadGraphics.bind(this),c.bus.on("CommentsDrawingEngine:create",this.onCreateThreadGraphics),this.onAddThreadGraphics=this.onAddThreadGraphics.bind(this),c.bus.on("CommentsDrawingEngine:add",this.onAddThreadGraphics),c.bus.on("CommentsDrawingEngine:find",(function(t){return t.graphics=o.graphicsMap.get(t.id)})),Cf=n;case 11:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"createViewEngines",value:function(t){var e,n=this,r=null!==(e=null==t?void 0:t.createViewEngines())&&void 0!==e?e:[];null!=t&&t.ignoreDefaults||(r=(new Af).createViewEngines().concat(r)),r.forEach((function(t){return n._viewEngines.push(t)}))}},{key:"storeGraphics",value:function(t){var e=this;if(t){var n=t.guid;this.graphicsMap.set(n,t),t.on("REMOVE",(function(){return e.graphicsMap.delete(n)}))}}},{key:"onCreateThreadGraphics",value:function(){var t=this;Object(Zn.a)(kf(If().mark((function e(){var n,r;return If().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t._viewEngines.find((function(t){return"ACTIVE"===t.state}))){e.next=4;break}throw new Error("Active view engine has not found");case 4:return e.next=6,n.createGraphics();case 6:r=e.sent,t.storeGraphics(r),c.bus.emit("CommentsDrawingEngine:didCreate",{data:r}),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),t.logger.LogError("Create new thread error",e.t0),c.bus.emit("CommentsDrawingEngine:didCreate",{error:e.t0,data:null});case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))))}},{key:"onAddThreadGraphics",value:function(t,e){var n=this,r=function(){try{return JSON.parse(t.Drawing)}catch(t){return n.logger.LogError("Parce drawings error. ".concat(t.message)),{Items:[]}}};Object(Zn.a)(kf(If().mark((function o(){var i,a,u;return If().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,(i={}).coordType="document",i.data=n.deserialize(t.Data),i.drawing=r(),i.guid=t.Guid,i.type=t.Properties.Type||"REDLINE",i.status=t.Status,i.threadNumber=t.ThreadNumber,i.documentName=t.Properties.DocumentName,i.documentType=t.Properties.DocumentType,i.objectType=t.Properties.ObjectType,t.Properties.PageId&&0!==Number(t.Properties.PageId)&&!i.data.PageUniqueID&&(i.data.PageUniqueID=t.Properties.PageId),a=n._viewEngines.find((function(t){return t.isEngineForThread(i)}))){o.next=17;break}return n.logger.LogWarn("View engine has not found for thread [".concat(i.threadNumber,"|").concat(i.documentType,"|").concat(i.guid,"]")),o.abrupt("return");case 17:if(!n.graphicsMap.get(i.guid)){o.next=20;break}return o.abrupt("return");case 20:return a.customizeDataStore(i,t),o.next=23,a.addGraphics(i,e);case 23:u=o.sent,n.storeGraphics(u),c.bus.emit("CommentsDrawingEngine:didAdd",{data:u}),o.next=32;break;case 28:o.prev=28,o.t0=o.catch(0),n.logger.LogError("Add thread error",o.t0),c.bus.emit("CommentsDrawingEngine:didAdd",{error:o.t0,data:null});case 32:case"end":return o.stop()}}),o,null,[[0,28]])}))))}},{key:"deserialize",value:function(t){var e=t.split("|").map((function(t){var e=t.split("=");if(e.length<1)return null;var n=e[0];return e.splice(0,1),[n,e.join("=")]})).filter((function(t){return null!=t})),n=new Map(e),r=function(t,e){var r;return n.has(t)?null===(r=n.get(t))||void 0===r?void 0:r.trim():e},o=function(t,e){var n=r(t,""),o=Number(n);return Number.isNaN(o)?e:o};return{DocumentUniqueID:r("DocumentUniqueID",""),ObjectUniqueID:r("ObjectUniqueID",""),PageUniqueID:r("PageUniqueID",""),AreaLeft:o("AreaLeft",0),AreaTop:o("AreaTop",0),AreaNear:o("AreaNear",0),AreaRight:o("AreaRight",0),AreaBottom:o("AreaBottom",0),AreaFar:o("AreaFar",0),TextLeft:o("TextLeft",0),TextTop:o("TextTop",0),TextNear:o("TextNear",0),TextRight:o("TextRight",0),TextBottom:o("TextBottom",0),TextFar:o("TextFar",0),Text:r("Text",""),SerializedData:function(t){try{return JSON.parse(t)}catch(t){return null}}(r("SerializedData","")),Collapsed:!1}}}]),t}(),Mf={type:"Engine",name:"CommentsEngineModule",description:"Presents a drawing engine for comments.",create:function(){return new Rf}};window.__CORE__&&window.__CORE__.addModule(Mf)},137:function(t,e,n){"use strict";n.d(e,"a",(function(){return g})),n.d(e,"b",(function(){return w}));var r=n(30);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}function f(t){var e=y();return function(){var n,r=m(t);if(e){var o=m(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return l(this,n)}}function l(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){var e="function"==typeof Map?new Map:void 0;return(p=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return d(t,arguments,m(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,t)})(t)}function d(t,e,n){return(d=y()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&v(o,n.prototype),o}).apply(null,arguments)}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function v(t,e){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b,g=function(t){s(n,t);var e=f(n);function n(){return u(this,n),e.call(this,"Cancelled")}return c(n)}(p(Error)),w=function(t){s(n,t);var e=f(n);function n(){var t;u(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return i(h(t=e.call.apply(e,[this].concat(o))),"_isCancellationRequested",!1),t}return c(n,[{key:"isCancellationRequested",get:function(){return this._isCancellationRequested},set:function(t){this._isCancellationRequested||t!==this._isCancellationRequested&&(this._isCancellationRequested=t,this.emit("cancel"))}},{key:"throwIfCancellationRequested",value:function(){if(this.isCancellationRequested)throw new g}}]),n}(r.a);i(w,"default",(b=new w,Object.defineProperty(b,"isCancellationRequested",{get:function(){return!1},set:function(){},enumerable:!0,configurable:!0}),b))},14:function(t,e,n){"use strict";var r=n(10),o=JSON.parse(Object(r.c)("data-license-features","[]"));e.a={names:{schCompare:"Altium_AFS_CompareSCH",pcbCompare:"Altium_AFS_ComparePCB",bomCompare:"Altium_AFS_CompareBOM",resharing:"KillSwitch_RequestReshare",killSwitchDraftsmanView:"KillSwitch_Draftsman_View",draftsmanComment:"Altium_AFS_Draftsman_Comment",bomComment:"Altium_AFS_BOM_Comment",lightWeightTasks:"Altium_AFS_Tasks_Basic",killSwitch_Simulation_Download_Edb:"KillSwitch_Simulation_Download_EDB",killSwitchCompareBomView:"KillSwitch_CompareBOM_View",KillSwitchObjectVisibilityView:"KillSwitch_ObjectVisibility_View",tags:"KillSwitch_DesignTags",multiplePcb:"KillSwitch_MultiplePCB_View",multiboardGeneration:"KillSwitch_Multiboard_Generation",killSwitchMbsView:"KillSwitch_Mbs_View",killSwitchMbaView:"KillSwitch_Mba_View",killSwitchMbaHierarchyView:"KillSwitch_Mba_Hierarchy_View",killSwitchMbaTransparencyView:"KillSwitch_Mba_Transparency_View",commentsImages:"KillSwitch_Comments_Images"},getLicenseDetails:function(t){var e,n=o.find((function(e){return(e.includes(".")?e.split(".")[0]:e)===t}));return{isEnabled:!!n,label:null==n||null===(e=n.split("."))||void 0===e?void 0:e[1]}}}},166:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(319);function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"selectedPath",null)}var e,n,a;return e=t,a=[{key:"join",value:function(e){var n=new t;n.selectedPath=[];for(var r=0;r<e.length;r++){var o;null===(o=e[r].selectedPath)||void 0===o||o.forEach((function(t){var e;return null===(e=n.selectedPath)||void 0===e?void 0:e.push(t)}))}return n}},{key:"getPathForGroup",value:function(e){return t.getPathBBox(e,0)}},{key:"getPathForLine",value:function(e){return t.getPathBBox(e,3)}},{key:"getPathForEllipse",value:function(e){return t.getPathBBox(e,3)}},{key:"getPathForPolyLine",value:function(e){var n=new t;n.selectedPath=[];for(var o=0;o<e.points.length-1;o++){var i=e.points[o],a=e.points[o+1],c=r.a.fromPoints(i.x,i.y,a.x,a.y,3);n.selectedPath.push(c)}return n}},{key:"getPathForPolygon",value:function(e){return t.getPathBBox(e,3)}},{key:"getPathForRect",value:function(e){return t.getPathBBox(e,3)}},{key:"getPathForPath",value:function(e){return t.getPathBBox(e,3)}},{key:"getPathBBox",value:function(e,n){var o=new t,i=e.getBBox(),a=r.a.fromBox(i,n);return o.selectedPath=[a],o}}],(n=[{key:"createSvgElement",value:function(t){if(!this.selectedPath)return null;if(1===this.selectedPath.length){var e=this.selectedPath[0].createSvgElement(0);return t(e),e}var n=document.createElementNS("http://www.w3.org/2000/svg","g");return this.selectedPath.forEach((function(e){var r=e.createSvgElement(0);t(r),n.appendChild(r)})),n}},{key:"test",value:function(t){if(!this.selectedPath)return!1;for(var e=0;e<this.selectedPath.length;e++){var n=this.selectedPath[e];if(n.x<=t.x&&t.x<=n.x+n.width&&n.y<=t.y&&t.y<=n.y+n.height)return!0}return!1}}])&&o(e.prototype,n),a&&o(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}();i(a,"margin",3)},18:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e){return(i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var o=s(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return c(this,n)}}function c(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return l}));var l=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}(s,t);var e,n,r,c=a(s);function s(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),f(u(n=c.call(this)),"state",void 0),f(u(n),"prevstate_",void 0),f(u(n),"scheme",void 0),f(u(n),"dataTransfer",void 0),n.state=t,n.prevstate_=t,n.scheme=e,n.dataTransfer={},n.on(s.TRANSITION_EVENT,(function(t){return n.emit(n.state,t)})),n.on(s.ERROR_EVENT,(function(t){return n.emit(n.state,t)})),n}return e=s,(n=[{key:"isFsm",get:function(){return!0}},{key:"isActive",get:function(){return this.state in this.scheme}},{key:"getState",value:function(){return this.state}},{key:"prevstate",get:function(){return this.prevstate_}},{key:"setDataTransfer",value:function(t){this.dataTransfer=Object.assign(this.dataTransfer,t)}},{key:"clearDataTransfer",value:function(){this.dataTransfer={}}},{key:"dispatch",value:function(t){var e=this;if(this.isActive){var n=this.scheme[this.state].find((function(n){return n.where(Object.assign(t,e.dataTransfer)).every((function(t){return t}))}));return!!n&&(this.prevstate_=this.state,this.state=n.to,n.error?this.emit(s.ERROR_EVENT,t):this.emit(s.TRANSITION_EVENT,t),!0)}return!1}}])&&o(e.prototype,n),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(n(30).a);f(l,"TRANSITION_EVENT","#Transition"),f(l,"ERROR_EVENT","#Error")},30:function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return i}));var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"listeners",void 0),o(this,"on",this.addListener),o(this,"off",this.removeListener),this.listeners={}}var e,n,i;return e=t,(n=[{key:"addListener",value:function(t,e){return t in this.listeners?this.listeners[t].push(e):this.listeners[t]=[e],this}},{key:"removeListener",value:function(t,e){if(t in this.listeners){var n=this.listeners[t].indexOf(e);n>-1&&this.listeners[t].splice(n,1)}return this}},{key:"removeAllListeners",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;t?delete this.listeners[t]:this.listeners={}}},{key:"once",value:function(t,e){var n=this;return this.addListener(t,(function r(){e.apply(void 0,arguments),n.removeListener(t,r)})),this}},{key:"prependListener",value:function(t,e){return t in this.listeners?this.listeners[t].unshift(e):this.listeners[t]=[e],this}},{key:"prependOnceListener",value:function(t,e){var n=this;return this.prependListener(t,(function r(){e.apply(void 0,arguments),n.removeListener(t,r)})),this}},{key:"eventNames",value:function(){return Object.getOwnPropertyNames(this.listeners)}},{key:"listenerCount",value:function(t){return t in this.listeners?this.listeners[t].length:0}},{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return t in this.listeners&&(this.listeners[t].slice().forEach((function(t){return t.apply(void 0,n)})),!0)}}])&&r(e.prototype,n),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}()},319:function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return i}));var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"x",0),o(this,"y",0),o(this,"width",0),o(this,"height",0)}var e,n,i;return e=t,i=[{key:"fromBox",value:function(e,n){var r=new t;return e&&(e.x||0===e.x?(r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height):(e.top||0===e.top)&&(r.x=e.left,r.y=e.top,r.width=e.right-e.left,r.height=e.bottom-e.top)),n>0&&(r.x-=n,r.y-=n,r.width+=2*n,r.height+=2*n),r}},{key:"fromPoints",value:function(e,n,r,o,i){var a=new t;return e>r?(a.x=r,a.width=e-r):(a.x=e,a.width=r-e),n>o?(a.y=o,a.height=n-o):(a.y=n,a.height=o-n),i>0&&(a.x-=i,a.y-=i,a.width+=2*i,a.height+=2*i),a}}],(n=[{key:"createSvgElement",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=document.createElementNS("http://www.w3.org/2000/svg","rect");return e.setAttribute("x","".concat(this.x-t)),e.setAttribute("y","".concat(this.y-t)),e.setAttribute("width","".concat(this.width+2*t)),e.setAttribute("height","".concat(this.height+2*t)),e}}])&&r(e.prototype,n),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}()},338:function(t,e,n){"use strict";var r;n.d(e,"a",(function(){return r})),function(t){t[t.Front=0]="Front",t[t.Back=1]="Back"}(r||(r={}))},67:function(t,e,n){"use strict";e.a=function(t){return new Promise((function(e){return setTimeout((function(n){t&&t(),e()}),0)}))}},78:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return c}));var a=new Uint8Array([0,0,0,255]),c=function(){function t(e,n,o){var c=arguments.length>3&&void 0!==arguments[3]&&arguments[3],u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];r(this,t),i(this,"Diffuse",void 0),i(this,"Hatching",void 0),i(this,"Bordered",void 0),i(this,"OnTop",void 0),i(this,"GrayscaleMesh",void 0),i(this,"Offset2D",void 0),this.Diffuse=e||a,this.Hatching=n||0,this.Bordered=o||!1,this.OnTop=c,this.GrayscaleMesh=u,this.Offset2D=0}var e,n,c;return e=t,c=[{key:"Clone",value:function(e){return new t(e.Diffuse,e.Hatching,e.Bordered)}},{key:"create",value:function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new t(e,n,r,o,i)}},{key:"toArrayMaterials",value:function(e){for(var n=[],r=e.GetMaterialsCount(),o=0;o<r;o++){var i=t.Clone(e.GetMaterial(o));n[o]=i}return n}}],(n=null)&&o(e.prototype,n),c&&o(e,c),Object.defineProperty(e,"prototype",{writable:!1}),t}()},938:function(t,e,n){}});